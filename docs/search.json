[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "US Credit Card Partnerships",
    "section": "",
    "text": "Preface"
  },
  {
    "objectID": "intro.html#objectives",
    "href": "intro.html#objectives",
    "title": "1  Introduction",
    "section": "1.1 Objectives",
    "text": "1.1 Objectives\nThis project focuses on the US credit card market and whether, using publicly available data, we can independently assess Bank’s credit card partnership deals.\nStructurally, the US credit card market is split between bank branded and partnership cards (also known as co-branded cards). Partnership cards e.g., with Cosco, GAP, American Airlines etc. typically reward borrowers with benefits such as points, services and discounts. Each credit card partnership is unique, for example, the card may be a general purpose credit or restricted to one retailer or retail group (CFPB 2021).\n\nHypotheses 1: Adding a partnership with lower FICO® Score cutoff reduces the Bank’s overall credit card portfolio quality.\nEach partnership card has a minimum FICO® Score cutoff for applicants. FICO® is a US credit Card scoring system; low scores indicate increased likelihood of a borrowers defaulting on their credit card loan.\nHypotheses 2: The sector e.g., retail, energy, airline, of a partnership card is a determinant of the partnership quality.\n\nThe project findings could be used in risk assessments of new Bank card partnerships by external parties including regulators (internally, Banks will have access to granular individual borrower level data to perform a more through risk assessment).\n\n1.1.1 Partnership events\nAn attribute of the partnership market is that an established partnership can breakdown, and the whole partner portfolio moves to a new Bank. This means there are two opportunities to understand the quality of the partner portfolio by looking for changepoints in the “from” and “to” Bank. A changepoint may only be evident if:\n\nThe deal is proportionally significant.\nThere is a quality difference; if the quality of the portfolio stays same in both “from” and “to” Bank then we will not see a changepoint.\n\nIn comparison, new partnerships see a gradual increase in borrowers, making it difficult to confidently attribute changes due to a partnership verses macroeconomic factors and other business decisions made by the Bank.\n Source: Javelin Report\n\n\n\n\n\n\nCFPB. 2021. “2021 Consumer Credit Card Market Report.” Consumer Financial Protection Bureau. https://files.consumerfinance.gov/f/documents/cfpb_consumer-credit-card-market-report_2021.pdf."
  },
  {
    "objectID": "data_ffiec.html#measure-of-portfolio-quality",
    "href": "data_ffiec.html#measure-of-portfolio-quality",
    "title": "2  Bank Data",
    "section": "2.1 Measure of portfolio quality",
    "text": "2.1 Measure of portfolio quality\nTo measure quality, we can use ‘Credit Card Plans-30-89 DAYS P/D %’ (UBPRE524), which is the proportion of credit cards that are delinquent in the credit card portfolio after 30 days. In studies we see alternative measures of quality include delinquency at 90+ days (UBPRE521), and charge-off rates ((Reserve 2023) and (Bureau 2023)).\nHowever, given we are interested in the impact of a partnership, using measure Credit Card Plans-30-89 DAYS P/D % (UBPRE524) is ideal as it gives us the earliest indicator of delinquency."
  },
  {
    "objectID": "data_ffiec.html#bank-peer-groups",
    "href": "data_ffiec.html#bank-peer-groups",
    "title": "2  Bank Data",
    "section": "2.2 Bank Peer Groups",
    "text": "2.2 Bank Peer Groups\nThe scope of Banks included in our analysis is not limited to the banks involved in credit card partnerships. We can use data from FFIEC to add information about their peers i.e. other banks that are similar.\nTable 2.2 details 3 peer groups. National (US-wide) Credit card partnerships occur between banks in the Large Bank and Large Credit Card Bank groups. These peer groups are defined by FFIEC (see Section 13.1 for full list of Banks in each peer group) (FFIEC 2023). Banks belong to either group i.e., membership is mutually exclusive. Notably, partnerships do occur for other banks (Bureau 2022), but we will focus on larger partnerships that occur between Large Banks and Large Credit Card banks.\nA Large Bank like CITIBANK will have multiple businesses: household mortgages and credit cards; market trading; investment banking and more. In contrast, large credit card banks like BARCLAYS US specialise in credit cards only. Consequently, we expect to see the peer groups react differently to external factors or exhibit different internal dynamics and risk profiles.\n\n\nCode\noverdue30to89 &lt;- credit_card.overdue_3089()\ntarget_label &lt;- credit_card.target_label()\n\nbank_scope &lt;- overdue30to89 |&gt; \n                as_tibble() |&gt; \n                group_by(BankName,BankType) |&gt; \n                summarise(total_bal = sum(abs(Value),na.rm=T)) |&gt;\n                filter(!(is.na(total_bal)|total_bal==0))\n\nbank_n &lt;- bank_scope |&gt;\n            group_by(BankType) |&gt; \n            summarise(Number = n())\n\nbank_n |&gt; right_join(bank_type.desc()) |&gt; \n            relocate(Number, .after = last_col()) |&gt;  \n            knitr::kable(format = \"html\")    \n\n\n\n\nTable 2.2: Number of Banks in each peer group\n\n\nBankType\nPeerId\nCriteria\nExamples\nNumber\n\n\n\n\nLargeBank\n1\nInsured commercial banks having assets greater than $100 billion\nCITIBANK, JPMORGAN CHASE BANK, MORGAN STANLEY\n22\n\n\nLargeCreditCardBank\n201\nLarge Credit Card Banks: Credit card specialty banks having assets greater than $ 3 billion\nBARCLAYS BANK, SYNCHRONY BANK, DISCOVER BANK\n7\n\n\nOtherBank\n\nOther - all other Banks that have reported UBPRE524\n\n1234\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nWhy are there thousands of Banks? The US Banking system grew out of 19th-century regulations that restricted where banks could operate. This resulted in a very localised Banking market. Today big banks such as JPMorgan Chase, Bank of America, Citigroup and Wells Fargo, dominate the industry but there are still about 4,100 US Banks compared with 353 in Britain and 261 in Germany (Economist 2023)."
  },
  {
    "objectID": "data_ffiec.html#sec-cardact",
    "href": "data_ffiec.html#sec-cardact",
    "title": "2  Bank Data",
    "section": "2.3 Data Period",
    "text": "2.3 Data Period\nRegulation implemented in 2010 had a material impact on the credit card market (CFPB 2013; also Jambulapati and Stavins 2013). As highlighted by Jambulapati and Stavins (2013), regulation coincided with the 2008 financial crisis and post recovery period, making it difficult to fully assert causation (2013).\nThe regulations introduced were:\n\nCredit Card Accountability Responsibility and Disclosure (CARD) Act of 2009 which had a staggered implementation in February and August 2010. This Act requires Banks to assess whether a potential borrower has the means to repay. Additionally, high-risk borrowers like those under twenty-one, have additional restrictions. This has led to stricter lending criteria e.g., income and credit history checks (CFPB 2013).\nRegulation Z, or the Truth in Lending Act (TILA), focuses on ensuring transparency and fairness in lending practices. Banks have to provide full disclosure of the terms and conditions of a loan agreement (CFPBb 2023).\n\nWe can see the impact in Figure 2.1 which plots a linear trend for Credit Card Plans-30-89 DAYS P/D % for each peer group. Based on Figure 2.1 (c) there was increasing delinquency for Large Banks and Large Credit Card Banks before regulation, but post regulation the trend has reversed and is now trending down. It does appear that it took banks about a year for the regulatory changes to have an impact. If we take out staring point as 2011 Q3 as in Figure 2.1 (d), then the deliquency trend for Large Credit Card Banks is increasing.\nFor our analysis we will focus on credit card partnerships post regulation as this is more relevant for commenting on future partnership deals.\n\n\nCode\nreg_date_z &lt;- as.Date(\"2010-07-01\")\nreg_date_c1 &lt;- as.Date(\"2010-02-22\")\nreg_date_c2 &lt;- as.Date(\"2010-08-22\")\n\noverdue30to89 |&gt; \n    filter(value_diff &lt;= 23) |&gt;\n    group_by(BankType) |&gt;\n        summarise(val_mean = mean(Value, na.rm=T)) |&gt; \n        autoplot(val_mean, aes(colour=BankType)) +\n        geom_smooth(method = \"lm\", se = FALSE, show.legend = F, linewidth=.5) +    \n        scale_color_manual(values = bank_type.colours())+theme_bw() +\n        theme(legend.position = \"top\",\n                legend.title=element_blank()) +\n        labs(y=glue(\"{target_label} \\n mean\"), x=\"\")\n\noverdue30to89 |&gt; \n    filter(value_diff &lt;= 23) |&gt;\n    group_by(BankType) |&gt; summarise(variance = var(Value)) |&gt; \n    autoplot(variance) +\n    geom_vline(xintercept = reg_date_c1,linetype=2,colour=\"red\") +\n    annotate(\"label\",label=\"i\", x=reg_date_c1, y=20.0) +\n    geom_vline(xintercept = reg_date_z,linetype=2,colour=\"red\") +\n    annotate(\"label\",label=\"ii\", x=reg_date_z, y=18.0) +\n    geom_vline(xintercept = reg_date_c2,linetype=2,colour=\"red\") +\n    annotate(\"label\",label=\"iii\", x=reg_date_c2, y=16.0) +\n    labs(y=glue(\"{target_label} \\n variance\"), x=\"\") +\n    scale_color_manual(values = bank_type.colours())+ theme_bw() +\n    theme(legend.position = \"top\", legend.title=element_blank()) \n\n\noverdue30to89 |&gt; \n    filter(value_diff &lt;= 23) |&gt;\n    mutate(regulation = ifelse(as.Date(Quarter) &lt; reg_date_c1, 'Before', 'After')) |&gt; \n        group_by(BankType, regulation) |&gt;\n        summarise(val_mean = mean(Value, na.rm=T)) |&gt; \n        autoplot(val_mean, aes(colour=BankType)) +\n        geom_smooth(method = \"lm\", se = FALSE, show.legend = F,linewidth=.5) +    \n        scale_color_manual(values = bank_type.colours(), breaks=c(\"LargeBank\",\"LargeCreditCardBank\",\"OtherBank\"))+\n        geom_vline(xintercept = reg_date_c1,linetype=2,colour=\"red\")+\n        annotate(\"label\",label=\"CARD Act Part 1 comes into effect\", x=reg_date_c1, y=3.5, hjust = - 0.05) +\n        labs(y=glue(\"{target_label} \\n mean\"), x=\"\") +theme_bw() +\n        theme(legend.position = \"top\", legend.title=element_blank())\n\nnew_date &lt;- as.Date(\"2011-09-30\")\noverdue30to89 |&gt; \n    filter(value_diff &lt;= 23) |&gt;\n    mutate(regulation = case_when(\n                            as.Date(Quarter) &lt; reg_date_c1 ~ 'Before',\n                            as.Date(Quarter) &gt;= new_date ~ 'After', \n                            .default = \"Between\" )) |&gt; \n        group_by(BankType, regulation) |&gt;\n        summarise(val_mean = mean(Value, na.rm=T)) |&gt; \n        autoplot(val_mean, aes(colour=BankType)) +\n        geom_smooth(method = \"lm\", se = FALSE, show.legend = F,linewidth=.5) +    \n        scale_color_manual(values = bank_type.colours(), breaks=c(\"LargeBank\",\"LargeCreditCardBank\",\"OtherBank\"))+\n        geom_vline(xintercept = reg_date_c1,linetype=2,colour=\"red\")+\n        annotate(\"label\",label=\"CARD Act Part 1 comes into effect\", x=reg_date_c1, y=3.5, hjust = - 0.05) +\n        geom_vline(xintercept = new_date,linetype=2,colour=\"blue\")+\n        annotate(\"label\",label=\"+ 1 year after CARD Act Part 2\", x=new_date, y=3.25, hjust = - 0.05) +\n        labs(y=glue(\"{target_label} \\n mean\"), x=\"\") +theme_bw() +\n        theme(legend.position = \"top\", legend.title=element_blank())        \n\n\n\n\n\n\n\n\n(a) Bank Type have different intercepts and data patterns\n\n\n\n\n\n\n\n\n\n(b) Variance pre and post Regulation (i) - CARD Act part 1 (ii) - Regulation Z and (iii) Card Act part 2 The variance for Large Banks and Large Credit Card Banks have reduced post regulatory changes.\n\n\n\n\n\n\n\n\n\n(c) Linear trend pre and post Regulation.\n\n\n\n\n\n\n\n\n\n(d) Linear trend pre and post 2011 Q3. About a year after CARD Act part 2 was enacted.\n\n\n\n\nFigure 2.1: Impact of Regulation"
  },
  {
    "objectID": "data_ffiec.html#sec-outliers",
    "href": "data_ffiec.html#sec-outliers",
    "title": "2  Bank Data",
    "section": "2.4 Bank Outliers",
    "text": "2.4 Bank Outliers\nIn the context of time series data analysis, our objective is to identify banks that exhibit distinct characteristics across their series, rather than focusing on isolated data points.\nFollowing the methodology proposed by Hyndman and Athanasopoulos (2021), we can use Principal Components Analysis (PCA) across different statistical features or feature sets, to identify bank that diverge from its peers.\n\nLumpiness and StabilitySeasonalACFPACFData\n\n\n\n\nCode\npca_output &lt;- feature_data(overdue30to89_lbanks, c(\"lumpiness\",\"stability\")) |&gt; feature_prcomp()\n\npcs.plot(pca_output)\noutlier.plot(overdue30to89_lbanks, pca_output, -2, 2, -3, 3)\n\n\n\n\n\n\n\n\n(a) PCA for Large and Large Credit Card Banks using features: lumpiness and stability\n\n\n\n\n\n\n\n\n\n(b) Data series for Outlier Banks\n\n\n\n\nFigure 2.2: Outlier Detection using PCA\n\n\n\n\n\n\n\nCode\npca_output &lt;- feature_data(overdue30to89_lbanks, \"seasonal\") |&gt; feature_prcomp()\n\npcs.plot(pca_output)\noutlier.plot(overdue30to89_lbanks, pca_output, -4, 4, -3, 3)\n\n\n\n\n\n\n\n\n(a) PCA for Large and Large Credit Card Banks using features: seasonal\n\n\n\n\n\n\n\n\n\n(b) Data series for Outlier Banks\n\n\n\n\nFigure 2.3: Outlier Detection using PCA\n\n\n\n\n\n\n\nCode\npca_output &lt;- feature_data(overdue30to89_lbanks, \"acf\") |&gt; feature_prcomp()\n\npcs.plot(pca_output)\noutlier.plot(overdue30to89_lbanks, pca_output, -3, 3, -3, 3)\n\n\n\n\n\n\n\n\n(a) PCA for Large and Large Credit Card Banks using features: acf\n\n\n\n\n\n\n\n\n\n(b) Data series for Outlier Banks\n\n\n\n\nFigure 2.4: Outlier Detection using PCA\n\n\n\n\n\n\n\nCode\npca_output &lt;- feature_data(overdue30to89_lbanks, \"pacf\") |&gt; feature_prcomp()\n\npcs.plot(pca_output)\noutlier.plot(overdue30to89_lbanks, pca_output, -3, 3, -2, 2)\n\n\n\n\n\n\n\n\n(a) PCA for Large and Large Credit Card Banks using features: pacf\n\n\n\n\n\n\n\n\n\n(b) Data series for Outlier Banks\n\n\n\n\nFigure 2.5: Outlier Detection using PCA\n\n\n\n\n\n\n\nCode\nselected_feats &lt;- c(\"lumpiness\",\"stability\",\"seasonal\", \"pacf\", \"acf\")\n\nfeature_data(overdue30to89_lbanks,selected_feats) |&gt;\n    dplyr::select(-c(IDRSSD,Measure,Label,Description,BankType)) |&gt; \n        knitr::kable(format = \"html\")    \n\n\n\n\n\nBankName\ntrend_strength\nseasonal_strength_year\nseasonal_peak_year\nseasonal_trough_year\nspikiness\nlinearity\ncurvature\nstl_e_acf1\nstl_e_acf10\nacf1\nacf10\ndiff1_acf1\ndiff1_acf10\ndiff2_acf1\ndiff2_acf10\nseason_acf1\npacf5\ndiff1_pacf5\ndiff2_pacf5\nseason_pacf\nnsdiffs\nvar_tiled_var\nvar_tiled_mean\n\n\n\n\nHUNTINGTON NATIONAL BANK, THE (12311)\n0.9530635\n0.1729124\n0\n2\n1.00e-07\n0.7751911\n-2.2144940\n-0.2349395\n0.3760218\n0.8544777\n1.9582683\n0.0063214\n0.1039058\n-0.4398538\n0.4416281\n0.4343221\n0.7605065\n0.0727168\n0.5568651\n-0.1230831\n0\n0.0154171\n0.9320015\n\n\nDISCOVER BANK (30810)\n0.9944585\n0.8112325\n0\n2\n0.00e+00\n-0.4350713\n1.4750011\n-0.0852280\n0.1238065\n0.7917773\n1.2717891\n0.3937058\n0.6846716\n-0.2131953\n1.4445993\n0.2500438\n0.6577921\n0.5234355\n0.7585786\n-0.0591286\n1\n0.0324024\n0.9669704\n\n\nBMO HARRIS BANK NATIONAL ASSOCIATION (75633)\n0.9755994\n0.2154541\n1\n0\n1.60e-06\n-5.3895332\n3.7627350\n-0.0211182\n0.2398075\n0.8841522\n2.0443174\n0.1708108\n0.0725085\n-0.3231382\n0.2267433\n0.4754288\n0.9253202\n0.0786049\n0.3525665\n-0.0195934\n0\n0.1982277\n0.9174496\n\n\nCAPITAL ONE, NATIONAL ASSOCIATION (112837)\n0.9001762\n0.4697922\n0\n2\n1.00e-07\n0.3878022\n0.2306974\n-0.0386572\n0.3575620\n0.7097723\n0.9498783\n0.0480249\n0.2304771\n-0.2989230\n0.3662900\n0.1200048\n0.6202107\n0.1420715\n0.4957747\n-0.1608852\n0\n0.5999471\n0.6684192\n\n\nREGIONS BANK (233031)\n0.7652344\n0.4052854\n2\n0\n7.00e-07\n0.2219787\n-0.4014101\n-0.2638710\n0.2903935\n0.1700535\n0.1548445\n-0.0905573\n0.1964674\n-0.1883475\n0.4478385\n-0.0001842\n0.0627464\n0.1131025\n0.2848178\n-0.0460155\n0\n4.4347453\n0.3585522\n\n\nKEYBANK NATIONAL ASSOCIATION (280110)\n0.9300450\n0.4767099\n1\n3\n3.00e-07\n-1.8060536\n0.6052423\n-0.4554636\n0.3641280\n0.7932510\n2.2770602\n-0.3173660\n0.2388159\n-0.5362988\n0.3706732\n0.5996564\n0.8532572\n0.2439230\n0.8931959\n0.0017730\n0\n0.2241042\n0.8554005\n\n\nHSBC BANK USA, NATIONAL ASSOCIATION (413208)\n0.9117285\n0.4537436\n1\n2\n2.00e-07\n-1.7487082\n0.7706336\n-0.3561099\n0.2580567\n0.6759747\n1.1120603\n-0.2276729\n0.2966595\n-0.4705276\n0.3522254\n0.3812632\n0.5069187\n0.2423577\n0.7108991\n0.1135702\n0\n0.0876012\n0.8428728\n\n\nWELLS FARGO BANK, NATIONAL ASSOCIATION (451965)\n0.9928822\n0.7356660\n0\n2\n0.00e+00\n-2.5889570\n1.4488483\n-0.2251420\n0.2732011\n0.8196141\n1.8632394\n0.1925440\n0.6902283\n-0.2111752\n1.4083034\n0.4438450\n0.6775733\n0.3647212\n0.9730452\n0.0290917\n1\n0.0162106\n0.9733495\n\n\nCITIBANK, N.A. (476810)\n0.9908030\n0.2536053\n3\n2\n0.00e+00\n-3.7931376\n2.1762386\n-0.2828201\n0.7122035\n0.9123811\n2.8883405\n0.0372921\n0.1986128\n-0.4856949\n0.4762848\n0.6006814\n0.9023221\n0.1895705\n0.5984879\n-0.0284919\n0\n0.0218548\n0.9836425\n\n\nBANK OF AMERICA, NATIONAL ASSOCIATION (480228)\n0.9766554\n0.3222128\n0\n2\n1.00e-07\n2.3981559\n-1.1442369\n-0.2020543\n0.2088414\n0.9209089\n4.3627470\n-0.0134037\n0.0816940\n-0.4288361\n0.2644150\n0.7209661\n0.8604968\n0.0345021\n0.5024048\n-0.0488326\n0\n0.0931253\n0.9699220\n\n\nFIRST-CITIZENS BANK & TRUST COMPANY (491224)\n0.8467673\n0.3973617\n0\n2\n1.00e-07\n-0.3955144\n0.4812568\n-0.5535969\n0.4331273\n0.5929518\n1.2272501\n-0.5776905\n0.6111725\n-0.7507486\n1.0084004\n0.4204161\n0.6397132\n0.3909792\n1.0266165\n0.0148704\n0\n0.2668700\n0.7172611\n\n\nTD BANK, N.A. (497404)\n0.8450282\n0.2477859\n3\n2\n2.00e-06\n-1.2209850\n0.2394512\n-0.4707417\n0.2755460\n0.5578967\n0.8300266\n-0.4167884\n0.2228629\n-0.6922593\n0.5558464\n0.3664733\n0.4541281\n0.1847510\n0.9037182\n0.2870428\n0\n1.8634709\n0.6454015\n\n\nMANUFACTURERS AND TRADERS TRUST COMPANY (501105)\n0.9651701\n0.3518506\n2\n1\n1.00e-07\n1.8140992\n-1.8706696\n-0.3666700\n0.2903333\n0.8737037\n2.6611843\n-0.1903271\n0.2360832\n-0.5192545\n0.3886863\n0.6108413\n0.8014764\n0.2107918\n0.8724120\n-0.0396186\n0\n0.0136983\n0.9742268\n\n\nU.S. BANK NATIONAL ASSOCIATION (504713)\n0.9803151\n0.6582737\n3\n2\n0.00e+00\n-1.3246073\n0.3731079\n-0.2503842\n0.2099115\n0.7309492\n1.3714286\n0.0286782\n0.3181735\n-0.3555058\n0.7667691\n0.3816132\n0.5630020\n0.1575927\n0.6312180\n0.0249439\n1\n0.1335669\n0.8760020\n\n\nSANTANDER BANK, NATIONAL ASSOCIATION (722777)\n0.8536615\n0.0636525\n1\n2\n2.90e-06\n0.3118040\n-0.1127412\n-0.4354087\n0.4016405\n0.7305743\n1.3363075\n-0.2952308\n0.2145867\n-0.6756866\n0.6751984\n0.2452974\n0.6273595\n0.1134017\n0.6662852\n-0.1631658\n0\n1.2637334\n0.6119225\n\n\nFIFTH THIRD BANK, NATIONAL ASSOCIATION (723112)\n0.9415631\n0.4779636\n0\n2\n0.00e+00\n0.0089884\n-0.1320573\n-0.3739570\n0.2897996\n0.7884257\n1.7157210\n-0.0671606\n0.2666879\n-0.4630642\n0.4878532\n0.3747765\n0.7433701\n0.1012673\n0.6705571\n-0.1092417\n0\n0.0778569\n0.8573838\n\n\nPNC BANK, NATIONAL ASSOCIATION (817824)\n0.9699131\n0.4154155\n0\n2\n1.00e-07\n-1.5290550\n1.9349525\n-0.3890873\n0.3157409\n0.8244413\n2.1058814\n-0.1393360\n0.1796788\n-0.4698247\n0.3339229\n0.5037889\n0.6931807\n0.1563584\n0.7744174\n-0.0239795\n0\n0.0325719\n0.9319074\n\n\nJPMORGAN CHASE BANK, NATIONAL ASSOCIATION (852218)\n0.9950020\n0.5930606\n3\n2\n0.00e+00\n-2.1186680\n1.5396920\n-0.1855023\n0.1770961\n0.8298241\n1.7256090\n0.3957755\n0.4667762\n-0.4376606\n1.0535507\n0.4065194\n0.7131466\n0.4189352\n0.5426614\n0.0395428\n0\n0.0437019\n0.9556620\n\n\nTRUIST BANK (852320)\n0.8243637\n0.5029210\n0\n1\n1.00e-06\n-0.3116391\n1.0006086\n-0.2492204\n0.3404757\n0.5706468\n0.7228743\n-0.1979806\n0.3926010\n-0.4618210\n0.4542862\n0.3846178\n0.4465026\n0.2895191\n0.8889913\n0.2292934\n0\n0.7335395\n0.7466930\n\n\nSYNCHRONY BANK (1216022)\n0.9576570\n0.7140006\n2\n1\n1.00e-07\n-1.1492794\n-0.9388375\n-0.1663999\n0.3098178\n0.8268114\n2.1215927\n0.0149945\n0.9840091\n-0.2055111\n1.0930242\n0.6010165\n1.0935362\n0.3906540\n0.6765052\n-0.1430753\n1\n0.0030101\n0.8751803\n\n\nCOMENITY BANK (1391778)\n0.8855977\n0.6468957\n3\n1\n1.30e-06\n0.3384407\n0.4009700\n-0.3361271\n0.4906202\n0.6491929\n1.0772390\n-0.1180983\n0.7907312\n-0.3424627\n0.7756410\n0.3612214\n0.6080092\n0.3305460\n0.8234795\n-0.0488490\n1\n0.2491235\n0.6793573\n\n\nAMERICAN EXPRESS NATIONAL BANK (1394676)\n0.9620214\n0.4472814\n3\n2\n0.00e+00\n-0.8678099\n-0.1861395\n0.0341518\n0.1977607\n0.7148271\n1.4197753\n-0.0389337\n0.5352461\n-0.6564159\n2.4096575\n0.4038789\n0.5709466\n0.2701877\n0.5981766\n0.1194507\n0\n0.4271533\n0.7961865\n\n\nGOLDMAN SACHS BANK USA (2182786)\n0.6766518\n0.3688475\n2\n1\n6.20e-05\n1.2402142\n0.7074368\n-0.2657102\n0.3725062\n0.2389426\n0.1903584\n-0.0397215\n0.1375793\n0.0990836\n0.1390668\n0.0687088\n0.1100249\n0.1436067\n0.1437213\n-0.0184646\n0\n1.2799799\n0.5661858\n\n\nMERRICK BANK CORPORATION (2615190)\n0.9462481\n0.6988019\n0\n1\n1.40e-06\n0.1330040\n3.2025857\n-0.2096879\n0.1887789\n0.6509096\n0.9447391\n0.0150604\n0.7202903\n-0.2444499\n1.1407391\n0.1480549\n0.4953213\n0.2658144\n0.7089299\n-0.0589829\n1\n0.1255897\n0.8155939\n\n\nBARCLAYS BANK DELAWARE (2980209)\n0.9899661\n0.7530854\n3\n2\n0.00e+00\n-1.9666476\n1.2696116\n-0.4012574\n0.2952122\n0.8105639\n1.7476255\n-0.0722890\n0.4551926\n-0.5108930\n0.9385143\n0.4249961\n0.6837705\n0.2444936\n0.8794455\n0.0142305\n1\n0.0120601\n0.9549757\n\n\nUBS BANK USA (3212149)\n0.8439405\n0.3323431\n2\n1\n1.00e-07\n-1.3242141\n0.1263373\n-0.4368571\n0.5601219\n0.5985503\n1.8918120\n-0.4956408\n0.5068380\n-0.6572157\n0.8842233\n0.5212032\n0.4961814\n0.4762377\n0.8946520\n0.2529295\n0\n0.3565160\n0.8391150\n\n\nCOMENITY CAPITAL BANK (3224580)\n0.8456110\n0.4677925\n3\n1\n4.00e-07\n0.6234414\n0.9423498\n-0.2676084\n0.2821788\n0.5784708\n0.6589026\n-0.1057074\n0.3278867\n-0.3903794\n0.4598619\n0.0067148\n0.4301011\n0.1430259\n0.6406185\n-0.2173014\n0\n0.5141387\n0.7509959\n\n\nALLY BANK (3284070)\n0.9372193\nNA\nNA\nNA\n1.09e-05\n1.2245237\n-0.0014730\n-0.2179773\nNA\n0.4668900\nNA\n-0.3826888\n0.4539358\n-0.2547075\n0.3620996\n-0.4106016\n0.3972885\n0.8432133\n0.4447642\n-0.2732439\n0\n0.0000000\n0.0000000\n\n\nCITIZENS BANK, NATIONAL ASSOCIATION (3303298)\n0.9908308\n0.7009102\n3\n2\n0.00e+00\n-1.2527560\n1.0830198\n-0.0158580\n0.3337597\n0.7991463\n1.4179069\n0.3187259\n0.5631474\n-0.1306520\n1.3169889\n0.3386594\n0.6505255\n0.4344128\n0.7550298\n0.0329818\n1\n0.0243122\n0.9463984\n\n\n\n\n\n\n\n\n\n\nFrom these plots we can see that there are a few banks that started their credit card businesses after 2010 Q2 (or started reporting our target measure). These series begin at 0 and sharply increase after the first or second quarter. This pattern is expected considering it takes 30+ days for credit cards to become delinquent. However, for modelling we may want to drop the first few quarters to remove the impact of this initial sharp increase and reflect the ongoing state.\n\n\nCode\nselected_feats = c(\"lumpiness\",\"stability\",\"seasonal\")\n\n#remove first 2 quarters (take from start of series)\ndf_alltypes &lt;- overdue30to89 |&gt; \n                tsibble::group_by_key() |&gt; \n                filter(Value != 0) |&gt;\n                slice(3:n()) |&gt;\n                filter_index(regulation_cutoff ~ .) |&gt;\n                fill_gaps()\n\nall_ftbanks &lt;- df_alltypes |&gt; \n                features(Value, feature_set(tags = selected_feats))\n\nfinal_df &lt;- df_alltypes |&gt; \n                filter(BankType %in% c(\"LargeBank\", \"LargeCreditCardBank\")) |&gt;\n                mutate(value_diff = difference(Value))"
  },
  {
    "objectID": "data_ffiec.html#sec-feature-explore",
    "href": "data_ffiec.html#sec-feature-explore",
    "title": "2  Bank Data",
    "section": "2.5 Exploration of Statistical Features",
    "text": "2.5 Exploration of Statistical Features\nFigure 2.6 plots the distribution of Credit Card Plans-30-89 DAYS P/D %. We can see that there are two peaks for Large Credit Card Banks. There are 7 banks in the this peer group which may be too small to capture the true distribution effectively. However, it may also indicate that there are sub-groups within this peer group. For instance, the first peak could represent banks that have lower risk profiles, while the second represents banks that have a higher risk profiles.\n\nDistributionMeanQuantiles - Large Credit Card BanksQuantiles - Large Banks\n\n\n\n\nCode\nggplot(final_df, aes(x=Value, colour = BankType))+ \n    geom_density() +\n    labs(x=target_label) + theme_bw() +\n    theme(legend.position=\"top\",legend.title=element_blank()) +\n    scale_color_manual(values = bank_type.colours())\n\n\n\n\n\nFigure 2.6: Density plot\n\n\n\n\n\n\n\n\nCode\nfinal_df |&gt;as_tibble() |&gt; group_by(BankType) |&gt; summarise(mean = mean(Value))|&gt; \n        knitr::kable(format = \"html\") \n\n\n\n\n\nBankType\nmean\n\n\n\n\nLargeBank\n1.237393\n\n\nLargeCreditCardBank\n2.048147\n\n\n\n\n\n\n\n\n\n\n\nCode\nfinal_df |&gt; na.omit() |&gt;\n    filter(BankType == \"LargeCreditCardBank\") |&gt;\n      features(Value, quantile)|&gt; \n        dplyr::select(-c(IDRSSD,Measure,Label,Description,BankType)) |&gt;\n        arrange(`100%`)|&gt; \n        knitr::kable(format = \"html\")        \n\n\n\n\n\nBankName\n0%\n25%\n50%\n75%\n100%\n\n\n\n\nAMERICAN EXPRESS NATIONAL BANK (1394676)\n0.25\n0.5700\n0.65\n0.71\n0.94\n\n\nDISCOVER BANK (30810)\n0.61\n0.7800\n0.90\n1.08\n1.89\n\n\nBARCLAYS BANK DELAWARE (2980209)\n0.66\n1.0600\n1.14\n1.25\n2.40\n\n\nSYNCHRONY BANK (1216022)\n1.15\n1.9875\n2.21\n2.39\n2.76\n\n\nCOMENITY BANK (1391778)\n2.35\n2.7400\n3.05\n3.47\n3.90\n\n\nCOMENITY CAPITAL BANK (3224580)\n2.13\n2.6200\n2.73\n2.98\n3.91\n\n\nMERRICK BANK CORPORATION (2615190)\n1.86\n2.9400\n3.41\n3.80\n5.44\n\n\n\n\n\n\n\n\n\n\n\nCode\nfinal_df |&gt; na.omit() |&gt;\n    filter(BankType == \"LargeBank\") |&gt;\n      features(Value, quantile)|&gt; \n        dplyr::select(-c(IDRSSD,Measure,Label,Description,BankType)) |&gt; \n        arrange(`100%`)|&gt; \n        knitr::kable(format = \"html\")\n\n\n\n\n\nBankName\n0%\n25%\n50%\n75%\n100%\n\n\n\n\nBANK OF AMERICA, NATIONAL ASSOCIATION (480228)\n0.59\n0.7700\n0.880\n0.9650\n1.03\n\n\nUBS BANK USA (3212149)\n0.26\n0.4650\n0.540\n0.7100\n1.05\n\n\nMANUFACTURERS AND TRADERS TRUST COMPANY (501105)\n0.69\n1.0050\n1.130\n1.2100\n1.58\n\n\nREGIONS BANK (233031)\n0.97\n1.1300\n1.280\n1.3700\n1.65\n\n\nHUNTINGTON NATIONAL BANK, THE (12311)\n0.54\n0.7000\n0.940\n1.2875\n1.69\n\n\nFIRST-CITIZENS BANK & TRUST COMPANY (491224)\n0.74\n0.8400\n0.970\n1.1200\n1.72\n\n\nFIFTH THIRD BANK, NATIONAL ASSOCIATION (723112)\n0.84\n1.0000\n1.150\n1.3900\n1.80\n\n\nU.S. BANK NATIONAL ASSOCIATION (504713)\n0.72\n1.1200\n1.240\n1.3200\n1.85\n\n\nTD BANK, N.A. (497404)\n0.79\n1.2200\n1.410\n1.5400\n2.16\n\n\nCITIZENS BANK, NATIONAL ASSOCIATION (3303298)\n0.93\n1.1000\n1.190\n1.2800\n2.17\n\n\nGOLDMAN SACHS BANK USA (2182786)\n0.82\n1.0150\n1.195\n1.7000\n2.19\n\n\nKEYBANK NATIONAL ASSOCIATION (280110)\n0.54\n0.8475\n1.025\n1.1775\n2.26\n\n\nTRUIST BANK (852320)\n0.73\n0.8300\n0.910\n1.1100\n2.34\n\n\nPNC BANK, NATIONAL ASSOCIATION (817824)\n0.89\n1.0800\n1.240\n1.3900\n2.42\n\n\nHSBC BANK USA, NATIONAL ASSOCIATION (413208)\n0.88\n1.3100\n1.490\n1.7900\n2.44\n\n\nJPMORGAN CHASE BANK, NATIONAL ASSOCIATION (852218)\n0.47\n0.7500\n0.880\n1.0000\n2.53\n\n\nCAPITAL ONE, NATIONAL ASSOCIATION (112837)\n1.16\n1.5850\n1.785\n2.0025\n2.62\n\n\nSANTANDER BANK, NATIONAL ASSOCIATION (722777)\n0.71\n0.9800\n1.300\n1.4800\n2.67\n\n\nWELLS FARGO BANK, NATIONAL ASSOCIATION (451965)\n0.69\n1.1000\n1.230\n1.3200\n2.75\n\n\nALLY BANK (3284070)\n2.38\n2.3800\n2.380\n2.5850\n2.79\n\n\nCITIBANK, N.A. (476810)\n0.67\n1.0800\n1.180\n1.4000\n3.19\n\n\nBMO HARRIS BANK NATIONAL ASSOCIATION (75633)\n0.73\n1.1900\n1.300\n1.5250\n5.06\n\n\n\n\n\n\n\n\n\n\nFigure 2.7 shows the features from Section 2.4 that we can use to further explore the characteristics of each peer group (the calculations are documented in the tsfeatures R package by Hyndman and Yang (2023)).\nThe Other Banks peer group has been added for interest.\n\n\nCode\nfeatures.plot_violin(all_ftbanks, \"var_tiled_var\")\n\nfeatures.plot_violin(all_ftbanks, \"var_tiled_mean\")\n\nfeatures.plot_violin(all_ftbanks, \"seasonal_strength_year\")\n\nfeatures.plot_violin(all_ftbanks, \"trend_strength\")\n\nfeatures.plot_violin(all_ftbanks, \"linearity\")\n\nfeatures.plot_violin(all_ftbanks, \"stl_e_acf1\")\n\nfeatures.plot_violin(all_ftbanks, \"nsdiffs\")\n\n\n\n\n\n\n\n\n(a) Lumpiness - variance of the variances based on tiled yearly(non-overlapping) windows\n\n\n\n\n\n\n\n(b) Stability - the variance of the means based on tiled yearly(non-overlapping) windows\n\n\n\n\n\n\n\n\n\n(c) STL decomposition Seasonal Strength - 0 is week (non-seasonal), 1 is strong\n\n\n\n\n\n\n\n(d) STL decomposition Trend Strength - 0 is week (no trend), 1 is strong\n\n\n\n\n\n\n\n\n\n(e) Linearity - values around 0 indicate the series is linear\n\n\n\n\n\n\n\n(f) Autocorrelation - first autocorrelation coefficient\n\n\n\n\n\n\n\n\n\n(g) Minimum number of differences necessary to obtain a stationary time series\n\n\n\n\nFigure 2.7: Exploring Statistical Features (Post Regulatory environment)\n\n\n\n\nFigure 2.7 (a): Other Banks are lumpy. Also we can see from Figure 2.1 (b) that lumpiness continued post regulatory changes even though Other Banks are subject to the same regulation.\nFigure 2.7 (b): For Large Banks and Large Credit Card Banks the stability is ~0.8 indicating a degree of fluctuation in the data from one year to the next.\nFigure 2.7 (c) Large Credit Card Banks are seasonal. This can also be seen in the undulating shape in ACF plot (see Figure 2.9 (a)).\nFigure 2.8 shows both Large Banks and Large Credit Card Banks peak in Q3. Given events like Black Friday, Thanksgiving and Christmas occur in Q4, we may have expected peak delinquency in Q4 or Q1.\n\n\n\nCode\ndf_alltypes |&gt; group_by(BankType) |&gt; \n    summarise(mean = mean(Value, na.rm=T)) |&gt; \n        gg_subseries() +\n        labs(y=glue(\"{target_label} \\n mean\"))\n\n\n\n\n\nFigure 2.8: Quarterly Seasonal Subseries. The blue horizontal lines indicate the means for each quarter.\n\n\n\n\n\nFigure 2.7 (d) and Figure 2.7 (e) indicates a strong linear trend for Large Banks and Large Credit Card Banks.\nFigure 2.7 (f) the first autocorrelation coefficient is close to 0 which indicates a weak linear relationship between lagged values. Of note the coefficients are negative indicating a tendency for a short-term reversal. This can be seen in Figure 2.1 (a) where the values oscillate.\n\nChecking overall autocorrelation using the Ljung-Box test proves autocorrelation i.e. data pattern is not due to chance.\nLjung-Box test\n\n\n\nCode\nfinal_df |&gt; na.omit() |&gt; pull(value_diff) |&gt; Box.test(lag = 10, type = \"Ljung\")\n\n\n\n    Box-Ljung test\n\ndata:  pull(na.omit(final_df), value_diff)\nX-squared = 296.36, df = 10, p-value &lt; 2.2e-16\n\n\n\n\nFigure 2.7 (g) Large Banks and Large Credit Card Banks is not stationary i.e. the statistical properties of the time series changes, which makes it difficult to identify trends and patterns. Performing a difference i.e. to get the quarterly change in UBPRE524, makes the series stationary as shown in Figure 2.9 (b). This can be confirmed by performing an augmented Dickey–Fuller (ADF) test on the differenced value. We also see that, post differencing, there are autocorrelation coefficients above the significance threshold. The decreasing magnitude of these coefficients tell us the earlier lags have a stronger influence than values further in the past.\n\nAutocorrelation, the correlation between the timeseries and its own lagged values, can inform an AutoRegressive Moving Average (ARMA) Model.\n\n\nCode\nagg_df &lt;- final_df |&gt; \n            group_by(BankType)|&gt; \n            summarise(mean_val = mean(Value, na.rm=T),\n                      mean_diff = mean(value_diff, na.rm=T)) \n       \nagg_df |&gt; ACF(x=mean_val,lag_max = 42) |&gt; autoplot()\nagg_df |&gt; ACF(x=mean_diff,lag_max = 42) |&gt; autoplot()\n\nagg_df |&gt; PACF(x=mean_val,lag_max = 42) |&gt; autoplot()\nagg_df |&gt; PACF(x=mean_diff,lag_max = 42) |&gt; autoplot()\n\n\n\n\n\n\n\n\n(a) ACF on original value\n\n\n\n\n\n\n\n(b) ACF on first difference value\n\n\n\n\n\n\n\n\n\n(c) PACF on original value\n\n\n\n\n\n\n\n(d) PACF on first difference value\n\n\n\n\nFigure 2.9: ACF and PACF\n\n\n\nDickey–Fuller (ADF) test\n\n\n\nCode\nfinal_df |&gt; na.omit() |&gt; pull(value_diff) |&gt; tseries::adf.test()\n\n\n\n    Augmented Dickey-Fuller Test\n\ndata:  pull(na.omit(final_df), value_diff)\nDickey-Fuller = -12.795, Lag order = 11, p-value = 0.01\nalternative hypothesis: stationary"
  },
  {
    "objectID": "data_ffiec.html#summary",
    "href": "data_ffiec.html#summary",
    "title": "2  Bank Data",
    "section": "2.6 Summary",
    "text": "2.6 Summary\nIn summary, based on exploration of the data we will prepare the data for modelling by:\nSelecting:\n\nTarget measure: Credit Card Plans-30-89 DAYS P/D % (UBPRE524).\nBanks: Large Banks and Large Credit Card Banks.\nDate Period: from 2011 Q3 year which is when we see more of a steady state post regulatory change.\n\nRemoving:\n\nOutlier data points: first 2 quarters.\n\nTransforming:\n\nthe Target measure to make it stationary. We do this by taking the first difference.\n\n\n\n\n\n\n\nBureau, Consumer Financial Protection. 2022. “The Terms of Credit Card Plans (TCCP) Survey.” https://files.consumerfinance.gov/f/documents/cfpb_tccp-data_2022-07-01_2022_12-31.xlsx.\n\n\n———. 2023. “2023 the Consumer Credit Card Market Report.” https://files.consumerfinance.gov/f/documents/cfpb_consumer-credit-card-market-report_2023.pdf.\n\n\nCFPB. 2013. “CARD Act Report: A Review of the Impact of the CARD Act on the Consumer Credit Card Market.” Consumer Financial Protection Bureau. https://files.consumerfinance.gov/f/201309_cfpb_card-act-report.pdf.\n\n\nCFPBb. 2023. “12 CFR Part 1026 - Truth in Lending (Regulation z).” Consumer Financial Protection Bureau. https://www.consumerfinance.gov/rules-policy/regulations/1026/.\n\n\nEconomist. 2023. “Why America Has so Many Banks.” Economist. https://www.economist.com/the-economist-explains/2023/05/26/why-america-has-so-many-banks.\n\n\nFED. 2023. “FR y-14M Capital Assessments and Stress Testing.” Federal Reserve Board. https://www.federalreserve.gov/apps/reportingforms/Report/Index/FR_Y-14M.\n\n\nFFIEC. 2023. “Central Data Repository.” Federal Financial Institutions Examination Council. https://cdr.ffiec.gov/.\n\n\nHyndman, Rob J., and George Athanasopoulos. 2021. Forecasting: Principles and Practice. OTexts. https://otexts.com/fpp3/.\n\n\nHyndman, Rob J., and Yangzhuoran Yang. 2023. “Introduction to the Tsfeatures Package.” https://cran.r-project.org/web/packages/tsfeatures/vignettes/tsfeatures.html.\n\n\nJambulapati, Vikram, and Joanna Stavins. 2013. “The Credit CARD Act of 2009: What Did Banks Do?” https://www.bostonfed.org/-/media/Documents/Workingpapers/PDF/ppdp1307.pdf.\n\n\nReserve, US Federal. 2023. “Charge-Off and Delinquency Rates on Loans and Leases at Commercial Banks.” https://www.federalreserve.gov/releases/chargeoff/delallnsa.htm."
  },
  {
    "objectID": "data_partners.html#sec-partners",
    "href": "data_partners.html#sec-partners",
    "title": "3  Bank Partnerships",
    "section": "3.1 Exploring Partnership Events",
    "text": "3.1 Exploring Partnership Events\nUsing three partnership events as case studies, we can visualise Credit Card Plans-30-89 DAYS P/D % to see if we can observe any changes around the partnership event. There are two dates of interest; the official date of acquisition and the date when cards become available for use. For example, Barclays’s acquisition of GAP Inc. was on May 1, 2022 but it wasn’t until June 20, 2022 that the old Synchrony borrowers could use their new Barclays partnership cards.\nAs mentioned in Section 1.1.1 we may not noticeably see the impact of a partnership event if it is not material to one or both of the Banks involved. To get a sense of the magnitude of the event we can look at the measures: Loans to Individuals..Credit Cards (UBPRB538) and Unused commitments on Credit Cards (UBPR3815). These measures tell us if borrowers utilise their partnership card; a new partnership that brings in a substantial number of new borrowers may not impact delinquency if the borrowers are not using the partnership card.\n\n\nCode\napply_bank_filters = TRUE\napply_reg_filter = TRUE\n\noverdue30to89 &lt;- credit_card.overdue_3089(apply_bank_filters, apply_reg_filter)\nloan_amt &lt;-  credit_card.loan_amount(apply_bank_filters, apply_reg_filter)\nloan_unused &lt;- credit_card.unused(apply_bank_filters, apply_reg_filter)\nloan_amt_pct_change &lt;- loan_amt |&gt; group_by(BankName) |&gt; mutate(pct_change = value_diff/lag(Value) *100) \nloan_unused_pct_change &lt;- loan_unused |&gt; group_by(BankName) |&gt; mutate(pct_change = value_diff/lag(Value) *100) \n\npartner_data &lt;- credit_card.partnerships() \n\npartner_data |&gt; pmap(partnership.plot,overdue30to89, \"Value\", \"median\")\npartner_data |&gt; pmap(partnership.plot,overdue30to89, \"value_diff\", \"median\")\npartner_data |&gt; pmap(partnership.plot,bind_rows(loan_amt,loan_unused), \"Value\", \"median\")\npartner_data |&gt; pmap(partnership.plot,bind_rows(loan_amt_pct_change,loan_unused_pct_change), \"pct_change\", \"median\")\n\n\n\nGapCostcoWalmart\n\n\n\n\n\nFigure 3.1: Credit Card Plans-30-89 DAYS P/D %\n\n\n\n\n\nFigure 3.2: Credit Card Plans-30-89 DAYS P/D % quarterly difference\n\n\n\nMagnitude Measures - ValueMagnitude Measures - Percentage Change\n\n\n\n\n\nFigure 3.3: Magnitude Measures\n\n\n\n\n\n\n\nFigure 3.4: Magnitude Measures\n\n\n\n\n\nsource: (Barclays 2021; and Businesswire 2022)\n\n\n\n\n\nFigure 3.5: Credit Card Plans-30-89 DAYS P/D %\n\n\n\n\n\nFigure 3.6: Credit Card Plans-30-89 DAYS P/D % quarterly difference\n\n\n\nMagnitude Measures - ValueMagnitude Measures - Percentage Change\n\n\n\n\n\nFigure 3.7: Magnitude Measures\n\n\n\n\n\n\n\nFigure 3.8: Magnitude Measures\n\n\n\n\n\nsource: (Businesswire 2016)\n\n\n\n\n\nFigure 3.9: Credit Card Plans-30-89 DAYS P/D %\n\n\n\n\n\nFigure 3.10: Credit Card Plans-30-89 DAYS P/D % quarterly difference\n\n\n\nMagnitude Measures - ValueMagnitude Measures - Percentage Change\n\n\n\n\n\nFigure 3.11: Magnitude Measures\n\n\n\n\n\n\n\nFigure 3.12: Magnitude Measures\n\n\n\n\n\nsource: (Walmart 2018; and Intelligence 2019)"
  },
  {
    "objectID": "data_partners.html#sec-trend-event",
    "href": "data_partners.html#sec-trend-event",
    "title": "3  Bank Partnerships",
    "section": "3.2 Disambiguating Trend vs. Event",
    "text": "3.2 Disambiguating Trend vs. Event\nDepending on the relative quality of the partnership portfolio we may see Credit Card Plans-30-89 DAYS P/D % remain:\n\nStable\nBoth portfolios improve / degrade\nOne improves the other degrades.\n\nFor the GAP and Costco partnerships we can see that the portfolio quality degrades i.e. Credit Card Plans-30-89 DAYS P/D % shows increased delinquency, in both the old and new bank during the transitional period (between acquisition and card availability). This may suggest the partnership portfolio has added riskier borrowers relative to the new bank’s existing portfolio and removed less risky borrowers relative to the old bank’s remaining portfolio. However, this assertion is questionable as the increase we are seeing may just be the trend, shown in grey (calculated as the median across all peer Banks), which also increased during this period.\nAnother factor, as we saw in Figure 2.7 (f), was a tendency for short term reversal, or a reversion to a mean. This may be a factor of banks enacting policies to keep delinquency within their risk tolerance levels. Consequently, where we see an increase after a decrease it may be due in part to this data characteristic.\nWe will look to model the partnership impact by accounting for trend."
  },
  {
    "objectID": "data_partners.html#magnitude-measures",
    "href": "data_partners.html#magnitude-measures",
    "title": "3  Bank Partnerships",
    "section": "3.3 Magnitude measures",
    "text": "3.3 Magnitude measures\nAnecdotal accounts indicate that a spike in Unused commitments before the acquisition date could be due to borrowers paying down their cards, and even closing them, to mitigate concerns around the transition (Reddit 2022). The borrowers who can pay down their loans are likely low-risk, which may result in the portfolio, at the time of the partnership event, looking more risky than it really is (given Credit Card Plans-30-89 DAYS P/D % is a proportion of the credit card loans).\nIncreases in credit card loans in the old bank, as seen in GAP and Walmart, is unexpected. An assumption is that these banks marketed alternative cards to keep borrowers."
  },
  {
    "objectID": "data_partners.html#additional-information-on-partnerships",
    "href": "data_partners.html#additional-information-on-partnerships",
    "title": "3  Bank Partnerships",
    "section": "3.4 Additional information on partnerships",
    "text": "3.4 Additional information on partnerships\nGiven our goal to generalise partnership impacts by FICO and/or Industry we need to use additional public data sources to provide this mapping.\n\n3.4.1 FICO Score and APR\nThe Terms of credit card plans (TCCP) survey (C. F. P. Bureau 2022) provides credit card details including their target FICO Tiers and Annual Percentage Rate (APR). Stavins (2000) found that banks faced an adverse selection problem whereby it was profitable to offer credit card deals with high APR that attracted risker borrowers even though there was evidence of higher delinquency. We can see from TCCP’s 2022 survey in Table 3.2 that the APR does not differ between partnership and bank branded cards.\nStudies point to the fact that banks have matured their risk management capabilities e.g., through improved technology, and this has allowed them to have risk-based pricing. This means that instead of having a single headline APR for a card, banks offer creditworthy customers relatively low interest rates compared with relatively risky customers at higher rates (Mann 2008) and (C. F. P. Bureau 2023). Consequently, we would need borrower level information to properly investigate whether there is a relationship between APR and partnership cards.\nTCCP data download\n\n\nCode\ntccp &lt;- readxl::read_excel(\"data/cfpb_tccp-data_2022-07-01_2022_12-31.xlsx\", skip=9) |&gt;\nfilter(`Availability of Credit Card Plan` == \"National\") |&gt; \ndplyr::select(`Product Name`, Partner, `Institution Name`, `Targeted Credit Tiers`,\nServices,`Other Services`,Rewards,`Other Rewards`,`Website for Consumer`, MaxAPR = `Maximum APR...38`) \n\ntccp |&gt; filter(grepl(\"Walmart|GAP|Apple|Costco|Wayfair|Old Navy|GP\", `Product Name`, ignore.case = TRUE)) \n\n\n\n\n Table 3.1:  Subset of TCCP survey (2022) \n  \n\n\n\n\n\n\nCode\npeer_df &lt;- dplyr::bind_rows(\n            readr::read_delim(\"data/CDR-UBPR_RT6_PEERGROUP_201_2023_12_31.txt\", skip=5,show_col_types = FALSE) |&gt; tibble::add_column(BankType = \"LargeCreditCardBank\"),\n            readr::read_delim(\"data/CDR-UBPR_RT6_PEERGROUP_1_2023_12_31.txt\", skip=5,show_col_types = FALSE) |&gt; tibble::add_column(BankType = \"LargeBank\")\n            ) |&gt; mutate(Name = trimws(Name)) \n\ntccp &lt;- readxl::read_xlsx(\"data/cfpb_tccp-data_2022-07-01_2022_12-31.xlsx\", skip = 9) |&gt; mutate(BankName = trimws(`Institution Name`)) |&gt; relocate(BankName) |&gt;\n    mutate(BankName = case_when(\n                  BankName == \"SYNCHRONY FINANCIAL\" ~ \"SYNCHRONY BANK\",\n                  BankName == \"MERRICK BANK CORPORATION\" ~ \"MERRICK BANK\",\n                  BankName == \"PNC Bank N.A.\" ~ \"PNC BANK, NATIONAL ASSOCIATION\",              \n                  BankName == \"BMO HARRIS BANK NATIONAL ASSOCIATION\" ~  \"BMO BANK NATIONAL ASSOCIATION\",   \n                  .default = BankName\n            )) |&gt;\n  mutate(across(where(is.double), ~na_if(., 9.99))) |&gt; rowwise() |&gt;\n  mutate(MaxAPR=max(across(contains(\"Maximum APR\")), na.rm = TRUE),\n        MedianAPR=max(across(contains(\"Median APR\")), na.rm = TRUE),\n        MinAPR=max(across(contains(\"Mimimum APR\")), na.rm = TRUE))\n              \nfinal_tccp &lt;- peer_df |&gt; left_join(tccp, by = join_by(Name == BankName)) |&gt; \n                mutate(BankName = paste0(Name, \" (\", `ID RSSD`, \")\") ) |&gt; \n                    relocate(BankName) |&gt; \n                    rename(TargetTiers = `Targeted Credit Tiers`) |&gt;\n                        separate_wider_delim(TargetTiers,\" \",names = \"LowestTier\", too_many = \"drop\") \n\ntccp_maxapr &lt;- final_tccp |&gt; \n                mutate(MaxAPR=coalesce(MaxAPR, MedianAPR, MinAPR)) |&gt; relocate(MaxAPR) |&gt; group_by(BankName,BankType, Partner, LowestTier) |&gt; \n                summarise(MaxAPR = mean(MaxAPR,na.rm=TRUE)) |&gt;\n                drop_na(Partner) |&gt;\n                mutate(Partner = if_else(Partner == 1 , \"Yes\", \"No\"),MaxAPR = MaxAPR*100)\n   \ntccp_maxapr |&gt; \n  group_by(BankType, Partner) |&gt; \n  summarise(MaxAPR = mean(MaxAPR, na.rm=TRUE)) |&gt; \n  dplyr::select(`Partnership card` = Partner, `Max APR (%)` = MaxAPR)\n\n\n\n\n Table 3.2:  Median summary APR for partnership cards vs. bank branded cards \n  \n\n\n\n\n\n\nCode\ntccp_maxapr |&gt; \n  mutate(Partner = if_else(Partner == \"Yes\" , \"Partnership\", \"Bank-branded\")) |&gt;\n  ggplot(aes(x=MaxAPR, colour = Partner))+ \n    geom_density() +\n    labs(x=\"Max APR\") + theme_bw() +\n    theme(legend.position=\"top\",legend.title=element_blank())\n\n\n\n\n\nFigure 3.13: Max APR distribution for partnership cards vs. bank branded cards\n\n\n\n\n\n\n3.4.2 Industry Classification\nThe US uses the North American Industry Classification System (NAICS) (U. C. Bureau 2024) which we will utilise at the granularity that provides some grouping. For our use cases NAICS hierarchy level 5 looks promising.\n\n\nCode\nread_csv(\"data/Partner_NAICS.csv\",show_col_types = FALSE)|&gt;\n                rmarkdown::paged_table()  \n\n\n\n\n  \n\n\n\n\n\n\n\n\n\nBarclays. 2021. “Gap Inc. Signs Credit Card Program Agreements with Barclays and Mastercard.” https://cards.barclaycardus.com/banking/about-us/newsroom/gap-inc--signs-credit-card-program-agreements-with-barclays-and-/.\n\n\nBureau, Consumer Financial Protection. 2022. “The Terms of Credit Card Plans (TCCP) Survey.” https://files.consumerfinance.gov/f/documents/cfpb_tccp-data_2022-07-01_2022_12-31.xlsx.\n\n\n———. 2023. “2023 the Consumer Credit Card Market Report.” https://files.consumerfinance.gov/f/documents/cfpb_consumer-credit-card-market-report_2023.pdf.\n\n\nBureau, US Census. 2024. “North American Industry Classification System (NAICS).” https://www.census.gov/naics/.\n\n\nBusinesswire. 2016. “Citi Completes Acquisition and Conversion of Costco u.s. Co-Brand Card Portfolio.” https://www.businesswire.com/news/home/20160620005363/en/Citi-Completes-Acquisition-and-Conversion-of-Costco-U.S.-Co-Brand-Card-Portfolio.\n\n\n———. 2022. “Gap Inc. Launches New Credit Card Program in Partnership with Barclays and Mastercard.” https://www.businesswire.com/news/home/20220608006113/en/Gap-Inc.-Launches-New-Credit-Card-Program-in-Partnership-with-Barclays-and-Mastercard.\n\n\nIntelligence, S&P Global Market. 2019. “Capital One to Acquire Walmart’s Credit Card Receivables.” https://www.spglobal.com/marketintelligence/en/news-insights/trending/VHYZBHXtY1xdBCP2sIlmag2.\n\n\nMann, Ronald J. 2008. “Patterns of Credit Card Use Among Low and Moderate Income Households.” https://scholarship.law.columbia.edu/faculty_scholarship/1528.\n\n\nReddit. 2022. “Gap Card Changing from Synchrony to Barclays.” https://reddit.com/r/CreditCards/comments/t5ihr4/gap_card_changing_from_synchrony_to_barclays/.\n\n\nStavins, Joanna. 2000. “Credit Card Borrowing, Delinquency, and Personal Bankruptcy.” https://www.bostonfed.org/publications/new-england-economic-review/2000-issues/issue-july-august-2000/credit-card-borrowing-deliquency-and-personal-bankruptcy.aspx.\n\n\nWalmart. 2018. “Walmart and Capital One Sign Credit Card Program Agreement.” https://corporate.walmart.com/news/2018/07/26/walmart-and-capital-one-sign-credit-card-program-agreement."
  },
  {
    "objectID": "data_fed.html#us-economic-data",
    "href": "data_fed.html#us-economic-data",
    "title": "4  Explanatory Data",
    "section": "4.1 US Economic Data",
    "text": "4.1 US Economic Data\nAs discussed in Section 3.2 the impact of the partnership event can be masked by trends and seasonality.\nThe simplest model approach we look at is the Market model, see Section 6.1, which involves adjusting each Bank’s Credit Card Plans-30-89 DAYS P/D % by removing the influence of the broader trend within its respective group (Large Banks or Large Credit Card Banks). We assume the residuals are due to the unique characteristics of each Bank’s credit card portfolio. These characteristics might include the bank’s specific credit policies, customer risk profiles, or portfolio management strategies.\nThis approach assumes that the broader “market” trend takes into account, to some extent, the impact of macroeconomic variables. However, we may want to include macroeconomic variables to improve the model’s ability to explain credit card delinquencies that are not captured by the group trend alone.\nUS Federal Reserve Economic Data (2023) provides macroeconomic data series; we can use published literature and new analysis to inform our choice of variables.\nThe figures below plot data series related to consumer financial behaviour before and after the 2008 financial crisis and the enactment of the Credit Card Accountability Responsibility and Disclosure (CARD) Act in 2010 (see Section 2.3). We can see that the onset of the COVID-19 pandemic marks a distinct phase of economic upheaval.\nEach variable has been adjusted for population changes and inflation to ensure we can compare across different time periods.\nGrieb, Hegji, and Jones (2001), over the period 1981 to 1999, found that delinquency is positively correlated with the consumer debt service ratio, which is the ability for borrowers to service their consumer loans relative to disposable income. Consumer loans include credit cards, other revolving credit and term loans. In the decade that ensued post 2008 crisis, there is a noticeable trend of increasing personal expenditures and although personal incomes also increase, their rate of increase does not match that of expenditures. This divergence results in a gradual rise in the consumer debt service ratio (CDSP), indicating an expanding gap between income and debt obligations. Notably, this isn’t reflected in credit card delinquency rates which remain relatively stable suggesting consumer debt is no longer a strong determinant of delinquency by itself. The broader measure, household debt (TDSP), which is consumer debt plus mortgage loans, may be a more informative of measure of a household’s overall financial health. We can see in Figure 4.3 that household debt was decreasing while consumer debt increased.\nLiu and Agarwal (2003), using proprietary credit card data of 700 thousand customers from 1995 to 2001, concluded that unemployment is a key determinant of consumer delinquency and bankruptcy. However, Taghiyeh, Lengacher, and Handfield (2021) in their 2021 study concluded that unemployment is no longer sufficient. This can be seen in Figure 4.4 where post 2008 financial crisis delinquency decreased as unemployment decreased but has since remained relatively stable as unemployment as decreased further. Taghiyeh, Lengacher, and Handfield (2021) found the most significant variables to predict credit card loss was: previous quarter Unemployment, Building permits and Initial unemployment insurance claims; previous year’s (lag 4) Money stock and ISM Purchasing Mangers Index and the current quarter’s Weekly hours worked by manufacturing workers.\n\nCombinedLarge BankLarge Credit Card Bank\n\n\n\n\nCode\nplot_us_category(\"Expenditures\",us_measures_qtr, overdue30to89.all, \"value.all.median\")\nplot_us_category(\"Income & Savings\",us_measures_qtr, overdue30to89.all, \"value.all.median\")\nplot_us_category(\"Debt\",us_measures_qtr, overdue30to89.all, \"value.all.median\")\nplot_us_category(\"Economy\",us_measures_qtr, overdue30to89.all, \"value.all.median\")\n\n    # measures = us_measures_qtr\n    # target_data = overdue30to89.all \n    # target_measure = \"value.all.median\"\n\n    # target_label &lt;-credit_card.target_label()\n    # index_var &lt;- index_var(measures)\n    # recessions &lt;- us_economy.recession() |&gt; \n    #                 filter(Flag == 1, \n    #                        Month &gt;= ym(\"1989-10\"))\n    # data &lt;- measures |&gt; drop_na() |&gt;\n    #           mutate(across(!as.name(index_var), scale))\n    # max_y &lt;- max_tstibble(data)     \n\n    # data |&gt;        \n    #     pivot_longer(cols = !Quarter) |&gt;\n    #     left_join(us_economy.labels(), by = join_by(name==Name)) |&gt;\n    #     filter(name %in% c(\"UNRATE\", \"TDSP\",\"CDSP\")) |&gt;\n    #     mutate(comb_label = paste(name, \"-\", Desc, \"(\", Formula, \")\")) |&gt;\n    #     ggplot(aes(x = Quarter, y = value, colour = comb_label)) + \n    #     geom_line() +theme_bw() +\n    #     theme(legend.direction = \"vertical\",legend.position = \"top\", legend.title=element_blank(),\n    #           plot.title = element_markdown(size = 12),\n    #           plot.subtitle = element_text(size = 9)) +\n    #     labs(y = \"Normalised (Normal=0)\",\n    #         title = glue(\"Macroeconomic measures against median &lt;span style='color:darkred'&gt;**{target_label}**&lt;/span&gt;\"),\n    #         subtitle = \"Recessions shown in boxed area\") +     \n    #     geom_rect(data = recessions,inherit.aes = FALSE, \n    #               aes(xmin = Month, xmax = Month + 30, ymin = -Inf, ymax = Inf), fill = \"lightgrey\", alpha = 0.5) +\n    #     geom_line(mapping = aes(y = !!as.name(target_measure)), data = target_data,\n    #               colour = 'darkred') +\n    #     geom_vline(xintercept = as.numeric(yq(get_regulation_cutoff())), linetype=3,colour=\"darkred\") +\n    #     annotate(\"text\", x=as.numeric(yq(get_regulation_cutoff())), y=max_y-1, size = 9/.pt, label=\"Credit Card Regulations\",vjust = 0.5, hjust = -0.15, colour = \"black\") +\n    #     scale_colour_colorblind7()          \n\n\n\n\n\nFigure 4.1: Expenditure Measures\n\n\n\n\n\n\n\nFigure 4.2: Income & Savings Measures\n\n\n\n\n\n\n\nFigure 4.3: Debt Measures\n\n\n\n\n\n\n\nFigure 4.4: Unemployment and Confidence Measures\n\n\n\n\n\n\n\n\nCode\nplot_us_category(\"Expenditures\", us_measures_qtr, overdue30to89.all.lbank, \"value.group.median\")\nplot_us_category(\"Income & Savings\", us_measures_qtr, overdue30to89.all.lbank, \"value.group.median\")\nplot_us_category(\"Debt\", us_measures_qtr, overdue30to89.all.lbank, \"value.group.median\")\nplot_us_category(\"Economy\", us_measures_qtr, overdue30to89.all.lbank, \"value.group.median\")\n\n\n\n\n\nFigure 4.5: Expenditure Measures\n\n\n\n\n\n\n\nFigure 4.6: Income & Savings Measures\n\n\n\n\n\n\n\nFigure 4.7: Debt Measures\n\n\n\n\n\n\n\nFigure 4.8: Unemployment and Confidence Measures\n\n\n\n\n\n\n\n\nCode\nplot_us_category(\"Expenditures\", us_measures_qtr, overdue30to89.all.lcbank, \"value.group.median\")\nplot_us_category(\"Income & Savings\", us_measures_qtr, overdue30to89.all.lcbank, \"value.group.median\")\nplot_us_category(\"Debt\", us_measures_qtr, overdue30to89.all.lcbank, \"value.group.median\")\nplot_us_category(\"Economy\", us_measures_qtr, overdue30to89.all.lcbank, \"value.group.median\")\n\n\n\n\n\nFigure 4.9: Expenditure Measures\n\n\n\n\n\n\n\nFigure 4.10: Income & Savings Measures\n\n\n\n\n\n\n\nFigure 4.11: Debt Measures\n\n\n\n\n\n\n\nFigure 4.12: Unemployment and Confidence Measures\n\n\n\n\n\n\n\n\n4.1.1 Statistical tests\nIn time series analysis we can use tests like Cross-Correlation Function (CCF) and Granger Test to understand relationships between variables.\n\n4.1.1.1 Granger Test\nIntuitively, changes in the macroeconomic environment will take time to impact credit card delinquency. We can test for significance of different lags using the Granger test for each variable.\n“X is said to Granger-cause Y if Y can be better predicted using the histories of both X and Y than it can by using the history of Y alone.”(Giles 2011)\nThe tables presented below, show the macroeconomic variable and lag (Df column) that Granger-cause Credit Card Plans-30-89 DAYS P/D % (Y).\n\nCombinedLarge BankLarge Credit Card Bank\n\n\n\n\nCode\ngranger_test_permutations(data = overdue30to89.post |&gt; left_join (us_measures_qtr,by = join_by(Quarter)), \n                            target_col_name = \"value.all.median\",\n                            exog_names = names(us_measures_qtr),\n                            max_lag = 4) |&gt; list_rbind() |&gt; left_join(us_economy.labels(), join_by(exog_variable==Name)) |&gt; dplyr::select(-c(Formula, Category)) |&gt; rmarkdown::paged_table()\ngranger_test_permutations(data = overdue30to89.post |&gt; filter_index(~ \"2020\") |&gt; left_join (us_measures_qtr,by = join_by(Quarter)), \n                            target_col_name = \"value.all.median\",\n                            exog_names = names(us_measures_qtr),\n                            max_lag = 4) |&gt; list_rbind() |&gt; left_join(us_economy.labels(), join_by(exog_variable==Name)) |&gt; dplyr::select(-c(Formula, Category)) |&gt; rmarkdown::paged_table()\n\n\n\nTable 4.1: Granger Test at Lags 1 to 4\n\n\n\n\n\n (a) Post regulatory period \n  \n\n\n?(caption)\n\n\n\n\n\n\n (b) Pre-pandemic post regulatory period \n  \n\n\n?(caption)\n\n\n\n\n\n\n\n\nCode\ngranger_test_permutations(data = overdue30to89.post.lbank |&gt; left_join (us_measures_qtr,by = join_by(Quarter)), \n                            target_col_name = \"value.group.median\",\n                            exog_names = names(us_measures_qtr),\n                            max_lag = 4) |&gt; list_rbind() |&gt; left_join(us_economy.labels(), join_by(exog_variable==Name)) |&gt; dplyr::select(-c(Formula, Category)) |&gt; rmarkdown::paged_table()  \ngranger_test_permutations(data = overdue30to89.post.lbank |&gt; filter_index(~ \"2020\") |&gt; left_join (us_measures_qtr,by = join_by(Quarter)), \n                            target_col_name = \"value.group.median\",\n                            exog_names = names(us_measures_qtr),\n                            max_lag = 4) |&gt; list_rbind() |&gt; left_join(us_economy.labels(), join_by(exog_variable==Name)) |&gt; dplyr::select(-c(Formula, Category)) |&gt; rmarkdown::paged_table()  \n\n\n\nTable 4.2: Granger Test at Lags 1 to 4\n\n\n\n\n\n (a) Post regulatory period \n  \n\n\n?(caption)\n\n\n\n\n\n\n (b) Pre-pandemic post regulatory period \n  \n\n\n?(caption)\n\n\n\n\n\n\n\n\nCode\ngranger_test_permutations(data = overdue30to89.post.lcbank |&gt; left_join (us_measures_qtr,by = join_by(Quarter)), \n                            target_col_name = \"value.group.median\",\n                            exog_names = names(us_measures_qtr),\n                            max_lag = 4) |&gt; list_rbind() |&gt; left_join(us_economy.labels(), join_by(exog_variable==Name)) |&gt; dplyr::select(-c(Formula, Category)) |&gt; rmarkdown::paged_table()  \ngranger_test_permutations(data = overdue30to89.post.lcbank |&gt; filter_index(~ \"2020\") |&gt; left_join (us_measures_qtr,by = join_by(Quarter)), \n                            target_col_name = \"value.group.median\",\n                            exog_names = names(us_measures_qtr),\n                            max_lag = 4) |&gt; list_rbind() |&gt; left_join(us_economy.labels(), join_by(exog_variable==Name)) |&gt; dplyr::select(-c(Formula, Category)) |&gt; rmarkdown::paged_table()                              \n\n\n\nTable 4.3: Granger Test at Lags 1 to 4\n\n\n\n\n\n (a) Post regulatory period \n  \n\n\n?(caption)\n\n\n\n\n\n\n (b) Pre-pandemic post regulatory period \n  \n\n\n?(caption)\n\n\n\n\n\n\n\n\n\n4.1.1.2 Cross-Correlation Function\nThe Cross-Correlation function measures the correlation between series X at time \\(t+k\\) and series Y at time \\(t\\), for various lags \\(k\\). A positive \\(k\\) indicates future values of X relative to Y, conversely, a negative \\(k\\) indicates past values of X relative to Y.\nBelow tests various macroeconomic variables (X) against Credit Card Plans-30-89 DAYS P/D % (Y).\n\nCombinedLarge BankLarge Credit Card Bank\n\n\n\n\nCode\nrun_ccf_test(data = overdue30to89.post |&gt; left_join (us_measures_qtr,by = join_by(Quarter)),\n             target_variable = \"value.all.median\",\n             exog_variable = \"RRSFS.Pop\",\n             do_difference = TRUE)\n\nrun_ccf_test(data = overdue30to89.post |&gt; left_join (us_measures_qtr,by = join_by(Quarter)),\n             target_variable = \"value.all.median\",\n             exog_variable = \"CDSP\",\n             do_difference = TRUE)    \n\nrun_ccf_test(data = overdue30to89.post |&gt; left_join (us_measures_qtr,by = join_by(Quarter)),\n             target_variable = \"value.all.median\",\n             exog_variable = \"TDSP\",\n             do_difference = TRUE)    \n\nrun_ccf_test(data = overdue30to89.post |&gt; left_join (us_measures_qtr,by = join_by(Quarter)),\n             target_variable = \"value.all.median\",\n             exog_variable = \"UNRATE\",\n             do_difference = TRUE)                          \n\n\n\n\n\n\n\n\n(a) RRSFS.Pop - Real Advance Retail and Food Services Sales per capita\n\n\n\n\n\n\n\n(b) CDSP - Consumer Debt Service Payments as a Percent of Disposable Personal Income\n\n\n\n\n\n\n\n\n\n(c) TDSP - Household Debt Service Payments as a Percent of Disposable Personal Income\n\n\n\n\n\n\n\n(d) UNRATE - Unemployment Rate\n\n\n\n\nFigure 4.13: Cross-Correlation Function\n\n\n\n\n\n\n\nCode\nrun_ccf_test(data = overdue30to89.post.lbank |&gt; left_join (us_measures_qtr,by = join_by(Quarter)),\n             target_variable = \"value.group.median\",\n             exog_variable = \"RRSFS.Pop\",\n             do_difference = TRUE)\n\nrun_ccf_test(data = overdue30to89.post.lbank |&gt; left_join (us_measures_qtr,by = join_by(Quarter)),\n             target_variable = \"value.group.median\",\n             exog_variable = \"CDSP\",\n             do_difference = TRUE)    \n\nrun_ccf_test(data = overdue30to89.post.lbank |&gt; left_join (us_measures_qtr,by = join_by(Quarter)),\n             target_variable = \"value.group.median\",\n             exog_variable = \"TDSP\",\n             do_difference = TRUE)                 \n\nrun_ccf_test(data = overdue30to89.post.lbank |&gt; left_join (us_measures_qtr,by = join_by(Quarter)),\n             target_variable = \"value.group.median\",\n             exog_variable = \"UNRATE\",\n             do_difference = TRUE)                          \n\n\n\n\n\n\n\n\n(a) RRSFS.Pop - Real Advance Retail and Food Services Sales per capita\n\n\n\n\n\n\n\n(b) CDSP - Consumer Debt Service Payments as a Percent of Disposable Personal Income\n\n\n\n\n\n\n\n\n\n(c) TDSP - Household Debt Service Payments as a Percent of Disposable Personal Income\n\n\n\n\n\n\n\n(d) UNRATE - Unemployment Rate\n\n\n\n\nFigure 4.14: Cross-Correlation Function\n\n\n\n\n\n\n\nCode\nrun_ccf_test(data = overdue30to89.post.lcbank |&gt; left_join (us_measures_qtr,by = join_by(Quarter)),\n             target_variable = \"value.group.median\",\n             exog_variable = \"RRSFS.Pop\",\n             do_difference = TRUE)\n\nrun_ccf_test(data = overdue30to89.post.lcbank |&gt; left_join (us_measures_qtr,by = join_by(Quarter)),\n             target_variable = \"value.group.median\",\n             exog_variable = \"CDSP\",\n             do_difference = TRUE)    \n\nrun_ccf_test(data = overdue30to89.post.lcbank |&gt; left_join (us_measures_qtr,by = join_by(Quarter)),\n             target_variable = \"value.group.median\",\n             exog_variable = \"TDSP\",\n             do_difference = TRUE)    \n\nrun_ccf_test(data = overdue30to89.post.lcbank |&gt; left_join (us_measures_qtr,by = join_by(Quarter)),\n             target_variable = \"value.group.median\",\n             exog_variable = \"UNRATE\",\n             do_difference = TRUE)                                  \n\n\n\n\n\n\n\n\n(a) RRSFS.Pop - Real Advance Retail and Food Services Sales per capita\n\n\n\n\n\n\n\n(b) CDSP - Consumer Debt Service Payments as a Percent of Disposable Personal Income\n\n\n\n\n\n\n\n\n\n(c) TDSP - Household Debt Service Payments as a Percent of Disposable Personal Income\n\n\n\n\n\n\n\n(d) UNRATE - Unemployment Rate\n\n\n\n\nFigure 4.15: Cross-Correlation Function\n\n\n\n\n\n\n\n4.1.1.2.1 Cross-Correlation between macro economic variables\nFigure 4.16 (a) and Figure 4.16 (b) assumes Real Advance Retail and Food Services Sales per capita (RRSFS.Pop) is our dependant variable (Y). we observe significant correlations at both positive and negative lags. This pattern indicates a bidirectional or feedback relationship between X and the dependent variable Y. For example, Figure 4.16 (b) shows significant correlation at -1 lag suggesting that changes in unemployment have an impact on retail and food sales in the next quarter. But there’s also a weaker but significant correlation at +1 which suggests a change in retail and food sales impacts unemployment in the following quarter. To remove the potential risk of multicollinearity we would only have one of these variables included in the same model.\n\n\nCode\nrun_ccf_test(data = us_measures_qtr,\n             target_variable = \"RRSFS.Pop\",\n             exog_variable = \"CDSP\",\n             do_difference = TRUE)\n\nrun_ccf_test(data = us_measures_qtr,\n             target_variable = \"RRSFS.Pop\",\n             exog_variable = \"UNRATE\",\n             do_difference = TRUE)                  \n\nrun_ccf_test(data = us_measures_qtr,\n             target_variable = \"CDSP\",\n             exog_variable = \"UNRATE\",\n             do_difference = TRUE)    \n\n\n\n\n\n\n\n\n(a) CCF for RRSFS.Pop (Y) and CDSP (X)\n\n\n\n\n\n\n\n(b) CCF for RRSFS.Pop (Y) and UNRATE (X)\n\n\n\n\n\n\n\n\n\n(c) CCF for CDSP (Y) and UNRATE (X)\n\n\n\n\nFigure 4.16: Cross-Correlation Function"
  },
  {
    "objectID": "data_fed.html#portfolio-data",
    "href": "data_fed.html#portfolio-data",
    "title": "4  Explanatory Data",
    "section": "4.2 Portfolio Data",
    "text": "4.2 Portfolio Data\nBanks have the capability to influence both the quantity and quality of their credit card portfolios. By adjusting their risk appetite, banks can navigate economic downturns more effectively; for instance, by tightening lending criteria.\nSimilarly, borrowers’ payment behaviours can evolve. Cole (2016) monitored the same individuals’ credit card usage and employment status over time, revealed that borrowers tend to reduce their reliance on credit cards when they are unemployed.\nTo further understand delinquency, we can employ portfolio-level explanatory variables, such as unused credit commitments and the volume of credit card loans. For instance, an uptick in delinquency rates, absent any alterations in the portfolio, could signal macroeconomic factors affecting current borrowers. Conversely, changes within the portfolio might suggest different causes, such as a strategic decision to capture more market share by adding higher-risk borrowers - including via a partnership.\n\n4.2.1 Statistical tests\n\n4.2.1.1 Granger Test\n\nCombinedLarge BankLarge Credit Card Bank\n\n\n\n\nCode\ngranger_test_permutations(data = ubpr_data.all |&gt; filter(), \n                            target_col_name = \"UBPRE524\",\n                            exog_names = exog_measures,\n                            max_lag = 4) |&gt; list_rbind() |&gt; left_join(ubpr_labs, join_by(exog_variable==UBPR_Code)) |&gt; rmarkdown::paged_table()  \n\n\n\n Granger Test at Lags 1 to 4 (post regulatory period)\n  \n\n\n\n\n\n\n\nCode\ngranger_test_permutations(data = ubpr_data.lbank |&gt; filter(), \n                            target_col_name = \"UBPRE524\",\n                            exog_names = exog_measures,\n                            max_lag = 4) |&gt; list_rbind() |&gt; left_join(ubpr_labs, join_by(exog_variable==UBPR_Code)) |&gt; rmarkdown::paged_table()  \n\n\n\n Granger Test at Lags 1 to 4 (post regulatory period)\n  \n\n\n\n\n\n\n\nCode\ngranger_test_permutations(data = ubpr_data.lcbank |&gt; filter(), \n                            target_col_name = \"UBPRE524\",\n                            exog_names = exog_measures,\n                            max_lag = 4) |&gt; list_rbind() |&gt; left_join(ubpr_labs, join_by(exog_variable==UBPR_Code)) |&gt; rmarkdown::paged_table()  \n\n\n\n Granger Test at Lags 1 to 4 (post regulatory period)\n  \n\n\n\n\n\n\n\n\n4.2.1.2 Cross-Correlation Function\n\nCombinedLarge BankLarge Credit Card Bank\n\n\n\n\nCode\nexog_measures |&gt; map(\\(x) run_ccf_test(data = ubpr_data.all,\n             target_variable = \"UBPRE524\",\n             exog_variable = x,\n             do_difference = TRUE))\n\n\n\n\n\n\n\n\n(a) UBPRE425: Credit Card Loans, % Gross LN&LS\n\n\n\n\n\n\n\n(b) UBPRE263: Unused Commitments on Credit Cards as a percent of Total Assets\n\n\n\n\n\n\n\n\n\n(c) UBPR3815: Unused Commitments on Credit Cards\n\n\n\n\n\n\n\n(d) UBPRB538: Loans to Individuals for Household, Family, and Other Personal Expenditures:Credit Cards\n\n\n\n\nFigure 4.17: Cross-Correlation Function\n\n\n\n\n\n\n\nCode\nexog_measures |&gt; map(\\(x) run_ccf_test(data = ubpr_data.lbank,\n             target_variable = \"UBPRE524\",\n             exog_variable = x,\n             do_difference = TRUE))\n\n\n\n\n\n\n\n\n(a) UBPRE425: Credit Card Loans, % Gross LN&LS\n\n\n\n\n\n\n\n(b) UBPRE263: Unused Commitments on Credit Cards as a percent of Total Assets\n\n\n\n\n\n\n\n\n\n(c) UBPR3815: Unused Commitments on Credit Cards\n\n\n\n\n\n\n\n(d) UBPRB538: Loans to Individuals for Household, Family, and Other Personal Expenditures:Credit Cards\n\n\n\n\nFigure 4.18: Cross-Correlation Function\n\n\n\n\n\n\n\nCode\nexog_measures |&gt; map(\\(x) run_ccf_test(data = ubpr_data.lcbank,\n             target_variable = \"UBPRE524\",\n             exog_variable = x,\n             do_difference = TRUE))\n\n\n\n\n\n\n\n\n(a) UBPRE425: Credit Card Loans, % Gross LN&LS\n\n\n\n\n\n\n\n(b) UBPRE263: Unused Commitments on Credit Cards as a percent of Total Assets\n\n\n\n\n\n\n\n\n\n(c) UBPR3815: Unused Commitments on Credit Cards\n\n\n\n\n\n\n\n(d) UBPRB538: Loans to Individuals for Household, Family, and Other Personal Expenditures:Credit Cards\n\n\n\n\nFigure 4.19: Cross-Correlation Function\n\n\n\n\n\n\n\n\n\n\n\n\nCole, Allison. 2016. “Do Consumers Rely More Heavily on Credit Cards While Unemployed?” https://www.bostonfed.org/publications/research-data-report/2016/do-consumers-rely-more-heavily-on-credit-cards-while-unemployed.aspx.\n\n\nGiles, Dave. 2011. “Testing for Granger Causality.” https://davegiles.blogspot.com/2011/04/testing-for-granger-causality.html.\n\n\nGrieb, Terrance, Charles Hegji, and Steven T. Jones. 2001. “Macroeconomic Factors, Consumer Behavior, and Bankcard Default Rates.” Journal of Economics and Finance 25 (3): 316–27. https://doi.org/10.1007/BF02745892.\n\n\nLiu, Chunlin, and Sumit Agarwal. 2003. “Determinants of Credit Card Delinquency and Bankruptcy: Macroeconomic Factors.” Journal of Economics and Finance 27 (March): 75–84. https://doi.org/10.1007/BF02751591.\n\n\nSt. Louis, Federal Reserve Bank of. 2023. “Federal Reserve Economic Data.” Federal Reserve Bank of St. Louis. https://fred.stlouisfed.org/.\n\n\nTaghiyeh, Sajjad, David C. Lengacher, and Robert B. Handfield. 2021. “Loss Rate Forecasting Framework Based on Macroeconomic Changes: Application to US Credit Card Industry.” Expert Systems With Applications 165. https://doi.org/10.1016/j.eswa.2020.113954."
  },
  {
    "objectID": "model_event.html#sec-data-split",
    "href": "model_event.html#sec-data-split",
    "title": "5  Event Studies",
    "section": "5.1 Estimation and Observation Data",
    "text": "5.1 Estimation and Observation Data\nFollowing the process described by Huntington-Klein (2022, chap 17.2.1), we pick an “estimation period” and an “observation period”.\nThe observation period chosen is the quarter of the event + 5 quarters after the event. Based on partnership agreement the portfolio can be transferred with delinquent borrowers on day one (e.g., Barclays 2021) or the impact may be some quarters after the acquisition as borrowers receive and start using their new partner cards. It will take least 30 days to determine if any of these borrowers are delinquent.\n\n\n\n\n\n\nBarclays. 2021. “Gap Inc. Signs Credit Card Program Agreements with Barclays and Mastercard.” https://cards.barclaycardus.com/banking/about-us/newsroom/gap-inc--signs-credit-card-program-agreements-with-barclays-and-/.\n\n\nHuntington-Klein, Nick. 2022. The Effect: An Introduction to Research Design and Causality. CRC Press. https://theeffectbook.net/."
  },
  {
    "objectID": "model_market.html#sec-model-market",
    "href": "model_market.html#sec-model-market",
    "title": "6  Market Model",
    "section": "6.1 Specification",
    "text": "6.1 Specification\nTo determine the normal return we can adopt the market model (MacKinlay 1997) \\[\nD_{it} = \\alpha_i + \\beta_i D_{gt} + \\epsilon_{it}\n\\]\nAnd the AR is the Observed Return - Predicted Return \\[\nAR_{it} = D_{it} – (\\alpha_i + \\beta_i D_{gt})\n\\]\nWhere:\n\\(D_{it}\\) is Credit Card Plans-30-89 DAYS P/D % \\(i\\) at time \\(t\\),\n\\(\\alpha_i\\) is the firm-specific intercept,\n\\(\\beta_i\\) is the coefficient measuring the sensitivity of firm value \\(i\\) to the group \\(g\\),\n\\(D_{gt}\\) is the group Credit Card Plans-30-89 DAYS P/D % at time \\(t\\), and\n\\(\\varepsilon_{it}\\) is the error term for \\(i\\) at time \\(t\\)."
  },
  {
    "objectID": "model_market.html#model-results",
    "href": "model_market.html#model-results",
    "title": "6  Market Model",
    "section": "6.2 Model Results",
    "text": "6.2 Model Results\n\n\nCode\nmodel_data &lt;- get_model_data()\ndata &lt;- model_data$all_data\nestimation_data &lt;- model_data$estimation_data\nobservation_data &lt;- model_data$observation_data\npartner_banks &lt;- credit_card.partnerships.long()\n\nmarket_formula &lt;- \"UBPRE524.diff ~ UBPRE524.group.log.diff\"\nm_table &lt;- estimation_data |&gt; fill_gaps() |&gt; model(tslm = TSLM(as.formula(market_formula)))\n\naugmented_data &lt;- m_table |&gt; augment()\n\n\n\n6.2.1 Estimated Fit\nAs outlined in Section 5.1, we have split our data into estimation and observation periods. For firms that do not have partnership events, the full data series is used in the estimation period. For firms with partnership events the estimation period is up to the quarter before each event.\nIf the market model demonstrates a robust fit with the estimation data, this instils confidence in our ability to forecast the “normal” return using the unseen data from the observation period.\nFigure 6.1 displays fitted vs actual results for a sub-set of firms. The Intercept and Coefficient is displayed in Table 6.2. The model is\n\n\nCode\naugmented_data |&gt; filter(BankName %in% unique(observation_data$BankName)) |&gt;\n        plot_model_fit(\"UBPRE524.diff\")\n\n\n\n\n\nFigure 6.1: Fitted vs. Observed for estimation data on sub-set of firms\n\n\n\n\n\n\nCode\nm_table |&gt; filter(BankName %in% observation_data$BankName) |&gt; glance() |&gt; relocate(BankName, AICc, AIC) |&gt; dplyr::select(-c(IDRSSD,.model))|&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,4))) |&gt;  \n    rmarkdown::paged_table()  \n\n\n\n\n Table 6.1:  AICc Summary for sub-set of banks \n  \n\n\n\n\nIn Table 6.2 we can see the standard error of UBPRE524.group.log.diff is small relative to its estimate indicating a precise estimate. A small p-value (typically &lt;0.05) suggests strong evidence against the null hypothesis, indicating that UBPRE524.group.log.diff is statistically significant.\n\n\nCode\nm_table |&gt; filter(BankName %in% unique(observation_data$BankName)) |&gt; \n  tidy() |&gt; dplyr::select(BankName, term:last_col())|&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,4))) |&gt;  \n    rmarkdown::paged_table()\n\n\n\n\n Table 6.2:  Intercept and coefficients \n  \n\n\n\n\n\n\n6.2.2 Residual diagnostics\nResiduals should have the following properties (Hyndman and Athanasopoulos 2021, ch. 5.4). Residuals:\n\nAre uncorrelated. Correlations indicate that the model is missing information left in the residuals.\nHave zero mean. If they have a mean other than zero, then the forecasts are biased.\nHave constant variance i.e. does not violate “homoscedasticity” assumption.\nAre normally distributed.\n\n\nCITIBANKSYNCHRONYBARCLAYSAMERICAN EXPRESSCAPITAL ONE\n\n\n\n\nCode\nbank &lt;- \"CITIBANK\"\nm_table |&gt; filter(grepl(bank,BankName)) |&gt; dplyr::select(tslm) |&gt; gg_tsresiduals()  \nplot_cc_measures(bank, estimation_data,ubpr_labels)\n\n\n\n\n\nFigure 6.2: The time plot of the residuals shows that the variation of the residuals is relatively constant but with one significant outlier. The acf shows residuals are uncorrelated, and the residuals look normal with the exception of the outlier.\n\n\n\n\n\n\n\nFigure 6.3: Explaining the outlier: Delinquency dropped at a time when CITIBANK’s credit card portfolio became a larger business concern (c). The borrowers added appear to be less risky as we see the unused proportion go from below 10% to over 40% in (b)\n\n\n\n\n\n\n\n\nCode\nbank &lt;- \"SYNCHRONY\"\nm_table |&gt; filter(grepl(bank,BankName)) |&gt; dplyr::select(tslm) |&gt; gg_tsresiduals()  \nplot_cc_measures(bank, estimation_data,ubpr_labels)\n\n\n\n\n\nFigure 6.4: The time plot of the residuals shows a couple of outliers at the start of the time period and in 2018 Q1. The acf shows residuals are uncorrelated, and the residuals look normal with the exception of the outliers.\n\n\n\n\n\n\n\nFigure 6.5: Comparative credit card portfolio variables\n\n\n\n\n\n\n\n\nCode\nbank &lt;- \"BARCLAYS\"\nm_table |&gt; filter(grepl(bank,BankName)) |&gt; dplyr::select(tslm) |&gt; gg_tsresiduals()  \nplot_cc_measures(bank, estimation_data,ubpr_labels)\n\n\n\n\n\nFigure 6.6: The time plot of the residuals shows that the variation of the residuals is relatively constant up until the onset of the COVID-19 pandemic in 2020; the model needs more information to account for this period. The acf shows residuals are uncorrelated\n\n\n\n\n\n\n\nFigure 6.7: Comparative credit card portfolio variables\n\n\n\n\n\n\n\n\nCode\nbank &lt;- \"AMERICAN EXPRESS NATIONAL BANK\"\nm_table |&gt; filter(grepl(bank,BankName)) |&gt; dplyr::select(tslm) |&gt; gg_tsresiduals()  \nplot_cc_measures(bank, estimation_data,ubpr_labels)\n\n\n\n\n\nFigure 6.8: The acf shows significant correlation indicating the model has not fully captured the underlying data patterns. The residuals look normal.\n\n\n\n\n\n\n\nFigure 6.9: Comparative credit card portfolio variables\n\n\n\n\n\n\n\n\nCode\nbank &lt;- \"CAPITAL ONE\"\nm_table |&gt; filter(grepl(bank,BankName)) |&gt; dplyr::select(tslm) |&gt; gg_tsresiduals()  \nplot_cc_measures(bank, estimation_data, ubpr_labels)\n\n\n\n\n\nFigure 6.10: The time plot of the residuals shows that the variation of the residuals is relatively constant. The residuals look normal with the exception of the outliers. The acf shows significant correlation every 2 lags indicating the model has not fully captured the underlying data patterns.\n\n\n\n\n\n\n\nFigure 6.11: Comparative credit card portfolio variables\n\n\n\n\n\n\n\n\n\n6.2.3 Residuals White Noise\nThe sub-set of banks analysed in Section 6.2.2 did not exhibit significant autocorrelation.\nTable 6.3 lists banks where we reject the null hypothesis of the Ljung–Box test, indicating the presence of significant autocorrelation in the residuals.\nBanks not listed have residuals that are indistinguishable from a white noise series i.e. have uncorrelated observations and with constant variance.\n\n\nCode\naugmented_data  |&gt;\n  features(.innov, ljung_box) |&gt; mutate(across(where(is.numeric), \\(x) round(x,4))) |&gt; \n    filter(lb_pvalue &lt;= 0.05)|&gt; dplyr::select(BankName,lb_stat,lb_pvalue) |&gt;\n      rmarkdown::paged_table()\n\n\n\n\n Table 6.3:  Ljung–Box results where P-value &lt; Significance Level of 0.05"
  },
  {
    "objectID": "model_market.html#time-series-cross-validation",
    "href": "model_market.html#time-series-cross-validation",
    "title": "6  Market Model",
    "section": "6.3 Time Series Cross-Validation",
    "text": "6.3 Time Series Cross-Validation\nOne approach to evaluate the predictive performance of our model is to use One-step ahead cross-validation, also known as walk-forward validation, which is specifically designed for time series. This approach involves progressively moving forward in time, making predictions one step ahead. To quantify the accuracy of predictions made during this process, the Root Mean Square Error (RMSE) and Mean Absolute Error (MAE) is commonly used. RMSE measures the average magnitude of the errors between the predicted and actual values, giving more weight to larger errors due to its squaring component. MAE is the average of the absolute differences between the predicted values and actual values so is not as sensitive to outliers.\nThe results Table 6.4 show that the RMSE and MAE of the cross-validated models (CV) closely matches the RMSE and MAE observed in the initial model evaluation (Training). This indicates that the model is generalising well to unseen data and not overfitting.\n\n\nCode\nm_table |&gt; fabletools::accuracy()|&gt; readr::write_csv(\"data/results/estimate_market_metrics.csv\")\n\ninit = 8\nmodel_name = \"tslm\"\n\nnested_data &lt;- nest_data_for_step_cv(estimation_data)\n\nresults &lt;- nested_data |&gt; filter(Quarter_Index &gt; init & Quarter_Index != max(Quarter_Index)) |&gt;\n                 mutate(model = map(data, ~ lm(formula = as.formula(market_formula), data = .x, REML = TRUE)),         \n                        augmented_data = map2(model, new_data, ~ tryCatch({\n                                            augment(.x, newdata = .y, allow.new.levels = TRUE)\n                                            }, error = function(e) {\n                                                message(\"Error in augment function: \", e$message)\n                                                NULL \n                                            })))\n\nunnested_results &lt;- results |&gt; \n                        unnest(augmented_data) |&gt; \n                        dplyr::select(BankName:last_col()) |&gt; \n                        dplyr::group_by(BankName, BankType) |&gt; \n                        mutate(RMSE = Metrics::rmse(UBPRE524.diff, .fitted),\n                        MAE = Metrics::mae(UBPRE524.diff, .fitted)) |&gt;\n                        summarise(RMSE = mean(RMSE,na.rm = TRUE),\n                                  MAE = mean(MAE,na.rm = TRUE)) |&gt;\n                        add_column(.type = \"CV\", .model = model_name)     \n\nunnested_results |&gt; dplyr::select(BankName, BankType, .model, .type, RMSE, MAE) |&gt; \n    readr::write_csv(glue(\"data/results/tscv/estimate_tscv_market_metrics.csv\"))\n\n\n\n\nCode\nval_results &lt;- get_summary_validation.market(unique(observation_data$BankName))\nval_results$tbl1 |&gt; rmarkdown::paged_table()\nval_results$tbl2 |&gt; rmarkdown::paged_table()\nval_results$tbl3 |&gt; rmarkdown::paged_table()\n\n\n\nTable 6.4: Comparing Accuracy Metrics for Training and Cross-Validation data\n\n\n\n\n (a) Accuracy Metrics on Training and Cross Validation data for sub-set of\nbanks \n  \n\n\n\n\n\n\n (b) Mean Accuracy Metrics for our sub-set of banks \n  \n\n\n\n\n\n\n (c) Mean Accuracy Metrics across all banks"
  },
  {
    "objectID": "model_market.html#prediction",
    "href": "model_market.html#prediction",
    "title": "6  Market Model",
    "section": "6.4 Prediction",
    "text": "6.4 Prediction\n\n\n\n\n\nFigure 6.12: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 6.13: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 6.14: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 6.15: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 6.16: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 6.17: Prediction vs. Observed Event"
  },
  {
    "objectID": "model_market.html#abnormal-results",
    "href": "model_market.html#abnormal-results",
    "title": "6  Market Model",
    "section": "6.5 Abnormal Results",
    "text": "6.5 Abnormal Results\n\n\nCode\nprint_ar(result, \"Costco\", \"AMERICAN EXPRESS NATIONAL BANK (1394676)\")\nprint_ar(result, \"Costco\", \"CITIBANK, N.A. (476810)\")\nprint_ar(result, \"Walmart\", \"SYNCHRONY BANK (1216022)\")\nprint_ar(result, \"Walmart\", \"CAPITAL ONE, NATIONAL ASSOCIATION (112837)\")\nprint_ar(result, \"GAP\", \"SYNCHRONY BANK (1216022)\")\nprint_ar(result, \"GAP\", \"BARCLAYS BANK DELAWARE (2980209)\")\n\n\n\nTable 6.5: Credit Card Plans-30-89 DAYS P/D %: Abnormal Returns (original scale)\n\n\n\n\n (a) Costco (Old) - AMERICAN EXPRESS NATIONAL BANK (1394676) \n  \n\n\n\n\n\n\n (b) Costco (New) - CITIBANK, N.A. (476810) \n  \n\n\n\n\n\n\n (c) Walmart (Old) - SYNCHRONY BANK (1216022) \n  \n\n\n\n\n\n\n (d) Walmart (New) - CAPITAL ONE, NATIONAL ASSOCIATION (112837) \n  \n\n\n\n\n\n\n (e) GAP (Old) - SYNCHRONY BANK (1216022) \n  \n\n\n\n\n\n\n (f) GAP (New) - BARCLAYS BANK DELAWARE (2980209) \n  \n\n\n\n\n\n\n\n\n\n\n\nHyndman, Rob J., and George Athanasopoulos. 2021. Forecasting: Principles and Practice. OTexts. https://otexts.com/fpp3/.\n\n\nMacKinlay, A. Craig. 1997. “Event Studies in Economics and Finance.” Journal of Economic Literature 35 (1): 13–39. https://uoelibrary.idm.oclc.org/login?url=https://www.proquest.com/scholarly-journals/event-studies-economics-finance/docview/213164851/se-2."
  },
  {
    "objectID": "model_arima.html#sec-model-arima",
    "href": "model_arima.html#sec-model-arima",
    "title": "7  Linear Regression with AR Errors",
    "section": "7.1 Model selection",
    "text": "7.1 Model selection\nNote: using the undifferenced value for Credit Card Plans-30-89 DAYS P/D % as the Auto Arima process will perform the differencing if optimal.\n\n7.1.1 Models\n\narima  &lt;- \"UBPRE524.Value\"\n\n# Real Advance Retail and Food Services Sales per capita\nrrsfs1 &lt;- as.formula(\"UBPRE524.Value ~ RRSFS.Pop.log.diff\")\nrrsfs2 &lt;- as.formula(\"UBPRE524.Value ~ RRSFS.Pop.log.diff.lag1\")\nrrsfs3 &lt;- as.formula(\"UBPRE524.Value ~ RRSFS.Pop.log.diff + RRSFS.Pop.log.diff.lag1\")\nrrsfs4 &lt;- as.formula(\"UBPRE524.Value ~ RRSFS.Pop.log.diff + RRSFS.Pop.log.diff.lag1 + RRSFS.Pop.log.diff.lag2\")\nrrsfs5 &lt;- as.formula(\"UBPRE524.Value ~ RRSFS.Pop.log.diff + RRSFS.Pop.log.diff.lag1 + RRSFS.Pop.log.diff.lag2 + RRSFS.Pop.log.diff.lag3\")\n\n# Unemployment Rate\nunrate1 &lt;- as.formula(\"UBPRE524.Value ~ UNRATE.log.diff\")\nunrate2 &lt;- as.formula(\"UBPRE524.Value ~ UNRATE.log.diff.lag1\")\nunrate3 &lt;- as.formula(\"UBPRE524.Value ~ UNRATE.log.diff + UNRATE.log.diff.lag1\")\nunrate4 &lt;- as.formula(\"UBPRE524.Value ~ UNRATE.log.diff + UNRATE.log.diff.lag1 + UNRATE.log.diff.lag2\")\nunrate5 &lt;- as.formula(\"UBPRE524.Value ~ UNRATE.log.diff + UNRATE.log.diff.lag1 + UNRATE.log.diff.lag2 + UNRATE.log.diff.lag3\")\n\n# Consumer Debt Service Payments as a Percent of Disposable Personal Income\ndebt1 &lt;- as.formula(\"UBPRE524.Value ~ CDSP.log.diff\")\ndebt2 &lt;- as.formula(\"UBPRE524.Value ~ CDSP.log.diff.lag1\")\ndebt3 &lt;- as.formula(\"UBPRE524.Value ~ CDSP.log.diff + CDSP.log.diff.lag1\")\ndebt4 &lt;- as.formula(\"UBPRE524.Value ~ CDSP.log.diff + CDSP.log.diff.lag1 + CDSP.log.diff.lag2\")\ndebt5 &lt;- as.formula(\"UBPRE524.Value ~ CDSP.log.diff + CDSP.log.diff.lag1 + CDSP.log.diff.lag2 + CDSP.log.diff.lag3\")\n\n# Household Debt Service Payments as a Percent of Disposable Personal Income\ndebth1 &lt;- as.formula(\"UBPRE524.Value ~ TDSP.log.diff\")\ndebth2 &lt;- as.formula(\"UBPRE524.Value ~ TDSP.log.diff.lag1\")\ndebth3 &lt;- as.formula(\"UBPRE524.Value ~ TDSP.log.diff + TDSP.log.diff.lag1\")\ndebth4 &lt;- as.formula(\"UBPRE524.Value ~ TDSP.log.diff + TDSP.log.diff.lag1 + TDSP.log.diff.lag2\")\ndebth5 &lt;- as.formula(\"UBPRE524.Value ~ TDSP.log.diff + TDSP.log.diff.lag1 + TDSP.log.diff.lag2 + TDSP.log.diff.lag3\")\n\n# Loans to Individuals for Household, Family, and Other Personal Expenditures:Credit Cards\nportfolio1 &lt;- as.formula(\"UBPRE524.Value ~ UBPRB538.pct_change + UBPRB538.pct_change.lag1\")\nportfolio2 &lt;- as.formula(\"UBPRE524.Value ~ UBPRB538.log.diff + UBPRB538.log.diff.lag1\")\nportfolio3 &lt;- as.formula(\"UBPRE524.Value ~ UBPRB538.log.diff + UBPRB538.log.diff.lag1 + UBPR3815.log.diff\")\nportfolio4 &lt;- as.formula(\"UBPRE524.Value ~ UBPRB538.log.diff + UBPR3815.log.diff\")\n\n# Combinations (use Auto ARIMA)\ncomb1 &lt;- as.formula(\"UBPRE524.Value ~ RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1\")\ncomb2 &lt;- as.formula(\"UBPRE524.Value ~ RRSFS.Pop.log.diff + RRSFS.Pop.log.diff.lag1 + UNRATE.log.diff + UNRATE.log.diff.lag1\")\ncomb3 &lt;- as.formula(\"UBPRE524.Value ~ RRSFS.Pop.log.diff + RRSFS.Pop.log.diff.lag1 + UNRATE.log.diff + UNRATE.log.diff.lag1 + UNRATE.log.diff.lag2\")\ncomb4 &lt;- as.formula(\"UBPRE524.Value ~ RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1 + UBPRB538.log.diff\")\ncomb5 &lt;- as.formula(\"UBPRE524.Value ~ CDSP.log.diff + CDSP.log.diff.lag1 + UBPRB538.log.diff\")\n\n# Combinations (don't use Auto ARIMA)\nmanual1 &lt;- as.formula(\"UBPRE524.diff ~ 1 + RRSFS.Pop.log.diff + RRSFS.Pop.log.diff.lag1 + UBPRB538.log.diff + pdq(1, 0, 0) + PDQ(0,0,0)\")\nmanual2 &lt;- as.formula(\"UBPRE524.diff ~ 1 + RRSFS.Pop.log.diff + RRSFS.Pop.log.diff.lag1 + UBPRB538.log.diff + pdq(1, 0, 0) + PDQ(1,0,0)\")\nmanual3 &lt;- as.formula(\"UBPRE524.diff ~ 1 + UNRATE.log.diff + UNRATE.log.diff.lag1 + UBPRB538.log.diff + pdq(1, 0, 0) + PDQ(0,0,0)\")\nmanual4 &lt;- as.formula(\"UBPRE524.diff ~ 1 + UNRATE.log.diff + UNRATE.log.diff.lag1 + UBPRB538.log.diff + pdq(1, 0, 0) + PDQ(1,0,0)\")\nmanual5 &lt;- as.formula(\"UBPRE524.diff ~ 1 + CDSP.log.diff + CDSP.log.diff.lag1 + UBPRB538.log.diff + pdq(1, 0, 0) + PDQ(0,0,0)\")\nmanual6 &lt;- as.formula(\"UBPRE524.diff ~ 1 + CDSP.log.diff + CDSP.log.diff.lag1 + UBPRB538.log.diff + pdq(1, 0, 0) + PDQ(1,0,0)\")\nmanual7 &lt;- as.formula(\"UBPRE524.diff ~ 1 + RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1 + UBPRB538.log.diff + pdq(1, 0, 0) + PDQ(0,0,0)\")\nmanual8 &lt;- as.formula(\"UBPRE524.diff ~ 1 + RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1 + UBPRB538.log.diff + pdq(1, 0, 0) + PDQ(1,0,0)\")\nmanual9 &lt;- as.formula(\"UBPRE524.diff ~ 1 + TDSP.log.diff + B069RC1.Pop.CPI.log.diff.lag1 + UBPRB538.log.diff.lag2 + UBPRB538.log.diff.lag3 + UBPR3815.log.diff + RRSFS.Pop.log.diff + pdq(1, 0, 0) + PDQ(1,0,0)\")\n\n\n\nCode\nrun_arima &lt;- function(estimation_data) {\n  ## 1. Expenditure\n  m_table1 &lt;- estimation_data |&gt;\n              fabletools::model(\n                  arima = ARIMA(UBPRE524.Value),\n                  rrsfs1 = ARIMA(rrsfs1),\n                  rrsfs2 = ARIMA(rrsfs2),\n                  rrsfs3 = ARIMA(rrsfs3),\n                  rrsfs4 = ARIMA(rrsfs4),\n                  rrsfs5 = ARIMA(rrsfs5)\n              )\n\n  save_arima_results(m_table1, get_model_cols(m_table1, key_vars(estimation_data)),glue(\"arima_rrsfs_results.csv\"))\n\n  ## 2. Unemployment\n  m_table2 &lt;- estimation_data |&gt; \n              model(\n                  unrate1 = ARIMA(unrate1),\n                  unrate2 = ARIMA(unrate2),\n                  unrate3 = ARIMA(unrate3),\n                  unrate4 = ARIMA(unrate4),\n                  unrate5 = ARIMA(unrate5)\n              )\n\n  save_arima_results(m_table2, get_model_cols(m_table2, key_vars(estimation_data)),glue(\"arima_unrate_results.csv\"))\n\n  ## 3.1 Debt Consumer\n  m_table3.1 &lt;- estimation_data |&gt;\n              model(\n                  debt1 = ARIMA(debt1),\n                  debt2 = ARIMA(debt2),\n                  debt3 = ARIMA(debt3),\n                  debt4 = ARIMA(debt4),\n                  debt5 = ARIMA(debt5)\n              )\n\n  save_arima_results(m_table3.1, get_model_cols(m_table3.1, key_vars(estimation_data)),glue(\"arima_debt_results.csv\"))\n\n  ## 3.2 Debt Household\n  m_table3.2 &lt;- estimation_data |&gt;\n              model(\n                  debth1 = ARIMA(debth1),\n                  debth2 = ARIMA(debth2),\n                  debth3 = ARIMA(debth3),\n                  debth4 = ARIMA(debth4),\n                  debth5 = ARIMA(debth5)\n              )\n\n  save_arima_results(m_table3.2, get_model_cols(m_table3.2, key_vars(estimation_data)),glue(\"arima_debth_results.csv\"))\n\n  ## 4. Portfolio\n  m_table4 &lt;- estimation_data |&gt; \n              model(\n                  portfolio1 = ARIMA(portfolio1),\n                  portfolio2= ARIMA(portfolio2),\n                  portfolio3= ARIMA(portfolio3),\n                  portfolio4= ARIMA(portfolio4),\n              )\n\n  save_arima_results(m_table4, get_model_cols(m_table4, key_vars(estimation_data)),glue(\"arima_portfolio_results.csv\"))\n\n \n  ## 5. Combinations\n  m_table6 &lt;- estimation_data |&gt; \n              model(\n                  comb1= ARIMA(comb1),\n                  comb2= ARIMA(comb2),\n                  comb3= ARIMA(comb3),\n                  comb4= ARIMA(comb4),\n                  comb5= ARIMA(comb5)\n              )\n\n  save_arima_results(m_table6, get_model_cols(m_table6, key_vars(estimation_data)),glue(\"arima_other_results.csv\"))\n\n  ## 6. Manual\n  m_table7 &lt;- estimation_data |&gt; \n              model(\n                  manual1= ARIMA(manual1),\n                  manual2= ARIMA(manual2),\n                  manual3= ARIMA(manual3),\n                  manual4= ARIMA(manual4),\n                  manual5= ARIMA(manual5),\n                  manual6= ARIMA(manual6),\n                  manual7= ARIMA(manual7),\n                  manual8= ARIMA(manual8),\n                  manual9= ARIMA(manual9)\n              )\n\n  save_arima_results(m_table7, get_model_cols(m_table7, key_vars(estimation_data)),glue(\"arima_manual_results.csv\"))\n}\n\nrun_arima(estimation_data)\n\n\n\n\n7.1.2 Results\nWe can see that for our sub-set of banks the top models are very different. With the exception of Capital One all models have explanatory variables. Capital One is the only model the relies solely on its history.\nFor BARCLAYS we could simplify the model by removing terms where p-value &gt; 0.05 as we cannot conclude that these explanatory variables affect our target measure.\n\nCITIBANKSYNCHRONYBARCLAYSAMERICAN EXPRESS NATIONAL BANKCAPITAL ONE\n\n\n\n\nCode\narima_results &lt;- read_arima_results() \nbest_bank_models &lt;- partner_banks  |&gt;\n                      mutate(model_details = map2(Bank, Partner, best_arima_model, data, arima_results))\n                      \nbank = \"CITIBANK\"\nprint_top_bank_model(bank, arima_results)\n\n\n\n\n Table 7.1:  Ordered Top 10 Best-Worst model by AICc \n  \n\n\n\n\n\n\nCode\nprint_coeff(bank, best_bank_models)#| \n\n\n\n\n Table 7.2:  Top Model coefficients \n  \n\n\n\n\n\n\n\n\nCode\nbank = \"SYNCHRONY\"\nprint_top_bank_model(bank, arima_results)\n\n\n\n\n Table 7.3:  Ordered Top 10 Best-Worst model by AICc \n  \n\n\n\n\n\n\nCode\nprint_coeff(bank, best_bank_models)\n\n\n\n\n Table 7.4:  Top Model coefficients \n  \n\n\n\n\n\n\n\n\nCode\nbank = \"BARCLAYS\"\nprint_top_bank_model(bank, arima_results)\n\n\n\n\n Table 7.5:  Ordered Top 10 Best-Worst model by AICc \n  \n\n\n\n\n\n\nCode\nprint_coeff(bank, best_bank_models)\n\n\n\n\n Table 7.6:  Top Model coefficients \n  \n\n\n\n\n\n\n\n\nCode\nbank = \"AMERICAN EXPRESS NATIONAL BANK\"\nprint_top_bank_model(bank, arima_results)\n\n\n\n\n Table 7.7:  Ordered Top 10 Best-Worst model by AICc \n  \n\n\n\n\n\n\nCode\nprint_coeff(bank, best_bank_models)\n\n\n\n\n Table 7.8:  Top Model coefficients \n  \n\n\n\n\n\n\n\n\nCode\nbank = \"CAPITAL ONE\"\nprint_top_bank_model(bank, arima_results)\n\n\n\n\n Table 7.9:  Ordered Top 10 Best-Worst model by AICc \n  \n\n\n\n\n\n\nCode\nprint_coeff(bank, best_bank_models)\n\n\n\n\n Table 7.10:  Top Model coefficients \n  \n\n\n\n\n\n\n\n\n\n7.1.3 Top Model Estimated Fit\n\n\nCode\nbank_aug_data &lt;- best_bank_models |&gt; \n                  mutate(augdata = map(model_details, ~ .x$Augmented)) |&gt; unnest(augdata) |&gt; \n                    dplyr::select(Partner, BankName:last_col()) \n\nbank_aug_data |&gt; \n  filter(BankName %in% observation_data$BankName) |&gt; \n    as_tsibble(index = Quarter, key=c(BankName, Partner)) |&gt; plot_model_fit(\"UBPRE524.diff\")\n\n\n\n\n\nFigure 7.1: Fitted vs. Observed for estimation data on sub-set of firms\n\n\n\n\n\n\n7.1.4 Residual diagnostics\nResiduals should have the following properties (Hyndman and Athanasopoulos 2021, ch. 5.4). Residuals:\n\nAre uncorrelated. Correlations indicate that the model is missing information left in the residuals.\nHave zero mean. If they have a mean other than zero, then the forecasts are biased.\nHave constant variance i.e. does not violate “homoscedasticity” assumption.\nAre normally distributed.\n\n\nCITIBANKSYNCHRONYBARCLAYSAMERICAN EXPRESSCAPITAL ONE\n\n\n\n\nCode\nbank &lt;- \"CITIBANK\"\nplot_bank_residuals(bank, best_bank_models)\n\n\n\n\n\nFigure 7.2: Best Bank Model Residuals\n\n\n\n\n\n\n\n\nCode\nbank &lt;- \"SYNCHRONY\"\nplot_bank_residuals(bank, best_bank_models)\n\n\n\n\n\nFigure 7.3: Best Bank Model Residuals\n\n\n\n\n\n\n\n\nCode\nbank &lt;- \"BARCLAYS\"\nplot_bank_residuals(bank, best_bank_models)\n\n\n\n\n\nFigure 7.4: Best Bank Model Residuals\n\n\n\n\n\n\n\n\nCode\nbank &lt;- \"AMERICAN EXPRESS\"\nplot_bank_residuals(bank, best_bank_models)\n\n\n\n\n\nFigure 7.5: Best Bank Model Residuals\n\n\n\n\n\n\n\n\nCode\nbank &lt;-  \"CAPITAL ONE\"\nplot_bank_residuals(bank, best_bank_models)\n\n\n\n\n\nFigure 7.6: Best Bank Model Residuals\n\n\n\n\n\n\n\n\n7.1.4.1 Residuals White Noise\nThe sub-set of banks analysed in Section 7.1.4 did not exhibit significant autocorrelation.\nTable 7.11 lists banks where we reject the null hypothesis of the Ljung–Box test, indicating the presence of significant autocorrelation in the residuals.\nBanks not listed have residuals that are indistinguishable from a white noise series i.e. have uncorrelated observations and with constant variance.\n\n\nCode\nbank_aug_data  |&gt; as_tsibble(index=Quarter, key = c(BankName, Partner)) |&gt;\n  features(.innov, ljung_box) |&gt; mutate(across(where(is.numeric), \\(x) round(x,4))) |&gt; \n    filter(lb_pvalue &lt;= 0.05)|&gt; dplyr::select(BankName,lb_stat,lb_pvalue) |&gt;\n      rmarkdown::paged_table()\n\n\n\n\n Table 7.11:  Ljung–Box results where P-value &lt; Significance Level of 0.05"
  },
  {
    "objectID": "model_arima.html#time-series-cross-validation",
    "href": "model_arima.html#time-series-cross-validation",
    "title": "7  Linear Regression with AR Errors",
    "section": "7.2 Time Series Cross-Validation",
    "text": "7.2 Time Series Cross-Validation\nSelecting the best model for each bank, we use one-step ahead cross-validation to assess their performance on unseen data. The outcomes, detailed in Table 7.12, reveal that, with the exception of Capital One, the models underperform compared to the Market model (see Table 6.4). This discrepancy suggests that the models are overfitting, meaning they have learned the training data too well, capturing noise rather than the underlying signal, which diminishes their predictive accuracy on new, unseen data. To reduce overfitting we may have to look at simpler models i.e. those with higher AICc but fewer parameters.\n\n\nCode\nbank_models &lt;- best_bank_models |&gt; \n                  mutate(model = map(model_details, ~ .x$BankModel)) \n\nbank_top_formulas &lt;- best_bank_models |&gt; \n                  mutate(formula = map(model_details, ~ .x$Formula)) \n                  \nbank_models$model |&gt; map(fabletools::accuracy) |&gt; list_rbind() |&gt; readr::write_csv(\"data/results/estimate_arima_metrics.csv\")\n\n# Timeseries CV \n\ndo_arima_cv &lt;- function(bankname, formulas, estimation_data, init = 7) {    \n  tryCatch({  \n    selected_formula &lt;- formulas |&gt; filter(bank == bankname) |&gt; pluck(\"formula\",1)\n    \n    filtered_data &lt;- estimation_data |&gt; filter(BankName == bankname)\n      \n    est_data_tr &lt;- filtered_data |&gt;  \n                    stretch_tsibble(.init = init, .step = 1) |&gt;\n                      relocate( .id)\n\n    step_data_tr &lt;- filtered_data |&gt; \n                      dplyr::slice(init+1:n()) |&gt; mutate(.step = row_number()) |&gt; \n                        relocate(.step) |&gt;\n                          group_by(.step) |&gt; nest(data = -c(.step,UBPRE524.diff)) |&gt; \n                            rename(\"new_data\" = \"data\") |&gt; dplyr::select(-UBPRE524.diff)\n\n    nested_data &lt;- est_data_tr |&gt;\n                    group_by(.id) |&gt;\n                      nest(data = -.id) |&gt; left_join(step_data_tr, by = join_by(.id == .step)) |&gt;\n                        drop_na(new_data)\n  \n    results &lt;- nested_data |&gt; \n                  mutate(model = map(data, ~model(.x, ARIMA(!!selected_formula))),\n                        forecast = map(model, forecast, new_data = new_data, bootstrap=TRUE, times=100))\n\n    results$forecast |&gt; map(fabletools::accuracy, filtered_data) |&gt; \n      list_rbind() |&gt;  readr::write_csv(glue(\"data/results/tscv/estimate_tscv_arima_{bankname}.csv\"))\n\n   }, error = function(e) {\n    print(glue::glue(\"cv error for {bankname}: {e}\"))\n  })\n}\n\nunique(estimation_data$BankName) |&gt; walk(\\(x) do_arima_cv(x, bank_top_formulas, estimation_data))\n\n\n\n\nCode\nval_results &lt;- get_summary_validation.arima(unique(observation_data$BankName))\nval_results$tbl1 |&gt; rmarkdown::paged_table()\nval_results$tbl2 |&gt; rmarkdown::paged_table()\nval_results$tbl3 |&gt; rmarkdown::paged_table()\n\n\n\nTable 7.12: Comparing Accuracy Metrics for Training and Cross-Validation data\n\n\n\n\n (a) Accuracy Metrics on Training and Cross Validation data for sub-set of\nbanks \n  \n\n\n\n\n\n\n (b) Mean Accuracy Metrics for our sub-set of banks \n  \n\n\n\n\n\n\n (c) Mean Accuracy Metrics across all banks"
  },
  {
    "objectID": "model_arima.html#prediction",
    "href": "model_arima.html#prediction",
    "title": "7  Linear Regression with AR Errors",
    "section": "7.3 Prediction",
    "text": "7.3 Prediction\n\n\n\n\n\nFigure 7.7: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 7.8: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 7.9: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 7.10: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 7.11: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 7.12: Prediction vs. Observed Event"
  },
  {
    "objectID": "model_arima.html#abnormal-results",
    "href": "model_arima.html#abnormal-results",
    "title": "7  Linear Regression with AR Errors",
    "section": "7.4 Abnormal Results",
    "text": "7.4 Abnormal Results\n\n\nCode\nprint_ar(result, \"Costco\", \"AMERICAN EXPRESS NATIONAL BANK (1394676)\")\nprint_ar(result, \"Costco\", \"CITIBANK, N.A. (476810)\")\nprint_ar(result, \"Walmart\", \"SYNCHRONY BANK (1216022)\")\nprint_ar(result, \"Walmart\", \"CAPITAL ONE, NATIONAL ASSOCIATION (112837)\")\nprint_ar(result, \"GAP\", \"SYNCHRONY BANK (1216022)\")\nprint_ar(result, \"GAP\", \"BARCLAYS BANK DELAWARE (2980209)\")\n\n\n\nTable 7.13: Credit Card Plans-30-89 DAYS P/D %: Abnormal Returns (original scale)\n\n\n\n\n (a) Costco (Old) - AMERICAN EXPRESS NATIONAL BANK (1394676) \n  \n\n\n\n\n\n\n (b) Costco (New) - CITIBANK, N.A. (476810) \n  \n\n\n\n\n\n\n (c) Walmart (Old) - SYNCHRONY BANK (1216022) \n  \n\n\n\n\n\n\n (d) Walmart (New) - CAPITAL ONE, NATIONAL ASSOCIATION (112837) \n  \n\n\n\n\n\n\n (e) GAP (Old) - SYNCHRONY BANK (1216022) \n  \n\n\n\n\n\n\n (f) GAP (New) - BARCLAYS BANK DELAWARE (2980209) \n  \n\n\n\n\n\n\n\n\n\n\n\nHyndman, Rob J., and George Athanasopoulos. 2021. Forecasting: Principles and Practice. OTexts. https://otexts.com/fpp3/."
  },
  {
    "objectID": "model_hierarchy_event.html#models",
    "href": "model_hierarchy_event.html#models",
    "title": "8  Hierarchical Model",
    "section": "8.1 Models",
    "text": "8.1 Models\n\nm1 &lt;- lmer(UBPRE524.diff ~ (1 | BankType/BankName), data = estimation_data, REML = FALSE)\nm2 &lt;- lmer(UBPRE524.diff ~ (1 + UBPRB538.log.diff | BankType/BankName)+ UNRATE.log.diff + UNRATE.log.diff.lag1 + UNRATE.log.diff.lag2  , data = estimation_data, REML = FALSE)\nm3 &lt;- lmer(UBPRE524.diff ~ (1 + UBPRB538.log.diff | BankType/BankName)+ RRSFS.Pop.log.diff + RRSFS.Pop.log.diff.lag1 + RRSFS.Pop.log.diff.lag2 , data = estimation_data, REML = FALSE)\nm4 &lt;- lmer(UBPRE524.diff ~ (1 + UBPRB538.log.diff | BankType/BankName) + RRSFS.Pop.log.diff + TDSP.log.diff + B069RC1.Pop.CPI.log.diff.lag1 , data = estimation_data, REML = FALSE)\nm5 &lt;- lmer(UBPRE524.diff ~ (1 + UBPRB538.log.diff | BankType/BankName) + RRSFS.Pop.log.diff + TDSP.log.diff + RRSFS.Pop.log.diff.lag1 , data = estimation_data, REML = FALSE)\nm6 &lt;- lmer(UBPRE524.diff ~ (1 + UBPRB538.log.diff | BankType/BankName) + RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1 , data = estimation_data, REML = FALSE)\nm7 &lt;- lmer(UBPRE524.diff ~ (1 + UBPRB538.log.diff | BankType/BankName) + TDSP.log.diff + TDSP.log.diff.lag1 + TDSP.log.diff.lag2 , data = estimation_data, REML = FALSE)\nm8 &lt;- lmer(UBPRE524.diff ~ (1 + Qtr + UBPRB538.log.diff + UBPR3815.log.diff | BankType/BankName) + TDSP.log.diff, data = estimation_data, REML = FALSE)\n\n\n\nCode\nmodel_comparison &lt;- model.sel( m1, m2, m3, m4, m5, m6, m7, m8, rank = \"AICc\")\n\nmodel_comparison |&gt; as.data.frame() |&gt; rownames_to_column(var = \"Model\")|&gt; \n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt; \n        relocate(df:weight, .after = Model) |&gt;\n         dplyr::select(Model, df, logLik, AICc, delta, weight) |&gt;\n            rmarkdown::paged_table()  \n\n\n\n\n Table 8.1:  AICc Summary. The lower the AICc value, the better the balance\nbetween model complexity (number of parameters) and goodness of fit \n  \n\n\n\n\n\n8.1.1 Model Choice\nFocusing in on model 8 - we can test variations of this model.\n\nm8.1 &lt;- lmer(UBPRE524.diff ~ (1 + Qtr+ UBPRB538.log.diff + UBPR3815.log.diff | BankName) + TDSP.log.diff + RRSFS.Pop.log.diff + UNRATE.log.diff, data = estimation_data, REML = FALSE)\nm8.2 &lt;- lmer(UBPRE524.diff ~ (1 + Qtr+ UBPRB538.log.diff + UBPR3815.log.diff | BankType/BankName) + TDSP.log.diff, data = estimation_data, REML = FALSE)\nm8.3 &lt;- lmer(UBPRE524.diff ~ (1 + Qtr+ UBPRB538.log.diff + UBPR3815.log.diff | BankName) + TDSP.log.diff +  TDSP.log.diff.lag1 + RRSFS.Pop.log.diff + UNRATE.log.diff, data = estimation_data, REML = FALSE)\nm8.4 &lt;- lmer(UBPRE524.diff ~ (1 + Qtr+ UBPRB538.log.diff + UBPR3815.log.diff | BankName) + TDSP.log.diff +  RRSFS.Pop.log.diff + RRSFS.Pop.log.diff.lag1 + UNRATE.log.diff, data = estimation_data, REML = FALSE)\nm8.5 &lt;- lmer(UBPRE524.diff ~ (1 + Qtr+ UBPRB538.log.diff + UBPR3815.log.diff | BankType/BankName) + TDSP.log.diff +  RRSFS.Pop.log.diff + UNRATE.log.diff.lag1 + UNRATE.log.diff, data = estimation_data, REML = FALSE)\nm8.6 &lt;- lmer(UBPRE524.diff ~ (1 + Qtr+ UBPRB538.log.diff + UBPR3815.log.diff | BankName) + TDSP.log.diff +  RRSFS.Pop.log.diff + UNRATE.log.diff.lag2 + UNRATE.log.diff.lag1 + UNRATE.log.diff, data = estimation_data, REML = FALSE,control=lmerControl(optCtrl=list(maxfun=20000)))\nm8.7 &lt;- lmer(UBPRE524.diff ~ (1 + Qtr+ UBPRB538.log.diff + UBPR3815.log.diff | BankName) + TDSP.log.diff +  RRSFS.Pop.log.diff + RRSFS.Pop.log.diff.lag1 + UNRATE.log.diff.lag1 + UNRATE.log.diff, data = estimation_data, REML = FALSE)\nm8.8 &lt;- lmer(UBPRE524.diff ~ (1 + Qtr+ UBPRB538.log.diff + UBPR3815.log.diff | BankName) + TDSP.log.diff  + RRSFS.Pop.log.diff.lag1 + UNRATE.log.diff.lag1 + UNRATE.log.diff, data = estimation_data, REML = FALSE)\nm8.9 &lt;- lmer(UBPRE524.diff ~ Qtr+ (1 + UBPRB538.log.diff + UBPR3815.log.diff | BankName) + TDSP.log.diff +  RRSFS.Pop.log.diff + UNRATE.log.diff.lag2 + UNRATE.log.diff.lag1 + UNRATE.log.diff, data = estimation_data, REML = FALSE)\n\n\n\nCode\nmodel_comparison &lt;- model.sel( m8, m8.1, m8.2, m8.3, m8.4, m8.5, m8.6,m8.7,m8.8, m8.9, rank = \"AICc\")\n\nmodel_comparison |&gt; as.data.frame() |&gt; rownames_to_column(var = \"Model\")|&gt; \n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt; \n        relocate(df:weight, .after = Model) |&gt;\n            dplyr::select(Model, df, logLik, AICc, delta, weight) |&gt;\n                rmarkdown::paged_table()  \n\n\n\n\n Table 8.2:  AICc Summary - refinement of model selection. \n  \n\n\n\n\n\n8.1.1.1 Variance Inflation Factors\nThe best model based on AICc is model m8.6. However, it fails to converge when we run again with REML = TRUE and with 30000 iterations. Consequently we will select m8.5. Analysis of the correlation matrix Table 8.3 (a) reveals the largest correlation of 0.68 and -0.68 between UNRATE.log.diff and UNRATE.log.diff.lag1 with RRSFS.Pop.log.diff. This aligns with what we found in Cross-Correlation Function (CCF) tests (see Figure 4.16 (b)). Table Table 8.3 (b) looks at the Variance Inflation Factor (VIF) to quantifies the extent to which the variance of an estimated regression coefficient increases due to multicollinearity among the predictors. A high VIF signifies that a predictor shares a substantial amount of information with other predictors in the model, potentially distorting the regression coefficients and their interpretability. According to Hebbali (2023), VIF values above 4 warrant further investigation, while VIFs exceeding 10 are signs of serious multicollinearity requiring correction. Considering that VIF for RRSFS.Pop.log.diff is &lt; 4 and the impact on AICc with RRSFS.Pop.log.diff removed, we will keep model m8.5 as our selected model.\n\n\nCode\nmodel_name &lt;- \"m8.5\"\ntop_model &lt;- lmer(formula(eval(as.name(model_name))), data = estimation_data, REML = TRUE)\n\ncov2cor(vcov(top_model)) |&gt; as.matrix() |&gt; as.data.frame() |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n    rmarkdown::paged_table() \nvif_df &lt;- car::vif(top_model,type=\"predictor\") |&gt; as.data.frame() \ncolnames(vif_df) &lt;- \"VIF\"\nvif_df |&gt; dplyr::select(VIF) |&gt; rmarkdown::paged_table() \ntop_model &lt;- lmer(formula(eval(as.name(model_name))), data = estimation_data, REML = TRUE)\n\n\n\nTable 8.3: Assessing model 8.5\n\n\n\n\n (a) Correlation of Fixed Effects for model 8.5 \n  \n\n\n\n\n\n\n (b) VIF \n  \n\n\n\n\n\n\n\n\n8.1.2 Estimated Fit\n\n\nCode\naugmented_data &lt;- augment(top_model) |&gt; \n                    mutate(Quarter = estimation_data$Quarter,\n                        BankType = estimation_data$BankType) |&gt;\n                    add_column(.model = model_name) |&gt;\n                    as_tsibble(index = Quarter, key = c(BankName, BankType)) \n\naugmented_data |&gt; \n    filter(BankName %in% unique(observation_data$BankName)) |&gt;\n    plot_model_fit(\"UBPRE524.diff\")\n\n\n\n\n\nFigure 8.1: Fitted vs. Observed for estimation data on sub-set of firms for model 8.7\n\n\n\n\n\n\n8.1.3 Fixed Effects\n\nPlotCoefficients and Correlation Data\n\n\n\n\nCode\nfeEx &lt;- FEsim(top_model, 1000)\nplotFEsim(feEx) +\n  theme_bw() + labs(title = \"Coefficient Plot\",\n                    x = \"Median Effect Estimate\", y = glue(\"{target_label} (difference)\"))\n\n\n\n\n\nFigure 8.2: Plot of simulated fixed effects\n\n\n\n\n\n\n\n\nCode\ntidy(top_model, effects = \"fixed\") |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n    dplyr::select(-effect) |&gt;\n    rmarkdown::paged_table() \ncov2cor(vcov(top_model)) |&gt; as.matrix() |&gt; as.data.frame() |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n    rmarkdown::paged_table() \n\n\n\nTable 8.4: Coefficients and Correlation of Fixed Effects\n\n\n\n\n\n (a) Coefficients \n  \n\n\n?(caption)\n\n\n\n\n\n\n (b) Correlation of Fixed Effects \n  \n\n\n?(caption)\n\n\n\n\n\n\n\nThe high t-statistics for all the terms indicate that the effects are quite precise and the likelihood that this finding is due to chance is very small.\n\n\n8.1.4 Random Effects\n\nPlotData\n\n\n\n\nCode\nreEx &lt;- REsim(top_model)\nplotREsim(reEx)      \n\n\n\n\n\nFigure 8.3: Random Effects\n\n\n\n\nThe red line indicates no effect (zero), and the dots represent the random effect estimates with their confidence intervals. Points that are distinguishable from zero (i.e. the confidence band does not cross the red line) are highlighted as black dots, whereas the grey dots are where the confidence band cross the red line.\n\n\n\n\nCode\nselected_banks &lt;- unique(paste0(observation_data$BankName,\":\",observation_data$BankType))\nranef(top_model, condVar = FALSE)$`BankName:BankType` |&gt; as.data.frame() |&gt; \n    rownames_to_column(var = \"Entity\") |&gt; \n    filter(Entity %in% selected_banks) |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n        rmarkdown::paged_table()\n\n\n\nTable 8.5: Intercept and coefficients\n\n\n\n\n\n (a) Random Effects for BankName (selected Banks) \n  \n\n\n?(caption)\n\n\n\n\n\n\n\nFrom Figure 11.2 we can see that the random effect of Unused Commitments on Credit Cards (UBPR3815) and Loans to Individuals for Household, Family, and Other Personal Expenditures:Credit Cards (UBPRB538) are distinguishable from zero i.e. the contribution to the variability of our target measure is beyond what could be expected by chance alone.\nInterestingly, Qtr3 for BankType was also distinguishable from zero. This aligns with our statistical tests in Figure 2.8 that showed delinquency peaked in Q3. But at the Bank level Q4 appears more significant.\n\n\n8.1.5 Residual diagnostics\n\nCITIBANKSYNCHRONYBARCLAYSAMERICAN EXPRESSCAPITAL ONE\n\n\n\n\nCode\nbank &lt;- \"CITIBANK\"\nplot_bank_residual(bank, augmented_data)\n\n\n\n\n\nFigure 8.4: hier residuals\n\n\n\n\n\n\n\n\nCode\nbank &lt;- \"SYNCHRONY\"\nplot_bank_residual(bank, augmented_data)\n\n\n\n\n\nFigure 8.5: Best Bank Model residuals\n\n\n\n\n\n\n\n\nCode\nbank &lt;- \"BARCLAYS\"\nplot_bank_residual(bank, augmented_data)\n\n\n\n\n\nFigure 8.6: Model residuals\n\n\n\n\n\n\n\n\nCode\nbank &lt;- \"AMERICAN EXPRESS\"\nplot_bank_residual(bank, augmented_data)\n\n\n\n\n\nFigure 8.7: Model residuals\n\n\n\n\n\n\n\n\nCode\nbank &lt;-  \"CAPITAL ONE\"\nplot_bank_residual(bank, augmented_data)\n\n\n\n\n\nFigure 8.8: Model residuals\n\n\n\n\n\n\n\n\n8.1.5.1 Residuals White Noise\n\n\nCode\naugmented_data  |&gt; \n  features(.fitted, ljung_box) |&gt; mutate(across(where(is.numeric), \\(x) round(x,4))) |&gt; \n    filter(lb_pvalue &lt;= 0.05)|&gt; dplyr::select(BankName,lb_stat,lb_pvalue) |&gt;\n      rmarkdown::paged_table()\n\n\n\n\n Table 8.6:  Ljung–Box results where P-value &lt; Significance Level of 0.05"
  },
  {
    "objectID": "model_hierarchy_event.html#time-series-cross-validation",
    "href": "model_hierarchy_event.html#time-series-cross-validation",
    "title": "8  Hierarchical Model",
    "section": "8.2 Time Series Cross-Validation",
    "text": "8.2 Time Series Cross-Validation\nWe use one-step ahead cross-validation to assess model 8.7’s performance on unseen data. The outcomes, detailed in Table 8.7, reveal that the model performance is comparable to the Market model (see Table 6.4). The results show that the RMSE and MAE of the cross-validated models (CV) closely matches the RMSE and MAE observed in the initial model evaluation (Training). This indicates that the model is generalising well to unseen data and not overfitting.\n\n\nCode\nmetrics &lt;- augmented_data |&gt; as_tibble() |&gt; \n            mutate(RMSE = Metrics::rmse(UBPRE524.diff, .fitted),\n                   MAE = Metrics::mae(UBPRE524.diff, .fitted)) |&gt;\n            group_by(BankName, BankType, .model) |&gt; \n            summarise(RMSE = mean(RMSE,na.rm = TRUE),\n                      MAE = mean(MAE,na.rm = TRUE)) |&gt; add_column(.type = \"Training\")     \n\nmetrics |&gt; dplyr::select(BankName, BankType, .model, .type, RMSE, MAE) |&gt; \n    readr::write_csv(\"data/results/estimate_hier_metrics.csv\")\n\ndo_hier_cv &lt;- function(estimation_data, init = 5) {       \n    nested_data &lt;- nest_data_for_step_cv(estimation_data)\n\n    results &lt;- nested_data |&gt; filter(Quarter_Index &gt; init & Quarter_Index != max(Quarter_Index)) |&gt;\n                 mutate(model = map(data, ~ lmer(formula = formula(top_model), data = .x, REML = TRUE)),         \n                        augmented_data = map2(model, new_data, ~ tryCatch({\n                                            augment(.x, newdata = .y, allow.new.levels = TRUE)\n                                            }, error = function(e) {\n                                                message(\"Error in augment function: \", e$message)\n                                                NULL \n                                            })))\n\n    unnested_results &lt;- results |&gt; \n                            unnest(augmented_data) |&gt; \n                            dplyr::select(BankName:last_col()) |&gt; \n                            dplyr::group_by(BankName, BankType) |&gt; \n                            mutate(RMSE = Metrics::rmse(UBPRE524.diff, .fitted),\n                            MAE = Metrics::mae(UBPRE524.diff, .fitted)) |&gt;\n                            summarise(RMSE = mean(RMSE,na.rm = TRUE),\n                                      MAE = mean(MAE,na.rm = TRUE)) |&gt;\n                            add_column(.type = \"CV\", .model = model_name)     \n\n    unnested_results |&gt; dplyr::select(BankName, BankType, .model, .type, RMSE, MAE) |&gt; \n        readr::write_csv(glue(\"data/results/tscv/estimate_tscv_hier.csv\"))\n}\ndo_hier_cv(estimation_data, init = 7)\n\n\n\n\nCode\nval_results &lt;- get_summary_validation.hierarchy(unique(observation_data$BankName))\nval_results$tbl1 |&gt; rmarkdown::paged_table()\nval_results$tbl2 |&gt; rmarkdown::paged_table()\nval_results$tbl3 |&gt; rmarkdown::paged_table()    \n\n\n\nTable 8.7: Comparing Accuracy Metrics for Training and Cross-Validation data\n\n\n\n\n (a) Accuracy Metrics on Training and Cross Validation data for sub-set of\nbanks \n  \n\n\n\n\n\n\n (b) Mean Accuracy Metrics for our sub-set of banks \n  \n\n\n\n\n\n\n (c) Mean Accuracy Metrics across all banks"
  },
  {
    "objectID": "model_hierarchy_event.html#prediction",
    "href": "model_hierarchy_event.html#prediction",
    "title": "8  Hierarchical Model",
    "section": "8.3 Prediction",
    "text": "8.3 Prediction\n\n\nCode\nget_prediction &lt;- function(bank, partner, all_data, model) {\n  selected_qtrs &lt;- all_data |&gt; filter(!!as.name(partner) &gt;=0) |&gt; head(8) |&gt; dplyr::select(Quarter)\n  event_data &lt;- all_data |&gt; inner_join(selected_qtrs) \n  first_qtr &lt;- selected_qtrs[[1,\"Quarter\"]]-1\n  est_data &lt;- all_data |&gt; filter_index(~ format(first_qtr, format = \"%Y Q%q\") )  \n   \n  #re-do estimate to avoid data leakage\n  m &lt;- lmer(formula(model), data = est_data, REML = TRUE)\n  \n  #forecast\n  fcast &lt;- broom::augment(m, newdata= event_data, allow.new.levels = TRUE) |&gt; \n    filter(BankName == bank) |&gt; \n    as_tsibble(index = Quarter, key=c(BankName, BankType))\n\n  original_scale_diff(fcast |&gt; filter(BankName == bank), all_data, bank, \".fitted\") |&gt; add_column(Partner = partner ) \n}\n\nresult &lt;- map2(partner_banks$Bank, partner_banks$Partner, get_prediction, all_data, top_model)  |&gt; \n  list_rbind() |&gt; as_tibble() |&gt; left_join(all_data |&gt; dplyr::select(observed = UBPRE524.Value),by = join_by(BankName, BankType, Quarter) ) |&gt; dplyr::select(Partner, BankName, Quarter, observed, predicted) |&gt; add_column(.model = model_name) \n\nmap2(partner_banks$Bank, partner_banks$Partner, plot_prediction, result, all_data) \n\n\n\n\n\nFigure 8.9: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 8.10: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 8.11: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 8.12: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 8.13: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 8.14: Prediction vs. Observed Event"
  },
  {
    "objectID": "model_hierarchy_event.html#abnormal-results",
    "href": "model_hierarchy_event.html#abnormal-results",
    "title": "8  Hierarchical Model",
    "section": "8.4 Abnormal Results",
    "text": "8.4 Abnormal Results\n\n\nCode\nprint_ar(result, \"Costco\", \"AMERICAN EXPRESS NATIONAL BANK (1394676)\")\nprint_ar(result, \"Costco\", \"CITIBANK, N.A. (476810)\")\nprint_ar(result, \"Walmart\", \"SYNCHRONY BANK (1216022)\")\nprint_ar(result, \"Walmart\", \"CAPITAL ONE, NATIONAL ASSOCIATION (112837)\")\nprint_ar(result, \"GAP\", \"SYNCHRONY BANK (1216022)\")\nprint_ar(result, \"GAP\", \"BARCLAYS BANK DELAWARE (2980209)\")\n\n\n\nTable 8.8: Credit Card Plans-30-89 DAYS P/D %: Abnormal Returns (original scale)\n\n\n\n\n (a) Costco (Old) - AMERICAN EXPRESS NATIONAL BANK (1394676) \n  \n\n\n\n\n\n\n (b) Costco (New) - CITIBANK, N.A. (476810) \n  \n\n\n\n\n\n\n (c) Walmart (Old) - SYNCHRONY BANK (1216022) \n  \n\n\n\n\n\n\n (d) Walmart (New) - CAPITAL ONE, NATIONAL ASSOCIATION (112837) \n  \n\n\n\n\n\n\n (e) GAP (Old) - SYNCHRONY BANK (1216022) \n  \n\n\n\n\n\n\n (f) GAP (New) - BARCLAYS BANK DELAWARE (2980209) \n  \n\n\n\n\n\n\n\n\n\n\n\nHebbali, Aravind. 2023. “Collinearity Diagnostics, Model Fit & Variable Contribution.” R Foundation for Statistical Computing. https://cran.r-project.org/web/packages/olsrr/vignettes/regression_diagnostics.html."
  },
  {
    "objectID": "model_ml.html#sec-xgboost-data",
    "href": "model_ml.html#sec-xgboost-data",
    "title": "9  XGBoost Model",
    "section": "9.1 Data Preparation",
    "text": "9.1 Data Preparation\n\n\nCode\nsource(\"functions.R\")\nlibrary(data.table)\nlibrary(xgboost)\nlibrary(Matrix)\nlibrary(caret)\nlibrary(patchwork)\nlibrary(shapviz)\nset.seed(42)\n\ntarget_label &lt;- credit_card.target_label()\n\nrun_xgb.cv &lt;- function(dtrain) {\n  param_grid &lt;- expand.grid(\n    eta = c(0.01, 0.1, 0.3),\n    max_depth = c(3, 6, 9),\n    gamma = c(0,0.1,0.2),\n    colsample_bytree = c(0.5, 0.8),\n    min_child_weight = c(1, 5),\n    subsample = c(0.5, 0.75),\n    alpha = c(0, 0.1, 1, 10),\n    lambda = c(0, 0.1, 1, 10)\n  )\n\n  # Placeholder for cross-validation results\n  cv_results &lt;- list()\n\n  for(i in seq_len(nrow(param_grid))) {\n    params &lt;- list(\n      booster = \"gbtree\",\n      eta = param_grid$eta[i],\n      max_depth = param_grid$max_depth[i],\n      subsample = param_grid$subsample[i],\n      colsample_bytree = param_grid$colsample_bytree[i],\n      min_child_weight = param_grid$min_child_weight[i],\n      alpha = param_grid$alpha[i],\n      lambda = param_grid$lambda[i],\n      objective = \"reg:squarederror\"\n    )\n    \n    cv &lt;- xgb.cv(params = params, data = dtrain, nrounds = 100, nfold = 5, early_stopping_rounds = 10)\n    cv_results[[i]] &lt;- list(params = params, cv_metrics = cv)\n  }\n\n  best_score &lt;- Inf\n  best_model &lt;- NULL\n\n  for(i in seq_along(cv_results)) {\n    score &lt;- min(cv_results[[i]]$cv_metrics$evaluation_log)\n    if(score &lt; best_score) {\n      best_score &lt;- score\n      best_model &lt;- cv_results[[i]]\n    }\n  }\n  best_model$cv_metrics[4]$evaluation_log |&gt; readr::write_csv(\"data/results/xgboost_cv_metrics.csv\")\n  best_model$params |&gt; as.data.frame() |&gt; readr::write_csv(\"data/results/xgboost_cv_params.csv\")\n}\n\nrun_xgb.caret.cv &lt;- function(train.predictors, train.outcome, n_folds, n_repeats, model_name, method = \"xgbTree\", seeds) {\n  \n  if (method == \"xgbTree\") {\n    grid &lt;- expand.grid(eta = c(0.01, 0.1, 0.3),\n                        max_depth = c(3, 6, 9),\n                        gamma = c(0, 0.1),\n                        colsample_bytree = c(0.5, 0.8),\n                        min_child_weight = c(1, 5),\n                        subsample = c(0.5, 0.75),\n                        nrounds = c(100,150,200)\n                      )\n  } else {\n    grid &lt;- expand.grid(eta = 0.01,\n                        alpha = c(0.1, 0.5, 1),\n                        lambda = c(0.1, 1, 5, 10, 15, 25, 30, 50),\n                        nrounds = 100\n    )\n  }\n\n  control &lt;- trainControl(method = \"repeatedcv\", number = n_folds, repeats = n_repeats, seeds = seeds)\n\n  # Train the model\n  model &lt;- train(train.predictors, train.outcome,\n                method = method,\n                trControl = control,\n                tuneGrid = grid,\n                metric = \"RMSE\")\n\n  # Save the plot\n  png(glue(\"data/results/{method}_tuning_plot_{model_name}.png\"), width = 800, height = 600)\n  plot(model)\n  dev.off() \n\n  #save tuning results\n  model$results  |&gt; readr::write_csv(glue(\"data/results/{method}_tuning_results_{model_name}.csv\"))\n  model$bestTune |&gt; readr::write_csv(glue(\"data/results/{method}_best_tune_{model_name}.csv\"))\n  xgb.save(model = model$finalModel, fname = glue(\"data/results/best_{method}_{model_name}.model\"))\n}\n\n# Define the number of folds and repeats\nget_cv_params &lt;- function() {\n  n_folds &lt;- 5\n  n_repeats &lt;- 3\n  seeds &lt;- lapply(1:(n_folds * n_repeats), function(x) sample.int(1000, 144))\n  seeds[[length(seeds) + 1]] &lt;- sample.int(1000, 1)  # The last seed for the final model\n\n  list(n_folds = n_folds, n_repeats = n_repeats, seeds = seeds)\n}\n\nbank_fit_result &lt;- function(bankname, data, train_test = \"Train\", target_name = \"UBPRE524.diff\") {\n  tryCatch({\n    X_filtered &lt;- data |&gt; filter(BankName == bankname) |&gt; pull(predictions)\n    Y_filtered &lt;- data |&gt; filter(BankName == bankname) |&gt; pull(target_name)\n    caret::postResample(pred = X_filtered, obs = Y_filtered) |&gt; t() |&gt;as_tibble() |&gt;\n      add_column(BankName = bankname,\n                 .type = train_test) |&gt; relocate(BankName,.type)\n  }, error = function(e) {\n    print(glue::glue(\"metrics error for {bankname}: {e}\"))\n  })\n}\n\nrun_validation &lt;- function(model, params, model_name) {\n  m &lt;- xgboost(booster = \"gbtree\", data = model$dtrain, params= params, nrounds=params$nrounds)\n\n  bank_types &lt;-  model$train |&gt; distinct(BankName, BankType)\n\n  #Training fit\n  train_predictions &lt;- predict(m, model$dtrain)\n  # See Fit on unseen data: Generate Predictions\n  test_predictions &lt;- predict(m, model$dtest)\n\n  train_result &lt;- model$train |&gt; mutate(predictions = train_predictions)\n  test_result &lt;- model$test |&gt; mutate(predictions = test_predictions)\n\n  results_est &lt;- unique(model$train$BankName) |&gt; \n                      map(bank_fit_result,train_result, \"Train\") |&gt; list_rbind()\n\n  results_test &lt;- unique(model$train$BankName) |&gt; \n                      map(bank_fit_result,test_result, \"Test\") |&gt; list_rbind()\n                        \n  comb &lt;- bind_rows(results_est, results_test) |&gt; left_join(bank_types, by = join_by(BankName)) |&gt;\n            dplyr::select(BankName, BankType, .type, RMSE, MAE, Rsquared)\n\n  comb |&gt; write_csv(glue(\"data/results/xgbTree_validation_{model_name}.csv\"))  \n  \n  importance_matrix  &lt;- xgb.importance(names(model$dtrain), model = m)\n  importance_matrix |&gt; write_csv(glue(\"data/results/xgbTree_importmatrix_{model_name}.csv\")) \n\n  #save images\n  shap_train &lt;- shapviz(m,X_pred = model$dtrain,X=data.matrix(model$train.predictors))\n  shap_test &lt;- shapviz(m,X_pred = model$dtest,X=data.matrix(model$test.predictors))\n\n  png(glue(\"images/xgb_train_imp_{model_name}.png\"), width = 800, height = 600)\n  sv_importance(shap_train, kind = \"beeswarm\", show_numbers = TRUE)\n  dev.off()\n\n  png(glue(\"images/xgb_test_imp_{model_name}.png\"), width = 800, height = 600)\n  sv_importance(shap_test, kind = \"beeswarm\", show_numbers = TRUE)\n  dev.off()\n  \n  png(glue(\"images/xgb_train_water_{model_name}.png\"), width = 800, height = 600)\n  sv_waterfall(shap_train)\n  dev.off()\n\n  png(glue(\"images/xgb_test_water_{model_name}.png\"), width = 800, height = 600)\n  sv_waterfall(shap_test)\n  dev.off()\n}\n  \nmap_prediction_to_partner &lt;- function(Bank, Partner, obs_data_w_qtr, all_data) {\n  event_data &lt;- obs_data_w_qtr |&gt; \n                  filter(BankName == Bank) |&gt; \n                    filter(!!as.name(Partner) &gt;=0) |&gt; head(8) \n\n  min_qtr &lt;- event_data |&gt; filter(Quarter == min(Quarter)) |&gt; pull(Quarter)\n  value0 &lt;- all_data |&gt; filter(BankName == Bank, Quarter == (min_qtr - 1)) |&gt; pull(UBPRE524.Value)\n  \n  event_data |&gt; \n    mutate(observed = UBPRE524.Value, predicted = value0 + cumsum(prediction))|&gt; \n      add_column(Partner = Partner)\n}\n\n\nIn our previous models, we utilised a panel dataset that captured temporal dynamics. However, machine learning algorithms require a dataset structured to reflect a single timeframe. Consequently, we need to transform our panel data into a cross-sectional format.\nThis entailed:\n\nRemoving time-related factor ‘Quarter’ (for example, ‘2020 Q1’).\nExcluding lagged values of the Credit Card Plans-30-89 DAYS P/D % to prevent look-ahead bias. This ensures that our model does not inadvertently learn from future information which could result in overfitting.\nExcluding variables that are close proxies for Credit Card Plans-30-89 DAYS P/D %, as listed in Table 9.1. These variables are closely tied to the target variable as they reflect ongoing delinquency beyond a 30-day period. This means that the model can indirectly learn future information which could result in overfitting.\n\n\n\nCode\nget_ubpr_labels() |&gt;\nfilter(Code %in% c(\"UBPRE411\", \"UBPRE523\", \"UBPRE521\")) |&gt; \n  dplyr::select(Code, Description = Desc) |&gt;\n    knitr::kable(format = \"html\")\n\n\n\n\nTable 9.1: Removed ‘proxy’ features\n\n\nCode\nDescription\n\n\n\n\nUBPRE521\nCredit Card Plans-90+ Days P/D %\n\n\nUBPRE523\n90 days+ Nonaccrual (UBPRE521+UBPRE522)\n\n\nUBPRE411\nCredit Card Plans Net Losses (%)\n\n\n\n\n\n\n\n\n\n\nCode\nmodel_data &lt;- get_model_data()\nall_data &lt;- model_data$all_data |&gt; as_tibble()           \npartner_banks &lt;- credit_card.partnerships.long()\nestimation_data &lt;- model_data$estimation_data\nobservation_data &lt;- model_data$observation_data\n\nlog_cols_wo_group &lt;- all_data |&gt;\n                    dplyr::select(contains(\".log.diff\")) |&gt; \n                    dplyr::select(-c(starts_with(\"UBPRE524.log.diff\"), \n                                     starts_with(\"UBPRE524.group\"), \n                                     starts_with(\"UBPRE524.all\")))  |&gt; names() \n\n\nsetup_train_test &lt;- function(estimation_data, predictor_cols) {\n  data &lt;- estimation_data |&gt; as_tibble() |&gt;\n            dplyr::select(c(UBPRE524.diff, BankName, BankType, all_of(predictor_cols), Qtr))  \n\n  s &lt;- createDataPartition(data$UBPRE524.diff, p = 0.70, list=FALSE)\n  training &lt;- data[s,]\n  test &lt;- data[-s,]\n\n  # Convert the data to matrix and assign output variable\n  train.outcome &lt;- training$UBPRE524.diff\n  train.predictors &lt;- sparse.model.matrix(UBPRE524.diff ~ .-1, data = training)\n  test.outcome &lt;- test$UBPRE524.diff\n  test.predictors &lt;- sparse.model.matrix(UBPRE524.diff ~ .-1, data = test)\n\n  # Convert the matrix objects to DMatrix objects\n  dtrain &lt;- xgb.DMatrix(train.predictors, label = train.outcome)\n  dtest &lt;- xgb.DMatrix(test.predictors, label = test.outcome)\n\n  list(train = training, test = test, dtrain = dtrain, dtest = dtest, train.predictors = train.predictors, \n       test.predictors = test.predictors, train.outcome = train.outcome, test.outcome = test.outcome)\n}\n\nmodel_without_group &lt;- setup_train_test(estimation_data, log_cols_wo_group)\n\n\n3 datasets were tested:\n\nAll data - note group Credit Card Plans-30-89 DAYS P/D % features removed.\nSelected features. To see if a simpler model would generalise better on unseen test data, a dataset of the top 10 important features from the All data model was selected (see Section 9.4).\n\nFurthermore, the seasonal factor Qtr (ranging from 1 to 4) was added to all datasets. Initial model testing revealed distinct seasonal trends in the residuals, as identified in the Autocorrelation Function (ACF) plots. Introducing Qtr attempts to help the model account for these seasonal patterns. An alternative approach could have involved de-seasonalising the data."
  },
  {
    "objectID": "model_ml.html#model-hyperparameter-tuning",
    "href": "model_ml.html#model-hyperparameter-tuning",
    "title": "9  XGBoost Model",
    "section": "9.2 Model Hyperparameter Tuning",
    "text": "9.2 Model Hyperparameter Tuning\nIn XGBoost we can tune the model hyperparameters e.g., maximum tree depth, to regularise the model so it does not overfit the training data.\nWe use Cross Validation to explore the hyperparameter space. This process helps identify the combination of parameters that best balance between overfitting (by avoiding too high variance) and underfitting (by avoiding too high bias).\nWe used 5-Fold Cross-Validation, repeated 3 times - each time with a different random division of the dataset into 5 folds. This means cross validation was performed a total of 15 train-test splits (3 repeats × 5 folds) to get an overall performance estimate.\nWe can see from Figure 9.1 that changes to the ETA hyperparameter, in particular, impacted the RMSE metric. ETA (value between 0 and 1) determines the weight of each tree’s contribution to the final model. A smaller ETA means making smaller updates so the model is less likely to make large adjustments based on any single observation or pattern in the data i.e. it reduces the impact of outliers or noise. An eta of 0.1 for all datasets (see Table 9.2) was selected.\n\nAll DataSelected Features\n\n\n\n\n\nFigure 9.1: Parameter Tuning for model without group features\n\n\n\n\n\n\n\nFigure 9.2: Parameter Tuning for model with selected features\n\n\n\n\n\n\n\nCode\nparams_wo_group &lt;- read_csv(\"data/results/xgbTree_best_tune_model_without_group.csv\",show_col_types = FALSE) |&gt;\n                    add_column(model = \"All Data\") |&gt; as.list()\n\nparams_select_group &lt;- read_csv(\"data/results/xgbTree_best_tune_model_select.csv\",show_col_types = FALSE) |&gt;\n                    add_column(model = \"Selected\") |&gt; as.list()\n\nbind_rows(params_wo_group,params_select_group) |&gt; \n  pivot_longer(cols=c(-model)) |&gt;\n  pivot_wider(names_from=c(model)) |&gt; rmarkdown::paged_table()  \n\n\n\n\n Table 9.2:  Optimal tuning model parameters for each dataset"
  },
  {
    "objectID": "model_ml.html#traintest-split-validation",
    "href": "model_ml.html#traintest-split-validation",
    "title": "9  XGBoost Model",
    "section": "9.3 Train/Test Split Validation",
    "text": "9.3 Train/Test Split Validation\n\n\nCode\nrun_validation(model_without_group, params_wo_group,\"wo_group\")\n\n\nThe Selected Feature dataset across all banks (Table 9.4) performed well and had the least discrepancy in our metrics.\n\nAll DataSelected Features\n\n\n\n\nCode\nbanks = unique(observation_data$BankName)\nval_wo_results &lt;- get_summary_validation.xgboost(\"wo_group\", banks)\nval_wo_results$tbl1 |&gt; rmarkdown::paged_table()\nval_wo_results$tbl2 |&gt; rmarkdown::paged_table()\nval_wo_results$tbl3 |&gt; rmarkdown::paged_table()\n\n\n\nTable 9.3: Comparing Accuracy Metrics for Training and Test data#|\n\n\n\n\n\n (a) Accuracy Metrics on Training and Test data for sub-set of banks \n  \n\n\n?(caption)\n\n\n\n\n\n\n (b) Mean Accuracy Metrics for our sub-set of banks \n  \n\n\n?(caption)\n\n\n\n\n\n\n (c) Mean Accuracy Metrics across all banks \n  \n\n\n?(caption)\n\n\n\n\n\n\n\n\nCode\nval_results &lt;- get_summary_validation.xgboost(\"model_select\", banks)\nval_results$tbl1 |&gt; rmarkdown::paged_table()\nval_results$tbl2 |&gt; rmarkdown::paged_table()\nval_results$tbl3 |&gt; rmarkdown::paged_table()\n\n\n\nTable 9.4: Comparing Accuracy Metrics for Training and Test data\n\n\n\n\n\n (a) Accuracy Metrics on Training and Test data for sub-set of banks \n  \n\n\n?(caption)\n\n\n\n\n\n\n (b) Mean Accuracy Metrics for our sub-set of banks \n  \n\n\n?(caption)\n\n\n\n\n\n\n (c) Mean Accuracy Metrics across all banks \n  \n\n\n?(caption)"
  },
  {
    "objectID": "model_ml.html#sec-xgboost-feature",
    "href": "model_ml.html#sec-xgboost-feature",
    "title": "9  XGBoost Model",
    "section": "9.4 Feature Selection",
    "text": "9.4 Feature Selection\nThe plots below show the Gain (the improvement in accuracy the model gains from including a feature) and Frequency (how often each feature is split on across all boosting tree) of each feature relative to the first feature.\nModel uses Household Debt Ratio (TDSP). Generally, portfolio features like Unused Commitments on Credit Cards were more important than exogenous economic measures.\n\nAll Data - GainAll Data - Frequency\n\n\n\n\nCode\nimportance_matrix_grp &lt;- read_csv(\"data/results/xgbTree_importmatrix_wo_group.csv\",show_col_types = FALSE)\n\nfeature_desc &lt;- get_feature_labels()\n\nimportance_matrix_lab &lt;- importance_matrix_grp |&gt; \n                          mutate(Code = stringr::str_split_i(Feature,\"\\\\.\",1)) |&gt; \n                            left_join(feature_desc,by = join_by(Code)) |&gt; \n                              mutate(Feature = paste(Feature, coalesce(Desc,\"\"), sep = \"\\n\")) |&gt; data.table()\n\nxgb.plot.importance(importance_matrix_lab, measure = \"Gain\", xlab = \"Relative importance\",top_n = 15,left_margin = 30,rel_to_first = TRUE)\n\n\n\n\n\nFigure 9.3: Feature importance using Gain\n\n\n\n\n\n\n\n\nCode\nxgb.ggplot.importance(importance_matrix_lab, measure = \"Frequency\", rel_to_first = TRUE,top_n = 15,left_margin = 30) + ylab(\"Freqency\") + theme(legend.position = \"none\")\n\n\n\n\n\nFigure 9.4: Feature importance using Frequency\n\n\n\n\n\n\n\n\n\nCode\nselected_features &lt;- importance_matrix_grp |&gt; \n                      dplyr::select(Feature) |&gt; \n                        filter(!grepl(\"BankName\", Feature)) |&gt; \n                         top_n(10) |&gt; add_row(Feature=\"Qtr\") |&gt; as.list()\n\ncv_param &lt;- get_cv_params()\n\nmodel_select &lt;- setup_train_test(estimation_data, selected_features$Feature)\n\n\n\n\nCode\nrun_xgb.caret.cv(model_select$train.predictors, model_select$train.outcome, cv_param$n_folds, cv_param$n_repeats, model_name= \"model_select\", method = \"xgbTree\", cv_param$seeds)\n\nparams_select &lt;- read_csv (\"data/results/xgbTree_best_tune_model_select.csv\", show_col_types = FALSE) |&gt; as.list()\n\nrun_validation(model_select, params_select,\"model_select\")"
  },
  {
    "objectID": "model_ml.html#estimated-fit",
    "href": "model_ml.html#estimated-fit",
    "title": "9  XGBoost Model",
    "section": "9.5 Estimated Fit",
    "text": "9.5 Estimated Fit\n\n\nCode\nparams_select &lt;- read_csv(\"data/results/xgbTree_best_tune_model_select.csv\", show_col_types = FALSE) |&gt; as.list()\n\npredictor_cols &lt;- names(model_select$train)\nest_data &lt;- estimation_data |&gt; as_tibble() |&gt; dplyr::select(c(all_of(predictor_cols)))\n\n# Convert the data to matrix and assign output variable\nestimate.outcome &lt;- est_data$UBPRE524.diff\nestimate.predictors &lt;- sparse.model.matrix(UBPRE524.diff ~ .-1, data = est_data)\n\n# Convert the matrix objects to DMatrix objects\ndEst &lt;- xgb.DMatrix(estimate.predictors, label = estimate.outcome)\n\nm &lt;- xgboost(booster = \"gbtree\", data = dEst, params= params_select, nrounds=params_select$nrounds)\n\n#Estimation fit\nest_predictions &lt;- predict(m, dEst)\n\nbank_results &lt;- estimation_data |&gt; mutate(.fitted = est_predictions,\n                                  .resid = UBPRE524.diff - est_predictions) |&gt;\n                dplyr::select(Quarter, BankName, BankType,UBPRE524.diff,.fitted,.resid) \n                  \nbank_results |&gt; \n  filter(BankName %in% observation_data$BankName) |&gt; dplyr::select(-.resid) |&gt;\n    pivot_longer(cols = where(is.numeric))|&gt; \n      ggplot(aes(x=Quarter, y = value, color=name)) + geom_line() + \n      facet_wrap(~BankType+BankName, ncol = 1) + \n      scale_colour_manual(values = c(\".fitted\" = \"#D55E00\", \n                                      UBPRE524.diff = \"darkgrey\")) + \n      theme(legend.position = \"top\", legend.title = element_blank(), legend.direction = \"vertical\")\n\n\n\n\n\nFigure 9.5: Fitted vs. Observed for estimation data on sub-set of firms for model using Selected Features"
  },
  {
    "objectID": "model_ml.html#shapley",
    "href": "model_ml.html#shapley",
    "title": "9  XGBoost Model",
    "section": "9.6 Shapley",
    "text": "9.6 Shapley\nShapley additive explanations (SHAP) provide insights into how each feature influences the model’s predictions. It’s commonly used to interpret predictions rather than regularisation (Holzinger et al. 2022). SHAP values can be averaged to assess overall feature importance across a dataset, while waterfall plots detail the feature contributions. Generally you would look at SHAP values for specific predictions, here we have averaged SHAP values for the training and test datasets.\n\nFeature Importance - TestFeature Importance - TrainingWaterfall - TestWaterfall - Training\n\n\n\n\n\nTest data all features\n\n\n\n\n\nTest data selected features\n\n\n\n\n\n\n\nTraining data all features\n\n\n\n\n\nTraining data selected features\n\n\n\n\n\n\n\nTest data all features\n\n\n\n\n\nTest data selected features\n\n\n\n\n\n\n\nTraining data all features\n\n\n\n\n\nTraining data selected features\n\n\n\n\n\n\n9.6.1 Residual diagnostics\nXGBoost, as with other machine learning models, do not make assumptions about the distribution of residuals. But it is still worth inspecting the residuals to assess whether the model is adequately capturing the underlying patterns in the data. As discussed in Section 9.1 the feature Qtr was added as the ACF plots were showing distinct seasonal patterns. Though improved, the ACF still show seasonality for some banks.\n\nCITIBANKSYNCHRONYBARCLAYSAMERICAN EXPRESSCAPITAL ONE\n\n\n\n\nCode\nbank &lt;- \"CITIBANK\"\nplot_bank_residual(bank, bank_results)\n\n\n\n\n\nFigure 9.6: XGBoost residuals\n\n\n\n\n\n\n\n\nCode\nbank &lt;- \"SYNCHRONY\"\nplot_bank_residual(bank, bank_results)\n\n\n\n\n\nFigure 9.7: Best Bank Model residuals\n\n\n\n\n\n\n\n\nCode\nbank &lt;- \"BARCLAYS\"\nplot_bank_residual(bank, bank_results)\n\n\n\n\n\nFigure 9.8: Model residuals\n\n\n\n\n\n\n\n\nCode\nbank &lt;- \"AMERICAN EXPRESS\"\nplot_bank_residual(bank, bank_results)\n\n\n\n\n\nFigure 9.9: Model residuals\n\n\n\n\n\n\n\n\nCode\nbank &lt;-  \"CAPITAL ONE\"\nplot_bank_residual(bank, bank_results)\n\n\n\n\n\nFigure 9.10: Model residuals"
  },
  {
    "objectID": "model_ml.html#prediction",
    "href": "model_ml.html#prediction",
    "title": "9  XGBoost Model",
    "section": "9.7 Prediction",
    "text": "9.7 Prediction\n\n\nCode\nobservation.outcome &lt;- observation_data$UBPRE524.diff\nobservation.predictors &lt;- sparse.model.matrix(UBPRE524.diff ~ .-1, data = observation_data  |&gt; as_tibble() |&gt; dplyr::select(all_of(predictor_cols)))\n\ndObs &lt;- xgb.DMatrix(observation.predictors, label = observation.outcome)\npredictions &lt;- predict(m, dObs)\n\nresult_obs &lt;- observation_data |&gt; mutate(prediction = predictions)\n\nresult &lt;- map2(partner_banks$Bank, partner_banks$Partner,map_prediction_to_partner, result_obs, all_data) |&gt; list_rbind() |&gt; add_column(.model = \"Selected Features\")\n\nmap2(partner_banks$Bank, partner_banks$Partner, plot_prediction, result, all_data) \n\n\n\n\n\nFigure 9.11: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 9.12: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 9.13: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 9.14: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 9.15: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 9.16: Prediction vs. Observed Event"
  },
  {
    "objectID": "model_ml.html#abnormal-results",
    "href": "model_ml.html#abnormal-results",
    "title": "9  XGBoost Model",
    "section": "9.8 Abnormal Results",
    "text": "9.8 Abnormal Results\n\n\nCode\nprint_ar(result, \"Costco\", \"AMERICAN EXPRESS NATIONAL BANK (1394676)\")\nprint_ar(result, \"Costco\", \"CITIBANK, N.A. (476810)\")\nprint_ar(result, \"Walmart\", \"SYNCHRONY BANK (1216022)\")\nprint_ar(result, \"Walmart\", \"CAPITAL ONE, NATIONAL ASSOCIATION (112837)\")\nprint_ar(result, \"GAP\", \"SYNCHRONY BANK (1216022)\")\nprint_ar(result, \"GAP\", \"BARCLAYS BANK DELAWARE (2980209)\")\n\n\n\nTable 9.5: Credit Card Plans-30-89 DAYS P/D %: Abnormal Returns (original scale)\n\n\n\n\n (a) Costco (Old) - AMERICAN EXPRESS NATIONAL BANK (1394676) \n  \n\n\n\n\n\n\n (b) Costco (New) - CITIBANK, N.A. (476810) \n  \n\n\n\n\n\n\n (c) Walmart (Old) - SYNCHRONY BANK (1216022) \n  \n\n\n\n\n\n\n (d) Walmart (New) - CAPITAL ONE, NATIONAL ASSOCIATION (112837) \n  \n\n\n\n\n\n\n (e) GAP (Old) - SYNCHRONY BANK (1216022) \n  \n\n\n\n\n\n\n (f) GAP (New) - BARCLAYS BANK DELAWARE (2980209) \n  \n\n\n\n\n\n\n\n\n\n\n\nHolzinger, A., R. Goebel, R. Fong, T. Moon, K.-R. Müller, and W. Samek. 2022. “General Pitfalls of Model-Agnostic Interpretation Methods for Machine Learning Models.” In XxAI - Beyond Explainable AI. Springer International Publishing AG. https://doi.org/10.1007/978-3-031-04083-2_4."
  },
  {
    "objectID": "model_event_summary.html#comparative-model-accuracy",
    "href": "model_event_summary.html#comparative-model-accuracy",
    "title": "10  Overall Results",
    "section": "10.1 Comparative Model Accuracy",
    "text": "10.1 Comparative Model Accuracy\nThe predictions using the estimation data are summarised by selected banks, peer group and total in Table 10.1. The models generalised well to unseen data as we see the difference between RMSE on the training and test data is small.\nOverall, the ARIMA models were the most performant. The results for our selected banks, shown in Table 10.1 (a), reveal a more mixed picture where ARIMA was not always the best model, however, for simplicity we will focus on ARIMA. Each bank has its own specification identified by the Auto ARIMA process.\n\n\nCode\nsource('functions.R')\n\ncv_train_difference &lt;- function(data, include_type = FALSE, include_bank = FALSE) {\n    selected &lt;- c(\"Model\",\".type\",\"RMSE\")\n    if (include_bank) {\n        selected &lt;- c(selected, \"BankName\")\n    }\n    if (include_type) {\n        selected &lt;- c(selected, \"BankType\")\n    }\n    \n    data |&gt; mutate(.type = if_else(.type %in% c(\"Test\", \"CV\"), \"CV/Test\", .type),\n            .type = if_else(.type == \"Training\", \"Train\", .type)) |&gt;\n    dplyr::select(all_of(selected)) |&gt;\n    pivot_wider(names_from = .type, values_from = RMSE) |&gt;\n    mutate(Difference = `CV/Test` - Train)\n}\n\nmodel_data &lt;- get_model_data()\nall_data &lt;- model_data$all_data\nestimation_data &lt;- model_data$estimation_data\nobservation_data &lt;- model_data$observation_data\n\nbanks = unique(observation_data$BankName)\nxg_results &lt;- get_summary_validation.xgboost(\"model_select\", banks, TRUE)\narima_results &lt;- get_summary_validation.arima(banks, TRUE)\nmarket_results &lt;- get_summary_validation.market(banks, TRUE)\nhier_results &lt;- get_summary_validation.hierarchy(banks, TRUE)\n\nselected_banks_data &lt;- bind_rows(xg_results$tbl1, arima_results$tbl1, market_results$tbl1, hier_results$tbl1) |&gt;\n        cv_train_difference(include_type = FALSE, include_bank = TRUE) |&gt; arrange(BankName) |&gt; \n        relocate(BankName) \n\nselected_banks_data |&gt;        \n        rmarkdown::paged_table()\n# selected_banks_data |&gt; mutate(Model = ifelse(Model==\"arima\", \"linearAR\", Model)) |&gt;\n#   arrange(BankName, desc(`CV/Test`)) |&gt;\n#     ggplot(aes(x = BankName, y = `CV/Test`, fill = Model)) +\n#     geom_bar(stat = \"identity\", position = \"dodge\") + coord_flip()+\n#         labs(y = \"CV/Test Score\", x = \"Bank Name\", fill = \"Model\") +\n#     ggtitle(\"Comparison of CV/Test Scores Across Banks and Models\") + theme_bw() + theme(legend.position=\"top\", legend.title = element_blank())+scale_fill_colorblind7()    \n  \nbind_rows(xg_results$tbl2, arima_results$tbl2, market_results$tbl2, hier_results$tbl2) |&gt;\n    cv_train_difference() |&gt; rmarkdown::paged_table()\nbind_rows(xg_results$tbl4, arima_results$tbl4, market_results$tbl4, hier_results$tbl4) |&gt;\n    arrange(BankType) |&gt; \n    cv_train_difference(include_type = FALSE, include_bank = FALSE)  |&gt;   \n    rmarkdown::paged_table()\nbind_rows(xg_results$tbl3, arima_results$tbl3, market_results$tbl3, hier_results$tbl3) |&gt;\n    cv_train_difference() |&gt;  \n    rmarkdown::paged_table()\n\n\n\nTable 10.1: Comparing all model accuracy RMSE\n\n\n\n\n (a) RMSE on Training and Cross Validation (Test for xgboost), data for\nsub-set of banks \n  \n\n\n\n\n\n\n (b) Mean RMSE for our sub-set of banks \n  \n\n\n\n\n\n\n (c) Mean RMSE by BankType \n  \n\n\n\n\n\n\n (d) Mean RMSE across all banks"
  },
  {
    "objectID": "model_event_summary.html#conclusions",
    "href": "model_event_summary.html#conclusions",
    "title": "10  Overall Results",
    "section": "10.2 Conclusions",
    "text": "10.2 Conclusions\nFor our observation period of 6 quarters, we calculated the average effect (cumulative mean) and total effect (cumulative sum) of each case study event as shown in Section 10.2.1.\nOstensibly, we can say that there is an event impact if the AR is not zero. However, we face what is called the ‘joint test problem’ which arises because we are effectively testing two things: the counterfactual model predictions and the event impact. Consequently, we need an approach to evaluate if our predictions are credible. An approach suggested by Huntington-Klein is to test using data where we expect no effect; if there were abnormal returns this would point to an issue with the model (2022). We decided to predict 6 periods before each event (refitting the model with this data removed), as our pre-event test period.\nBy comparing the pre and post abnormal returns, we cannot credibly assert that partnership events have had an impact as we see from the pre-event predictions that they too have abnormal returns.\n\n\n\n\n\nFigure 10.1: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 10.2: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 10.3: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 10.4: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 10.5: Prediction vs. Observed Event\n\n\n\n\n\n\n\nFigure 10.6: Prediction vs. Observed Event\n\n\n\n\n\n\nCode\nbank = \"CITIBANK, N.A. (476810)\"\npartner = \"Costco\"\nbank_hcast_data &lt;- result_pre |&gt; filter(BankName == bank) |&gt; filter(Partner == partner) \nbank_fcast_data &lt;- result_post |&gt; filter(BankName == bank) |&gt; filter(Partner == partner) \ntdsp_series &lt;- all_data |&gt; filter(BankName == bank) |&gt; dplyr::select(TDSP.log.diff) |&gt;\nfilter(Quarter &gt;=min(bank_hcast_data$Quarter)-5, Quarter &lt; max(bank_fcast_data$Quarter)+3)\n\np1 &lt;-\n    plot_prediction(bank, partner, bank_fcast_data, all_data) + \n    geom_line(aes(x = Quarter, y=predicted, color = \"Pre\"), \n              data = bank_hcast_data) +            \n     scale_color_manual( \n      values = c(\"Pre\" = \"blue\", \"Post\" = \"red\"),\n      labels = c(\"Pre\" = \"Predictions Pre Event\", \"Post\" = \"Predictions Post Event\")) +                  \n    theme(legend.direction = \"vertical\",legend.position = \"top\", legend.title = element_blank())\n\np2 &lt;- tdsp_series |&gt; autoplot() + geom_line(aes(x = Quarter, y = TDSP.log.diff))  +theme_bw() \n\nwith_econ_plot &lt;- patchwork::wrap_elements(p1) / patchwork::wrap_elements(p2)  + plot_layout(heights = c(2,1))\nwith_econ_plot\n\n\n\n10.2.1 Abnormal Results\n\n10.2.1.1 Costco\n\n\nCode\nprint_ar(result_pre, \"Costco\", \"AMERICAN EXPRESS NATIONAL BANK (1394676)\") \nprint_ar(result_post, \"Costco\", \"AMERICAN EXPRESS NATIONAL BANK (1394676)\")\n\n\n\nTable 10.2: AMERICAN EXPRESS (Old Partner) Abnormal Returns (original scale)\n\n\n\n\n (a) Pre Event \n  \n\n\n\n\n\n\n (b) Post Event \n  \n\n\n\n\n\n\n\nCode\nprint_ar(result_pre, \"Costco\", \"CITIBANK, N.A. (476810)\")\nprint_ar(result_post, \"Costco\", \"CITIBANK, N.A. (476810)\")\n\n\n\nTable 10.3: CITIBANK (New Partner) Abnormal Returns (original scale)\n\n\n\n\n (a) Pre Event \n  \n\n\n\n\n\n\n (b) Post Event \n  \n\n\n\n\n\n\n\n10.2.1.2 Walmart\n\n\nCode\nprint_ar(result_pre, \"Walmart\", \"SYNCHRONY BANK (1216022)\")\nprint_ar(result_post, \"Walmart\", \"SYNCHRONY BANK (1216022)\")\n\n\n\nTable 10.4: SYNCHRONY (Old Partner) Abnormal Returns (original scale)\n\n\n\n\n (a) Pre Event \n  \n\n\n\n\n\n\n (b) Post Event \n  \n\n\n\n\n\n\n\nCode\nprint_ar(result_pre, \"Walmart\", \"CAPITAL ONE, NATIONAL ASSOCIATION (112837)\")\nprint_ar(result_post, \"Walmart\", \"CAPITAL ONE, NATIONAL ASSOCIATION (112837)\")\n\n\n\nTable 10.5: CAPITAL ONE (New Partner) Abnormal Returns (original scale)\n\n\n\n\n (a) Pre Event \n  \n\n\n\n\n\n\n (b) Post Event \n  \n\n\n\n\n\n\n\n10.2.1.3 GAP\n\n\nCode\nprint_ar(result_pre, \"GAP\", \"SYNCHRONY BANK (1216022)\")\nprint_ar(result_post, \"GAP\", \"SYNCHRONY BANK (1216022)\")\n\n\n\nTable 10.6: SYNCHRONY (Old Partner) Abnormal Returns (original scale)\n\n\n\n\n (a) Pre Event \n  \n\n\n\n\n\n\n (b) Post Event \n  \n\n\n\n\n\n\n\nCode\nprint_ar(result_pre, \"GAP\", \"BARCLAYS BANK DELAWARE (2980209)\")\nprint_ar(result_post, \"GAP\", \"BARCLAYS BANK DELAWARE (2980209)\")\n\n\n\nTable 10.7: BARCLAYS BANK (New Partner) Abnormal Returns (original scale)\n\n\n\n\n (a) Pre Event \n  \n\n\n\n\n\n\n (b) Post Event \n  \n\n\n\n\n\n\n\n\n\n\n\nHuntington-Klein, Nick. 2022. The Effect: An Introduction to Research Design and Causality. CRC Press. https://theeffectbook.net/."
  },
  {
    "objectID": "model_hierarchy.html",
    "href": "model_hierarchy.html",
    "title": "11  Hierarchical study",
    "section": "",
    "text": "This approach is comparable to a treatment study that compare outcomes before and after an intervention. In our case the treatment is the partnership.\nFor example, for Costco our dummy variable ‘HasPartner’ is True for AMERICAN EXPRESS until 2016 Q2, then False after the portfolio is transferred to CITIBANK. CITIBANK’s ‘HasPartner’ is now True for Costco.\nWe can represent this as: \\[\nY_{it} = \\alpha + \\beta X_{it} + \\gamma D_{it} + \\mu_i + \\epsilon_{it}\n\\]\nWhere: \\(Y_{it}\\) is the dependent variable for entity \\(i\\) at time \\(t\\).\n\\(X_{it}\\) represents the independent variable(s) for entity \\(i\\) at time \\(t\\).\n\\(D_{it}\\) is the dummy variable ‘HasPartner’ for partner (1 has partner, 0 does not have partner).\n\\(\\alpha\\) is the constant term.\n\\(\\beta\\) is the coefficient for the independent variable(s).\n\\(\\gamma\\) is the coefficient for the dummy variable.\n\\(\\mu_i\\) represents the entity-specific fixed effect.\n\\(\\epsilon_{it}\\) is the error term.\n\nThe coefficient \\(\\gamma\\) on the dummy variable indicates the average change in the target variable associated with having a partner, controlling for other factors.\nVarious models are tested to identify which achieves the lowest AICc value. We can leverage what we have learnt so far; our starting point takes the model variables used by the best hierarchical event study.\n\n11.0.1 Model Choice\n\nm1 &lt;- lmer(UBPRE524.diff ~ HasPartner + (1 + HasPartner + Qtr+ UBPRB538.log.diff + UBPR3815.log.diff | BankName/Partner) + TDSP.log.diff + RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1, data = hier_data, REML = FALSE)\n\nm2 &lt;- lmer(UBPRE524.diff ~ HasPartner + (1 + HasPartner + Qtr+ UBPRB538.log.diff + UBPR3815.log.diff | BankName/Partner) + TDSP.log.diff + RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1 + UNRATE.log.diff.lag2, data = hier_data, REML = FALSE)\n\nm3 &lt;- lmer(UBPRE524.diff ~ HasPartner + (1 + HasPartner + Qtr+ BankType + UBPRB538.log.diff + UBPR3815.log.diff | BankName/Partner) + TDSP.log.diff + TDSP.log.diff.lag1, data = hier_data, REML = FALSE)\n\nm4 &lt;- lmer(UBPRE524.diff ~ HasPartner + (1 + HasPartner + UBPRB538.log.diff + UBPR3815.log.diff | BankName/Partner) + TDSP.log.diff + RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1, data = hier_data, REML = FALSE)\n\nm5 &lt;- lmer(UBPRE524.diff ~ HasPartner + (1 + HasPartner + UBPRE524.log.diff.lag1 + UBPRB538.log.diff + UBPR3815.log.diff | BankName/Partner) + TDSP.log.diff + RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1, data = hier_data, REML = FALSE)\n\nm6 &lt;- lmer(UBPRE524.diff ~ HasPartner + (1 + HasPartner + UBPRE524.log.diff.lag4 + UBPRB538.log.diff + UBPR3815.log.diff | BankName/Partner) + TDSP.log.diff + RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1, data = hier_data, REML = FALSE)\n\nm7 &lt;- lmer(UBPRE524.diff ~ HasPartner + (1 + HasPartner + Qtr + UBPRE524.log.diff.lag4 + UBPRB538.log.diff + UBPR3815.log.diff | BankName/Partner) + TDSP.log.diff + RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1, data = hier_data, REML = FALSE)\n\n\n\nCode\nmodel_compare &lt;- model.sel( m1,m2,m3,m4,m5,m6,m7, rank = \"AICc\")\n\nmodel_compare |&gt; as.data.frame() |&gt; rownames_to_column(var = \"Model\")|&gt; \n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt; \n        relocate(df:weight, .after = Model) |&gt;\n            dplyr::select(Model, df, logLik, AICc, delta, weight) |&gt;\n                rmarkdown::paged_table()  \n\n\n\n\n Table 11.1:  AICc Summary. The lower the AICc value, the better the balance\nbetween model complexity (number of parameters) and goodness of fit \n  \n\n\n\n\nThe best model based on AICc is model m1.\n\n\nCode\ntop_model &lt;- lmer(formula(m1), data = hier_data, REML = TRUE)\n\n#summary(top_model)\n#coef(top_model)\n\n\n\n\n11.0.2 Fixed Effects\n\nPlotCoefficients and Correlation Data\n\n\n\n\nCode\nresult_plots &lt;- generate_fixed_random_plts(top_model)\nresult_plots$FE\n\n\n\n\n\nFigure 11.1: Plot of simulated fixed effects\n\n\n\n\n\n\n\n\nCode\ntidy(top_model, effects = \"fixed\") |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n    dplyr::select(-effect) |&gt;\n    rmarkdown::paged_table() \ncov2cor(vcov(top_model)) |&gt; as.matrix() |&gt; as.data.frame() |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n    rmarkdown::paged_table() \n\n\n\nTable 11.2: Coefficients and Correlation of Fixed Effects\n\n\n\n\n\n (a) Coefficients \n  \n\n\n?(caption)\n\n\n\n\n\n\n (b) Correlation of Fixed Effects \n  \n\n\n?(caption)\n\n\n\n\n\n\n\nIf we look at the effect of ‘HasPartner’ this is 0.02 percentage points of our target measure. The std.error is half at 0.01. This suggests that the estimate is less precise, meaning there’s more uncertainty about the true value of the coefficient.\nThe high t-statistics for all the other terms, particularly UNRATE.log.diff, indicate that the effects are quite precise and the likelihood that this finding is due to chance is very small.\n\n\n11.0.3 Random Effects\n\nPlotData\n\n\n\n\nCode\nresult_plots$RE \n\n\n\n\n\nFigure 11.2: Random Effects\n\n\n\n\nThe red line indicates no effect (zero), and the dots represent the random effect estimates with their confidence intervals. Points that are distinguishable from zero (i.e. the confidence band does not cross the red line) are highlighted as black dots, whereas the grey dots are where the confidence band cross the red line.\n\n\n\n\nCode\nranef(top_model, condVar = FALSE)$BankName |&gt; as.data.frame() |&gt; \n    rownames_to_column(var = \"Entity\") |&gt; \n    filter(!grepl(\"None\", Entity)) |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n        rmarkdown::paged_table()    \nranef(top_model, condVar = FALSE)$`Partner:BankName` |&gt; as.data.frame() |&gt; \n    rownames_to_column(var = \"Entity\") |&gt; \n    filter(!grepl(\"None\", Entity)) |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n        rmarkdown::paged_table()\n\n\n\nTable 11.3: Intercept and coefficients\n\n\n\n\n\n (a) Random Effects for BankName \n  \n\n\n?(caption)\n\n\n\n\n\n\n (b) Random Effects for Partner:BankName \n  \n\n\n?(caption)\n\n\n\n\n\n\n\nFrom Figure 11.2 we can see that the random effect of Partnership is not distinguishable from zero i.e. the contribution to the variability of our target measure could be by chance alone.\n\n\n11.0.4 Conclusion\nWe did not find conclusive evidence that partnerships directly impact credit card delinquency."
  },
  {
    "objectID": "model_hierarchy_extra.html#bank-type",
    "href": "model_hierarchy_extra.html#bank-type",
    "title": "12  Hierarchical study - extra",
    "section": "12.1 Bank Type",
    "text": "12.1 Bank Type\n\nm_bt &lt;- lmer(UBPRE524.diff ~ BankType + (1 + Qtr+ UBPRB538.log.diff + UBPR3815.log.diff | BankType/BankName) + TDSP.log.diff + RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1, data = hier_data, REML = TRUE)\n\n\n12.1.1 Fixed Effects\n\nPlotCoefficients and Correlation Data\n\n\n\n\nCode\nresult_bt &lt;- generate_fixed_random_plts(m_bt)\nresult_bt$FE\n\n\n\n\n\nFigure 12.1: Plot of simulated fixed effects\n\n\n\n\n\n\n\n\nCode\ntidy(m_bt, effects = \"fixed\") |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n    dplyr::select(-effect) |&gt;\n    rmarkdown::paged_table() \ncov2cor(vcov(m_bt)) |&gt; as.matrix() |&gt; as.data.frame() |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n    rmarkdown::paged_table() \n\n\n\nTable 12.1: Coefficients and Correlation of Fixed Effects\n\n\n\n\n\n (a) Coefficients \n  \n\n\n?(caption)\n\n\n\n\n\n\n (b) Correlation of Fixed Effects \n  \n\n\n?(caption)\n\n\n\n\n\n\n\n\n\n12.1.2 Random Effects\n\nPlotData\n\n\n\n\nCode\nresult_bt$RE \n\n\n\n\n\nFigure 12.2: Random Effects\n\n\n\n\nThe red line indicates no effect (zero), and the dots represent the random effect estimates with their confidence intervals. Points that are distinguishable from zero (i.e. the confidence band does not cross the red line) are highlighted as black dots, whereas the grey dots are where the confidence band cross the red line.\n\n\n\n\nCode\nranef(m_bt, condVar = FALSE)$BankName |&gt; as.data.frame() |&gt; \n    rownames_to_column(var = \"Entity\") |&gt; \n    filter(!grepl(\"None\", Entity)) |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n        rmarkdown::paged_table()\n\n\n\nTable 12.2: Intercept and coefficients\n\n\n\n\n\n (a) Random Effects for BankName \n  \n\n\n?(caption)"
  },
  {
    "objectID": "model_hierarchy_extra.html#ubpre425",
    "href": "model_hierarchy_extra.html#ubpre425",
    "title": "12  Hierarchical study - extra",
    "section": "12.2 UBPRE425",
    "text": "12.2 UBPRE425\n\nm &lt;- lmer(UBPRE524.diff ~ UBPRE425.log.diff + (1 + Qtr+ UBPRE425.log.diff+ UBPRB538.log.diff + UBPR3815.log.diff | BankName) + TDSP.log.diff + RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1, data = hier_data, REML = TRUE)\n\n\n12.2.1 Fixed Effects\n\nPlotCoefficients and Correlation Data\n\n\n\n\nCode\nresult &lt;- generate_fixed_random_plts(m)\nresult$FE\n\n\n\n\n\nFigure 12.3: Plot of simulated fixed effects\n\n\n\n\n\n\n\n\nCode\ntidy(m, effects = \"fixed\") |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n    dplyr::select(-effect) |&gt;\n    rmarkdown::paged_table() \ncov2cor(vcov(m)) |&gt; as.matrix() |&gt; as.data.frame() |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n    rmarkdown::paged_table() \n\n\n\nTable 12.3: Coefficients and Correlation of Fixed Effects\n\n\n\n\n\n (a) Coefficients \n  \n\n\n?(caption)\n\n\n\n\n\n\n (b) Correlation of Fixed Effects \n  \n\n\n?(caption)\n\n\n\n\n\n\n\n\n\n12.2.2 Random Effects\n\nPlotData\n\n\n\n\nCode\nresult$RE \n\n\n\n\n\nFigure 12.4: Random Effects\n\n\n\n\nThe red line indicates no effect (zero), and the dots represent the random effect estimates with their confidence intervals. Points that are distinguishable from zero (i.e. the confidence band does not cross the red line) are highlighted as black dots, whereas the grey dots are where the confidence band cross the red line.\n\n\n\n\nCode\nranef(m, condVar = FALSE)$BankName |&gt; as.data.frame() |&gt; \n    rownames_to_column(var = \"Entity\") |&gt; \n    filter(!grepl(\"None\", Entity)) |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n        rmarkdown::paged_table()\n\n\n\nTable 12.4: Intercept and coefficients\n\n\n\n\n\n (a) Random Effects for BankName \n  \n\n\n?(caption)"
  },
  {
    "objectID": "model_hierarchy_extra.html#naics2",
    "href": "model_hierarchy_extra.html#naics2",
    "title": "12  Hierarchical study - extra",
    "section": "12.3 NAICS2",
    "text": "12.3 NAICS2\nGoing back to our initial Hypotheses 2: The sector e.g., retail, energy, airline, of a partnership card is a determinant of the partnership quality.\nWe can see if there is an effect based on the sector. We use the grouping 45,46, 33 with reference point 0 (no partner). This is the first 2 numbers of NAICS classification.\n\n\nCode\nread_csv(\"data/Partner_NAICS.csv\",show_col_types = FALSE) |&gt; relocate(Level2, .after = \"Partner\") |&gt; rmarkdown::paged_table()\n\n\n\n\n Table 12.5:  NAICS Partner Mapping \n  \n\n\n\n\n\nm_naics &lt;- lmer(UBPRE524.diff ~ NAICS2 + UBPRE425.log.diff + (1 + NAICS2 + Qtr+ UBPRE425.log.diff + UBPRB538.log.diff + UBPR3815.log.diff | BankName) + TDSP.log.diff + RRSFS.Pop.log.diff + UNRATE.log.diff + UNRATE.log.diff.lag1, data = hier_data, REML = TRUE)\n\n\n12.3.1 Fixed Effects\n\nPlotCoefficients and Correlation Data\n\n\n\n\nCode\n#summary(m_naics)\n#coef(m_naics)\nresult_naics &lt;- generate_fixed_random_plts(m_naics)\nresult_naics$FE\n\n\n\n\n\nFigure 12.5: Plot of simulated fixed effects\n\n\n\n\n\n\n\n\nCode\ntidy(m_naics, effects = \"fixed\") |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n    dplyr::select(-effect) |&gt;\n    rmarkdown::paged_table() \ncov2cor(vcov(m_naics)) |&gt; as.matrix() |&gt; as.data.frame() |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n    rmarkdown::paged_table() \n\n\n\nTable 12.6: Coefficients and Correlation of Fixed Effects\n\n\n\n\n\n (a) Coefficients \n  \n\n\n?(caption)\n\n\n\n\n\n\n (b) Correlation of Fixed Effects \n  \n\n\n?(caption)\n\n\n\n\n\n\n\n\n\n12.3.2 Random Effects\n\nPlotData\n\n\n\n\nCode\nresult_naics$RE \n\n\n\n\n\nFigure 12.6: Random Effects\n\n\n\n\nThe red line indicates no effect (zero), and the dots represent the random effect estimates with their confidence intervals. Points that are distinguishable from zero (i.e. the confidence band does not cross the red line) are highlighted as black dots, whereas the grey dots are where the confidence band cross the red line.\n\n\n\n\nCode\nranef(m_naics, condVar = FALSE)$BankName |&gt; as.data.frame() |&gt; \n    rownames_to_column(var = \"Entity\") |&gt; \n    filter(!grepl(\"None\", Entity)) |&gt;\n    mutate(across(where(is.numeric), \\(x) round(x,2))) |&gt;  \n        rmarkdown::paged_table()\n\n\n\nTable 12.7: Intercept and coefficients\n\n\n\n\n\n (a) Random Effects for BankName \n  \n\n\n?(caption)\n\n\n\n\n\n\n\n\n\n\n\n\n\nBureau, Consumer Financial Protection. 2022. “The Terms of Credit Card Plans (TCCP) Survey.” https://files.consumerfinance.gov/f/documents/cfpb_tccp-data_2022-07-01_2022_12-31.xlsx."
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "Barclays. 2021. “Gap Inc. Signs Credit Card Program Agreements\nwith Barclays and Mastercard.” https://cards.barclaycardus.com/banking/about-us/newsroom/gap-inc--signs-credit-card-program-agreements-with-barclays-and-/.\n\n\nBureau, Consumer Financial Protection. 2022. “The Terms of Credit\nCard Plans (TCCP) Survey.” https://files.consumerfinance.gov/f/documents/cfpb_tccp-data_2022-07-01_2022_12-31.xlsx.\n\n\n———. 2023. “2023 the Consumer Credit Card Market Report.”\nhttps://files.consumerfinance.gov/f/documents/cfpb_consumer-credit-card-market-report_2023.pdf.\n\n\nBureau, US Census. 2024. “North American Industry Classification\nSystem (NAICS).” https://www.census.gov/naics/.\n\n\nBusinesswire. 2016. “Citi Completes Acquisition and Conversion of\nCostco u.s. Co-Brand Card Portfolio.” https://www.businesswire.com/news/home/20160620005363/en/Citi-Completes-Acquisition-and-Conversion-of-Costco-U.S.-Co-Brand-Card-Portfolio.\n\n\n———. 2022. “Gap Inc. Launches New Credit Card Program in\nPartnership with Barclays and Mastercard.” https://www.businesswire.com/news/home/20220608006113/en/Gap-Inc.-Launches-New-Credit-Card-Program-in-Partnership-with-Barclays-and-Mastercard.\n\n\nCFPB. 2013. “CARD Act Report: A Review of the Impact of the CARD\nAct on the Consumer Credit Card Market.” Consumer Financial\nProtection Bureau. https://files.consumerfinance.gov/f/201309_cfpb_card-act-report.pdf.\n\n\n———. 2021. “2021 Consumer Credit Card Market Report.”\nConsumer Financial Protection Bureau. https://files.consumerfinance.gov/f/documents/cfpb_consumer-credit-card-market-report_2021.pdf.\n\n\nCFPBb. 2023. “12 CFR Part 1026 - Truth in Lending (Regulation\nz).” Consumer Financial Protection Bureau. https://www.consumerfinance.gov/rules-policy/regulations/1026/.\n\n\nCole, Allison. 2016. “Do Consumers Rely More Heavily on Credit\nCards While Unemployed?” https://www.bostonfed.org/publications/research-data-report/2016/do-consumers-rely-more-heavily-on-credit-cards-while-unemployed.aspx.\n\n\nEconomist. 2023. “Why America Has so Many Banks.”\nEconomist. https://www.economist.com/the-economist-explains/2023/05/26/why-america-has-so-many-banks.\n\n\nFED. 2023. “FR y-14M Capital Assessments and Stress\nTesting.” Federal Reserve Board. https://www.federalreserve.gov/apps/reportingforms/Report/Index/FR_Y-14M.\n\n\nFFIEC. 2023. “Central Data Repository.” Federal Financial\nInstitutions Examination Council. https://cdr.ffiec.gov/.\n\n\nGiles, Dave. 2011. “Testing for Granger Causality.” https://davegiles.blogspot.com/2011/04/testing-for-granger-causality.html.\n\n\nGrieb, Terrance, Charles Hegji, and Steven T. Jones. 2001.\n“Macroeconomic Factors, Consumer Behavior, and Bankcard Default\nRates.” Journal of Economics and Finance 25 (3): 316–27.\nhttps://doi.org/10.1007/BF02745892.\n\n\nHebbali, Aravind. 2023. “Collinearity Diagnostics, Model Fit &\nVariable Contribution.” R Foundation for Statistical Computing.\nhttps://cran.r-project.org/web/packages/olsrr/vignettes/regression_diagnostics.html.\n\n\nHolzinger, A., R. Goebel, R. Fong, T. Moon, K.-R. Müller, and W. Samek.\n2022. “General Pitfalls of Model-Agnostic Interpretation Methods\nfor Machine Learning Models.” In XxAI - Beyond Explainable\nAI. Springer International Publishing AG. https://doi.org/10.1007/978-3-031-04083-2_4.\n\n\nHuntington-Klein, Nick. 2022. The Effect: An Introduction to\nResearch Design and Causality. CRC Press. https://theeffectbook.net/.\n\n\nHyndman, Rob J., and George Athanasopoulos. 2021. Forecasting:\nPrinciples and Practice. OTexts. https://otexts.com/fpp3/.\n\n\nHyndman, Rob J., and Yangzhuoran Yang. 2023. “Introduction to the\nTsfeatures Package.” https://cran.r-project.org/web/packages/tsfeatures/vignettes/tsfeatures.html.\n\n\nIntelligence, S&P Global Market. 2019. “Capital One to Acquire\nWalmart’s Credit Card Receivables.” https://www.spglobal.com/marketintelligence/en/news-insights/trending/VHYZBHXtY1xdBCP2sIlmag2.\n\n\nJambulapati, Vikram, and Joanna Stavins. 2013. “The Credit CARD\nAct of 2009: What Did Banks Do?” https://www.bostonfed.org/-/media/Documents/Workingpapers/PDF/ppdp1307.pdf.\n\n\nLiu, Chunlin, and Sumit Agarwal. 2003. “Determinants of Credit\nCard Delinquency and Bankruptcy: Macroeconomic Factors.”\nJournal of Economics and Finance 27 (March): 75–84. https://doi.org/10.1007/BF02751591.\n\n\nMacKinlay, A. Craig. 1997. “Event Studies in Economics and\nFinance.” Journal of Economic Literature 35 (1): 13–39.\nhttps://uoelibrary.idm.oclc.org/login?url=https://www.proquest.com/scholarly-journals/event-studies-economics-finance/docview/213164851/se-2.\n\n\nMann, Ronald J. 2008. “Patterns of Credit Card Use Among Low and\nModerate Income Households.” https://scholarship.law.columbia.edu/faculty_scholarship/1528.\n\n\nReddit. 2022. “Gap Card Changing from Synchrony to\nBarclays.” https://reddit.com/r/CreditCards/comments/t5ihr4/gap_card_changing_from_synchrony_to_barclays/.\n\n\nReserve, US Federal. 2023. “Charge-Off and Delinquency Rates on\nLoans and Leases at Commercial Banks.” https://www.federalreserve.gov/releases/chargeoff/delallnsa.htm.\n\n\nSt. Louis, Federal Reserve Bank of. 2023. “Federal Reserve\nEconomic Data.” Federal Reserve Bank of St. Louis. https://fred.stlouisfed.org/.\n\n\nStavins, Joanna. 2000. “Credit Card Borrowing, Delinquency, and\nPersonal Bankruptcy.” https://www.bostonfed.org/publications/new-england-economic-review/2000-issues/issue-july-august-2000/credit-card-borrowing-deliquency-and-personal-bankruptcy.aspx.\n\n\nTaghiyeh, Sajjad, David C. Lengacher, and Robert B. Handfield. 2021.\n“Loss Rate Forecasting Framework Based on Macroeconomic Changes:\nApplication to US Credit Card Industry.” Expert Systems With\nApplications 165. https://doi.org/10.1016/j.eswa.2020.113954.\n\n\nWalmart. 2018. “Walmart and Capital One Sign Credit Card Program\nAgreement.” https://corporate.walmart.com/news/2018/07/26/walmart-and-capital-one-sign-credit-card-program-agreement."
  },
  {
    "objectID": "data_banks.html#sec-peers",
    "href": "data_banks.html#sec-peers",
    "title": "13  Bank Peer Groups",
    "section": "13.1 Peer Group Membership",
    "text": "13.1 Peer Group Membership\n\n\nCode\nbank_members &lt;- credit_card.overdue_3089() |&gt; \n                as_tibble() |&gt; \n                group_by(BankName,BankType) |&gt; \n                summarise(total_bal = sum(abs(Value),na.rm=T)) |&gt;\n                filter(!(is.na(total_bal)|total_bal==0))\nknitr::kable(bank_members |&gt; filter(BankType==\"LargeBank\") |&gt; dplyr::select(BankName)) \nknitr::kable(bank_members |&gt; filter(BankType==\"LargeCreditCardBank\") |&gt; dplyr::select(BankName))\nknitr::kable(bank_members |&gt; filter(BankType==\"OtherBank\") |&gt; dplyr::select(BankName))\n\n\n\nTable 13.1: Peer Group Membership\n\n\n\n\n(a) Large Banks\n\n\nBankName\n\n\n\n\nALLY BANK (3284070)\n\n\nBANK OF AMERICA, NATIONAL ASSOCIATION (480228)\n\n\nBMO HARRIS BANK NATIONAL ASSOCIATION (75633)\n\n\nCAPITAL ONE, NATIONAL ASSOCIATION (112837)\n\n\nCITIBANK, N.A. (476810)\n\n\nCITIZENS BANK, NATIONAL ASSOCIATION (3303298)\n\n\nFIFTH THIRD BANK, NATIONAL ASSOCIATION (723112)\n\n\nFIRST-CITIZENS BANK & TRUST COMPANY (491224)\n\n\nGOLDMAN SACHS BANK USA (2182786)\n\n\nHSBC BANK USA, NATIONAL ASSOCIATION (413208)\n\n\nHUNTINGTON NATIONAL BANK, THE (12311)\n\n\nJPMORGAN CHASE BANK, NATIONAL ASSOCIATION (852218)\n\n\nKEYBANK NATIONAL ASSOCIATION (280110)\n\n\nMANUFACTURERS AND TRADERS TRUST COMPANY (501105)\n\n\nPNC BANK, NATIONAL ASSOCIATION (817824)\n\n\nREGIONS BANK (233031)\n\n\nSANTANDER BANK, NATIONAL ASSOCIATION (722777)\n\n\nTD BANK, N.A. (497404)\n\n\nTRUIST BANK (852320)\n\n\nU.S. BANK NATIONAL ASSOCIATION (504713)\n\n\nUBS BANK USA (3212149)\n\n\nWELLS FARGO BANK, NATIONAL ASSOCIATION (451965)\n\n\n\n\n\n\n(b) Large Credit Card Banks\n\n\nBankName\n\n\n\n\nAMERICAN EXPRESS NATIONAL BANK (1394676)\n\n\nBARCLAYS BANK DELAWARE (2980209)\n\n\nCOMENITY BANK (1391778)\n\n\nCOMENITY CAPITAL BANK (3224580)\n\n\nDISCOVER BANK (30810)\n\n\nMERRICK BANK CORPORATION (2615190)\n\n\nSYNCHRONY BANK (1216022)\n\n\n\n\n\n\n(c) Other Banks\n\n\n\n\n\nBankName\n\n\n\n\n1ST FINANCIAL BANK USA (526452)\n\n\n1ST SECURITY BANK OF WASHINGTON (1018927)\n\n\n1ST STATE BANK (3223305)\n\n\n1ST SUMMIT BANK (526519)\n\n\n5STAR BANK (455253)\n\n\nABACUS FEDERAL SAVINGS BANK (762773)\n\n\nACADEMY BANK, N.A. (535753)\n\n\nADIRONDACK BANK (101671)\n\n\nADIRONDACK TRUST COMPANY, THE (645317)\n\n\nALAMOSA STATE BANK (869953)\n\n\nALDEN STATE BANK (388744)\n\n\nALERUS FINANCIAL, NATIONAL ASSOCIATION (933256)\n\n\nALLIANCE BANK (176464)\n\n\nALLIANCE BANK (21658)\n\n\nALLIANCE BANK (493741)\n\n\nALLIANCE COMMUNITY BANK (924937)\n\n\nALLIED FIRST BANK, SB (2140348)\n\n\nALPINE BANK (260055)\n\n\nAMALGAMATED BANK OF CHICAGO (397531)\n\n\nAMARILLO NATIONAL BANK (353555)\n\n\nAMERANT BANK, NATIONAL ASSOCIATION (83638)\n\n\nAMERICAN BANK & TRUST (275358)\n\n\nAMERICAN BANK & TRUST COMPANY (83834)\n\n\nAMERICAN BANK & TRUST COMPANY INC. (2919898)\n\n\nAMERICAN BANK (2580243)\n\n\nAMERICAN BANK AND TRUST COMPANY, NATIONAL ASSOCIATION (2733263)\n\n\nAMERICAN BANK OF BEAVER DAM (510648)\n\n\nAMERICAN BANK OF COMMERCE (215662)\n\n\nAMERICAN BUSINESS BANK (2734729)\n\n\nAMERICAN COMMERCIAL BANK & TRUST, NATIONAL ASSOCIATION (856243)\n\n\nAMERICAN COMMUNITY BANK OF INDIANA (1010574)\n\n\nAMERICAN HERITAGE BANK (2960555)\n\n\nAMERICAN HERITAGE BANK (311050)\n\n\nAMERICAN NATION BANK (256058)\n\n\nAMERICAN NATIONAL BANK (660655)\n\n\nAMERICAN NATIONAL BANK AND TRUST COMPANY (958727)\n\n\nAMERICAN NATIONAL BANK-FOX CITIES (2051127)\n\n\nAMERICAN SAVINGS BANK, F.S.B. (54973)\n\n\nAMERICAN STATE BANK & TRUST COMPANY OF WILLISTON (244251)\n\n\nAMERICAN STATE BANK (276645)\n\n\nAMERICAN STATE BANK (735441)\n\n\nAMERIPRISE BANK, FSB (3470239)\n\n\nAMERIS BANK (764030)\n\n\nANDERSON BROTHERS BANK (6329)\n\n\nANDOVER BANK, THE (27614)\n\n\nANDROSCOGGIN SAVINGS BANK (132107)\n\n\nANSTAFF BANK (261940)\n\n\nANZ GUAM, INC. (1852569)\n\n\nAPOLLO TRUST COMPANY (368522)\n\n\nAPPLE CREEK BANKING COMPANY, THE (213912)\n\n\nAPPLIED BANK (2467670)\n\n\nARMED FORCES BANK, NATIONAL ASSOCIATION (983457)\n\n\nARMSTRONG BANK (470452)\n\n\nARTHUR STATE BANK (591320)\n\n\nARTISANS’ BANK (73116)\n\n\nARVEST BANK (311845)\n\n\nASPIRE BANK (668053)\n\n\nASSOCIATED BANK, NATIONAL ASSOCIATION (917742)\n\n\nASTRA BANK (1003455)\n\n\nATLANTIC UNION BANK (693224)\n\n\nAVAILA BANK (859141)\n\n\nAVIDIA BANK (619701)\n\n\nAXIOM BANK, NATIONAL ASSOCIATION (408875)\n\n\nBADGER BANK (846945)\n\n\nBAKER BOYER NATIONAL BANK (69678)\n\n\nBALLSTON SPA NATIONAL BANK (505)\n\n\nBANCCENTRAL, NATIONAL ASSOCIATION (251352)\n\n\nBANCO DO BRASIL AMERICAS (110936)\n\n\nBANCO POPULAR DE PUERTO RICO (940311)\n\n\nBANGOR SAVINGS BANK (419406)\n\n\nBANK & TRUST COMPANY (496845)\n\n\nBANK 1ST (142049)\n\n\nBANK FIRST, NATIONAL ASSOCIATION (594947)\n\n\nBANK FIVE NINE (806846)\n\n\nBANK FORWARD (812557)\n\n\nBANK INDEPENDENT (539032)\n\n\nBANK IOWA (187947)\n\n\nBANK MICHIGAN (382742)\n\n\nBANK MIDWEST (45551)\n\n\nBANK OF 1889 (864846)\n\n\nBANK OF ALMA (564052)\n\n\nBANK OF ANN ARBOR (2390929)\n\n\nBANK OF BOTETOURT (759625)\n\n\nBANK OF BREWTON (351131)\n\n\nBANK OF BRODHEAD, THE (517441)\n\n\nBANK OF BROOKHAVEN (2877831)\n\n\nBANK OF CAMILLA (124830)\n\n\nBANK OF CANTON, THE (853804)\n\n\nBANK OF CAVE CITY (629148)\n\n\nBANK OF CHARLOTTE COUNTY, THE (667524)\n\n\nBANK OF CLARKE (753324)\n\n\nBANK OF COLORADO (255659)\n\n\nBANK OF DEERFIELD, THE (588245)\n\n\nBANK OF DELMARVA, THE (885225)\n\n\nBANK OF DIXON COUNTY (920359)\n\n\nBANK OF DUDLEY (546535)\n\n\nBANK OF EASTERN OREGON (14865)\n\n\nBANK OF ELK RIVER, THE (10250)\n\n\nBANK OF FARMINGTON (976534)\n\n\nBANK OF FOREST (642437)\n\n\nBANK OF GUAM (711472)\n\n\nBANK OF HAWAII (795968)\n\n\nBANK OF HAZELTON (856458)\n\n\nBANK OF HOLLY SPRINGS, THE (835743)\n\n\nBANK OF HOPE (671464)\n\n\nBANK OF IBERIA (790150)\n\n\nBANK OF IDAHO (300960)\n\n\nBANK OF JACKSON HOLE TRUST (898458)\n\n\nBANK OF KAUKAUNA, THE (380944)\n\n\nBANK OF LABOR (246657)\n\n\nBANK OF LAFAYETTE, THE (944739)\n\n\nBANK OF LAKE MILLS (477349)\n\n\nBANK OF LOUISIANA (271136)\n\n\nBANK OF LUXEMBURG (580548)\n\n\nBANK OF MARIN (1436204)\n\n\nBANK OF MARION, THE (858528)\n\n\nBANK OF MILLBROOK (175609)\n\n\nBANK OF MILTON (426945)\n\n\nBANK OF MISSOURI, THE (330855)\n\n\nBANK OF OAK RIDGE (2903123)\n\n\nBANK OF PENSACOLA (581237)\n\n\nBANK OF PRAIRIE DU SAC (997847)\n\n\nBANK OF RANTOUL (37949)\n\n\nBANK OF RIPLEY (433550)\n\n\nBANK OF SOUTHSIDE VIRGINIA, THE (610128)\n\n\nBANK OF SPRINGFIELD (248240)\n\n\nBANK OF STOCKTON (479268)\n\n\nBANK OF SUN PRAIRIE (124344)\n\n\nBANK OF TAMPA, THE (273336)\n\n\nBANK OF THE FEDERATED STATES OF MICRONESIA (718275)\n\n\nBANK OF THE FLINT HILLS (552059)\n\n\nBANK OF THE MOUNTAINS, INC. (422116)\n\n\nBANK OF THE PACIFIC (307679)\n\n\nBANK OF THE PANHANDLE (192857)\n\n\nBANK OF THE SIERRA (662369)\n\n\nBANK OF TRAVELERS REST (589523)\n\n\nBANK OF VERNON, THE (382537)\n\n\nBANK OF WISCONSIN DELLS (894348)\n\n\nBANK OF WOLCOTT (729842)\n\n\nBANK OF WRIGHTSVILLE (176437)\n\n\nBANK OF YAZOO CITY (118736)\n\n\nBANK OF YORK (922924)\n\n\nBANK OZK (107244)\n\n\nBANKCDA (3010363)\n\n\nBANKCHAMPAIGN, NATIONAL ASSOCIATION (436739)\n\n\nBANKERS BANK, THE (859655)\n\n\nBANKERS TRUST COMPANY (811046)\n\n\nBANKERS’ BANK (408642)\n\n\nBANKERS’ BANK OF KANSAS (1218446)\n\n\nBANKFIRST (117458)\n\n\nBANKFIRST FINANCIAL SERVICES (914648)\n\n\nBANKIOWA (737548)\n\n\nBANKPLUS (121642)\n\n\nBANKSTAR FINANCIAL (109453)\n\n\nBANNER BANK (352772)\n\n\nBANNER BANKS (453147)\n\n\nBAR HARBOR BANK AND TRUST COMPANY (522605)\n\n\nBARABOO STATE BANK (24949)\n\n\nBATH SAVINGS INSTITUTION (433505)\n\n\nBAY BANK (2329200)\n\n\nBAYBANK (242958)\n\n\nBAYCOAST BANK (771609)\n\n\nBENCHMARK BANK (980960)\n\n\nBENCHMARK COMMUNITY BANK (94522)\n\n\nBENEFICIAL STATE BANK (3608751)\n\n\nBENTON STATE BANK (208347)\n\n\nBERKSHIRE BANK (473501)\n\n\nBETTER BANKS (851631)\n\n\nBLACK RIVER COUNTRY BANK (603540)\n\n\nBLACKHAWK BANK & TRUST (890742)\n\n\nBLACKHAWK BANK (27548)\n\n\nBLC COMMUNITY BANK (578741)\n\n\nBLISSFIELD STATE BANK (937843)\n\n\nBLUE RIDGE BANK, NATIONAL ASSOCIATION (233527)\n\n\nBLUFF VIEW BANK (167453)\n\n\nBMW BANK OF NORTH AMERICA (2850722)\n\n\nBRADESCO BANK (725732)\n\n\nBRADFORD NATIONAL BANK OF GREENVILLE, THE (720746)\n\n\nBRAVERA BANK (971959)\n\n\nBREMER BANK, NATIONAL ASSOCIATION (800657)\n\n\nBRIDGE CITY STATE BANK (43959)\n\n\nBRIDGE COMMUNITY BANK (882541)\n\n\nBRISTOL MORGAN BANK (807348)\n\n\nBRYANT STATE BANK (82257)\n\n\nBUCKEYE STATE BANK (870913)\n\n\nBUILTWELL BANK (234739)\n\n\nBUTTE STATE BANK (1004256)\n\n\nBYRON BANK (325534)\n\n\nCACHE VALLEY BANK (995076)\n\n\nCADENCE BANK (606046)\n\n\nCALLAWAY BANK, THE (719656)\n\n\nCAMBRIDGE TRUST COMPANY (736206)\n\n\nCAMDEN NATIONAL BANK (593007)\n\n\nCAPE COD FIVE CENTS SAVINGS BANK (664206)\n\n\nCAPITAL BANK, NATIONAL ASSOCIATION (2808602)\n\n\nCAPITAL CITY BANK (876634)\n\n\nCAPITOL BANK (2339599)\n\n\nCAROLINA BANK & TRUST COMPANY (355120)\n\n\nCASHMERE VALLEY BANK (574976)\n\n\nCB&S BANK, INC. (594433)\n\n\nCBBC BANK (218131)\n\n\nCBI BANK & TRUST (830542)\n\n\nCCB COMMUNITY BANK (655839)\n\n\nCECILIAN BANK, THE (982142)\n\n\nCEDAR RAPIDS BANK AND TRUST COMPANY (3029589)\n\n\nCELTIC BANK CORPORATION (2998576)\n\n\nCENTENNIAL BANK (456045)\n\n\nCENTIER BANK (783648)\n\n\nCENTINEL BANK OF TAOS (800853)\n\n\nCENTRAL BANK & TRUST COMPANY (1007015)\n\n\nCENTRAL BANK (546544)\n\n\nCENTRAL BANK (622774)\n\n\nCENTRAL SAVINGS BANK (382050)\n\n\nCENTRAL TRUST BANK, THE (853952)\n\n\nCENTRAL VALLEY COMMUNITY BANK (703767)\n\n\nCENTURY BANK & TRUST (944337)\n\n\nCENTURY BANK (58636)\n\n\nCENTURY BANK AND TRUST (694847)\n\n\nCFBANK NATIONAL ASSOCIATION (767974)\n\n\nCFSBANK (100777)\n\n\nCHARLES SCHWAB PREMIER BANK, SSB (1893049)\n\n\nCHARLEVOIX STATE BANK (2232757)\n\n\nCHELSEA GROTON BANK (345309)\n\n\nCHELSEA SAVINGS BANK (771748)\n\n\nCHEMUNG CANAL TRUST COMPANY (884303)\n\n\nCHESTER NATIONAL BANK (231279)\n\n\nCITIZENS & NORTHERN BANK (895710)\n\n\nCITIZENS ALLIANCE BANK (279954)\n\n\nCITIZENS AND FARMERS BANK (928421)\n\n\nCITIZENS BANK & TRUST (964250)\n\n\nCITIZENS BANK & TRUST CO. OF JACKSON (765318)\n\n\nCITIZENS BANK & TRUST COMPANY (192147)\n\n\nCITIZENS BANK & TRUST COMPANY (384830)\n\n\nCITIZENS BANK (44741)\n\n\nCITIZENS BANK (778738)\n\n\nCITIZENS BANK (783844)\n\n\nCITIZENS BANK COMPANY, THE (1010015)\n\n\nCITIZENS BANK MINNESOTA (874050)\n\n\nCITIZENS BANK OF CHATSWORTH (441135)\n\n\nCITIZENS BANK OF EDMOND, THE (172457)\n\n\nCITIZENS BANK OF ELDON (954251)\n\n\nCITIZENS BANK OF KENTUCKY, INC (495419)\n\n\nCITIZENS BANK OF LAS CRUCES (1016857)\n\n\nCITIZENS BANK OF MORGANTOWN, INC. (897237)\n\n\nCITIZENS BANK OF PHILADELPHIA, THE (29636)\n\n\nCITIZENS BANK OF THE SOUTH (367431)\n\n\nCITIZENS BANK, THE (856748)\n\n\nCITIZENS BANK, THE (961259)\n\n\nCITIZENS FIRST BANK (1867983)\n\n\nCITIZENS FIRST BANK (2882983)\n\n\nCITIZENS FIRST BANK (716954)\n\n\nCITIZENS FIRST NATIONAL BANK (424240)\n\n\nCITIZENS INDEPENDENT BANK (825753)\n\n\nCITIZENS NATIONAL BANK (700252)\n\n\nCITIZENS NATIONAL BANK (717737)\n\n\nCITIZENS NATIONAL BANK OF BLUFFTON, THE (738013)\n\n\nCITIZENS NATIONAL BANK OF CHEBOYGAN (773742)\n\n\nCITIZENS NATIONAL BANK OF PARK RAPIDS, THE (877752)\n\n\nCITIZENS NATIONAL BANK, THE (991555)\n\n\nCITIZENS SAVINGS BANK (730745)\n\n\nCITIZENS SAVINGS BANK (758842)\n\n\nCITIZENS SAVINGS BANK AND TRUST COMPANY (55635)\n\n\nCITIZENS STATE BANK (149150)\n\n\nCITIZENS STATE BANK (212344)\n\n\nCITIZENS STATE BANK (356239)\n\n\nCITIZENS STATE BANK (413543)\n\n\nCITIZENS STATE BANK (54656)\n\n\nCITIZENS STATE BANK (937759)\n\n\nCITIZENS STATE BANK - LA CROSSE (447557)\n\n\nCITIZENS STATE BANK AT MOHALL, THE (688453)\n\n\nCITIZENS STATE BANK OF ARLINGTON (274856)\n\n\nCITIZENS STATE BANK OF LOYAL (479446)\n\n\nCITIZENS STATE BANK OF NEW CASTLE (1000641)\n\n\nCITIZENS STATE BANK OF OURAY, THE (98351)\n\n\nCITIZENS STATE BANK, THE (273550)\n\n\nCITIZENS STATE BANK, THE (572459)\n\n\nCITIZENS TRI-COUNTY BANK (162337)\n\n\nCITIZENS TRUST BANK (680130)\n\n\nCITIZENS’ BANK, INC. (563336)\n\n\nCITY BANK (575254)\n\n\nCITY NATIONAL BANK (63069)\n\n\nCITY NATIONAL BANK (697950)\n\n\nCITY NATIONAL BANK OF COLORADO CITY, THE (799854)\n\n\nCITY NATIONAL BANK OF TAYLOR, THE (181963)\n\n\nCITY NATIONAL BANK OF WEST VIRGINIA (1011526)\n\n\nCITY STATE BANK (252041)\n\n\nCIVISTA BANK (542528)\n\n\nCLARE BANK, NATIONAL ASSOCIATION (988144)\n\n\nCLB THE COMMUNITY BANK (930853)\n\n\nCLEAR MOUNTAIN BANK, INC. (886624)\n\n\nCLEVELAND STATE BANK (48440)\n\n\nCLEVELAND STATE BANK, THE (12142)\n\n\nCLINTON NATIONAL BANK, THE (773443)\n\n\nCNB BANK & TRUST, NA (613343)\n\n\nCNB BANK (399517)\n\n\nCOASTAL COMMUNITY BANK (2562164)\n\n\nCOLORADO BANK AND TRUST COMPANY OF LA JUNTA, THE (285151)\n\n\nCOLUMBIA BANK (174572)\n\n\nCOLUMBUS BANK AND TRUST COMPANY (241559)\n\n\nCOMERICA BANK (60143)\n\n\nCOMMERCE BANK (601050)\n\n\nCOMMERCIAL AND SAVINGS BANK OF MILLERSBURG, OHIO, THE (189129)\n\n\nCOMMERCIAL BANK (1225752)\n\n\nCOMMERCIAL BANK (497039)\n\n\nCOMMERCIAL BANK OF MOTT (1008553)\n\n\nCOMMERCIAL BANK OF OZARK, THE (522034)\n\n\nCOMMERCIAL BANK OF TEXAS, N.A. (885869)\n\n\nCOMMERCIAL SAVINGS BANK (194440)\n\n\nCOMMERCIAL STATE BANK (479754)\n\n\nCOMMERCIAL STATE BANK OF WAGNER (129853)\n\n\nCOMMERCIAL TRUST COMPANY OF FAYETTE (709451)\n\n\nCOMMODORE BANK (548829)\n\n\nCOMMUNITY 1ST BANK LAS VEGAS (768458)\n\n\nCOMMUNITY BANK (371924)\n\n\nCOMMUNITY BANK DELAWARE (3446784)\n\n\nCOMMUNITY BANK MANKATO (835257)\n\n\nCOMMUNITY BANK OF ELMHURST (2044820)\n\n\nCOMMUNITY BANK OF PARKERSBURG (901134)\n\n\nCOMMUNITY BANK OF THE CHESAPEAKE (697978)\n\n\nCOMMUNITY BANK, THE (729011)\n\n\nCOMMUNITY FINANCIAL SERVICES BANK (698144)\n\n\nCOMMUNITY FIRST BANK (175140)\n\n\nCOMMUNITY FIRST BANK (2642598)\n\n\nCOMMUNITY FIRST BANK (62147)\n\n\nCOMMUNITY FIRST BANK INC. (1440117)\n\n\nCOMMUNITY FIRST BANK, NATIONAL ASSOCIATION (579319)\n\n\nCOMMUNITY NATIONAL BANK & TRUST (923752)\n\n\nCOMMUNITY NATIONAL BANK & TRUST OF TEXAS (738769)\n\n\nCOMMUNITY NATIONAL BANK (270504)\n\n\nCOMMUNITY RESOURCE BANK (813853)\n\n\nCOMMUNITY SAVINGS BANK (646743)\n\n\nCOMMUNITY SPIRIT BANK (470032)\n\n\nCOMMUNITY STATE BANK (130345)\n\n\nCOMMUNITY STATE BANK (367150)\n\n\nCOMMUNITY STATE BANK (849348)\n\n\nCONCORDIA BANK (164957)\n\n\nCONNECTONE BANK (3317932)\n\n\nCONVERSE COUNTY BANK, THE (72258)\n\n\nCONWAY NATIONAL BANK, THE (631422)\n\n\nCOREFIRST BANK & TRUST (361055)\n\n\nCORNHUSKER BANK (544652)\n\n\nCORTRUST BANK NATIONAL ASSOCIATION (61355)\n\n\nCORYDON STATE BANK (837046)\n\n\nCOULEE BANK (457752)\n\n\nCOUNTRY CLUB BANK (625654)\n\n\nCOUNTY BANK (1459735)\n\n\nCRAWFORD COUNTY TRUST AND SAVINGS BANK (810544)\n\n\nCREDIT ONE BANK, NATIONAL ASSOCIATION (639567)\n\n\nCROGHAN COLONIAL BANK, THE (362717)\n\n\nCROSSBRIDGE COMMUNITY BANK (465672)\n\n\nCS BANK (514048)\n\n\nCUMBERLAND VALLEY NATIONAL BANK & TRUST COMPANY (647218)\n\n\nCUSB BANK (900146)\n\n\nCUSTOMERS BANK (2354985)\n\n\nD.L. EVANS BANK (543262)\n\n\nDACOTAH BANK (256553)\n\n\nDAIRY STATE BANK (57451)\n\n\nDAKOTA HERITAGE BANK (860352)\n\n\nDAKOTA WESTERN BANK (827458)\n\n\nDALLAS CAPITAL BANK, NATIONAL ASSOCIATION (384652)\n\n\nDANVILLE STATE SAVINGS BANK (223845)\n\n\nDART BANK, THE (47247)\n\n\nDEERWOOD BANK (314257)\n\n\nDELAWARE NATIONAL BANK OF DELHI, THE (236603)\n\n\nDEMOTTE STATE BANK (539340)\n\n\nDENISON STATE BANK, THE (869551)\n\n\nDIAMOND BANK (27847)\n\n\nDIME COMMUNITY BANK (23504)\n\n\nDMB COMMUNITY BANK (56548)\n\n\nDOLLAR BANK, FEDERAL SAVINGS BANK (961624)\n\n\nDU QUOIN STATE BANK (823142)\n\n\nDUBUQUE BANK AND TRUST COMPANY (642549)\n\n\nEAGLE BANK AND TRUST COMPANY (453446)\n\n\nEAST WEST BANK (197478)\n\n\nEAST WISCONSIN SAVINGS BANK (35879)\n\n\nELDERTON STATE BANK (282824)\n\n\nELKHORN VALLEY BANK & TRUST (439356)\n\n\nELKTON BANK & TRUST COMPANY (998648)\n\n\nEMPRISE BANK (65858)\n\n\nENTERPRISE BANK & TRUST (1190476)\n\n\nENTERPRISE BANK OF SOUTH CAROLINA (457426)\n\n\nEQUITABLE BANK (81175)\n\n\nEQUITABLE BANK, S.S.B., THE (336576)\n\n\nEQUITY BANK (139656)\n\n\nESB BANK (40855)\n\n\nESB FINANCIAL (918954)\n\n\nEVANGELINE BANK AND TRUST COMPANY, THE (372538)\n\n\nEVANS BANK, NATIONAL ASSOCIATION (292908)\n\n\nEVERGREEN NATIONAL BANK (427858)\n\n\nEXCHANGE BANK & TRUST (144052)\n\n\nEXCHANGE BANK OF ALABAMA, THE (672537)\n\n\nEXCHANGE STATE BANK (769334)\n\n\nEXCHANGE STATE BANK (787141)\n\n\nF&M BANK (163857)\n\n\nFAHEY BANKING COMPANY, THE (520423)\n\n\nFAIRFAX STATE SAVINGS BANK (682648)\n\n\nFAIRFIELD FEDERAL SAVINGS AND LOAN ASSOCIATION OF LANCASTER (666974)\n\n\nFAIRMOUNT STATE BANK, THE (503547)\n\n\nFALCON INTERNATIONAL BANK (564557)\n\n\nFARM BUREAU BANK FSB (2819167)\n\n\nFARMERS & MERCHANTS BANK & TRUST (672247)\n\n\nFARMERS & MERCHANTS BANK & TRUST (888141)\n\n\nFARMERS & MERCHANTS BANK (176325)\n\n\nFARMERS & MERCHANTS BANK (64730)\n\n\nFARMERS & MERCHANTS BANK (713926)\n\n\nFARMERS & MERCHANTS BANK (763930)\n\n\nFARMERS & MERCHANTS BANK OF CENTRAL CALIFORNIA (808260)\n\n\nFARMERS & MERCHANTS BANK OF NORTH DAKOTA (954158)\n\n\nFARMERS & MERCHANTS BANK, THE (574949)\n\n\nFARMERS & MERCHANTS BANK, THE (677644)\n\n\nFARMERS & MERCHANTS SAVINGS BANK (673244)\n\n\nFARMERS & MERCHANTS SAVINGS BANK (863746)\n\n\nFARMERS & MERCHANTS STATE BANK (145741)\n\n\nFARMERS & MERCHANTS STATE BANK (79145)\n\n\nFARMERS & MERCHANTS STATE BANK, THE (214414)\n\n\nFARMERS & TRADERS BANK OF CAMPTON (839817)\n\n\nFARMERS AND MECHANICS FEDERAL SAVINGS BANK (412872)\n\n\nFARMERS AND MERCHANTS BANK (205243)\n\n\nFARMERS AND MERCHANTS BANK (455552)\n\n\nFARMERS AND MERCHANTS BANK OF ASHLAND (398051)\n\n\nFARMERS AND MERCHANTS BANK OF LONG BEACH (871769)\n\n\nFARMERS AND MERCHANTS BANK OF ST. CLAIR (266851)\n\n\nFARMERS AND MERCHANTS STATE BANK (601153)\n\n\nFARMERS AND MERCHANTS STATE BANK (677756)\n\n\nFARMERS AND MERCHANTS STATE BANK, BLOOMFIELD, NEBRASKA (411651)\n\n\nFARMERS BANK & TRUST COMPANY (12946)\n\n\nFARMERS BANK (3020447)\n\n\nFARMERS BANK (307062)\n\n\nFARMERS BANK (485214)\n\n\nFARMERS BANK OF NORTHERN MISSOURI (303952)\n\n\nFARMERS BANK OF WILLARDS, THE (105026)\n\n\nFARMERS BANK, FRANKFORT, INDIANA, INC., THE (423449)\n\n\nFARMERS BANK, THE (11837)\n\n\nFARMERS NATIONAL BANK OF CANFIELD, THE (680813)\n\n\nFARMERS SAVINGS BANK & TRUST (368344)\n\n\nFARMERS SAVINGS BANK (205346)\n\n\nFARMERS STATE BANK (1006148)\n\n\nFARMERS STATE BANK (105530)\n\n\nFARMERS STATE BANK (113441)\n\n\nFARMERS STATE BANK (461058)\n\n\nFARMERS STATE BANK (840747)\n\n\nFARMERS STATE BANK (875057)\n\n\nFARMERS STATE BANK AND TRUST COMPANY, THE (481944)\n\n\nFARMERS STATE BANK OF BRUSH, THE (621151)\n\n\nFARMERS STATE BANK OF CALHAN (956956)\n\n\nFARMERS STATE BANK OF WAUPACA, THE (879747)\n\n\nFARMERS STATE BANK, INC (131717)\n\n\nFARMERS TRUST AND SAVINGS BANK (543945)\n\n\nFEDERATED BANK (640143)\n\n\nFEDERATION BANK (764142)\n\n\nFIDELITY BANK (255574)\n\n\nFIDELITY BANK (848248)\n\n\nFIDELITY BANK, THE (584920)\n\n\nFIELD & MAIN BANK (618740)\n\n\nFIRST & PEOPLES BANK AND TRUST COMPANY (391418)\n\n\nFIRST AMERICAN BANK AND TRUST (101037)\n\n\nFIRST AMERICAN NATIONAL BANK (786340)\n\n\nFIRST AMERICAN STATE BANK (2317672)\n\n\nFIRST ARKANSAS BANK AND TRUST (466240)\n\n\nFIRST BANK & TRUST (77851)\n\n\nFIRST BANK & TRUST COMPANY (1228034)\n\n\nFIRST BANK (131436)\n\n\nFIRST BANK (169653)\n\n\nFIRST BANK (216922)\n\n\nFIRST BANK (376442)\n\n\nFIRST BANK (875936)\n\n\nFIRST BANK (899428)\n\n\nFIRST BANK HAMPTON (786948)\n\n\nFIRST BANK OF ALABAMA (257233)\n\n\nFIRST BANK OF COASTAL GEORGIA (823638)\n\n\nFIRST BANK OF OHIO (586027)\n\n\nFIRST BANK OF OWASSO (637554)\n\n\nFIRST BANK OF THE LAKE (758851)\n\n\nFIRST BANK OF THOMAS (328058)\n\n\nFIRST BANK, THE (2385514)\n\n\nFIRST BANK, UPPER MICHIGAN (239556)\n\n\nFIRST BANKERS TRUST COMPANY, NATIONAL ASSOCIATION (344647)\n\n\nFIRST BUSINESS BANK (537449)\n\n\nFIRST CENTRAL NATIONAL BANK OF SAINT PARIS, THE (538222)\n\n\nFIRST CENTURY BANK, NATIONAL ASSOCIATION (2997748)\n\n\nFIRST CITIZENS BANK (541231)\n\n\nFIRST CITIZENS BANK OF BUTTE (666358)\n\n\nFIRST CITIZENS COMMUNITY BANK (978118)\n\n\nFIRST CITIZENS NATIONAL BANK OF UPPER SANDUSKY, THE (230423)\n\n\nFIRST CITIZENS STATE BANK (831642)\n\n\nFIRST COMMAND BANK (2568063)\n\n\nFIRST COMMONWEALTH BANK (42420)\n\n\nFIRST COMMUNITY BANK (2353595)\n\n\nFIRST COMMUNITY BANK (339456)\n\n\nFIRST COMMUNITY BANK (742542)\n\n\nFIRST COMMUNITY BANK OF MOULTRIE COUNTY (459644)\n\n\nFIRST COMMUNITY BANK OF TENNESSEE (1188772)\n\n\nFIRST COUNTY BANK (958204)\n\n\nFIRST DAKOTA NATIONAL BANK (441256)\n\n\nFIRST FARMERS & MERCHANTS NATIONAL BANK (1470150)\n\n\nFIRST FARMERS BANK & TRUST CO. (139843)\n\n\nFIRST FED BANK (403179)\n\n\nFIRST FEDERAL BANK (384278)\n\n\nFIRST FEDERAL BANK OF LOUISIANA (517674)\n\n\nFIRST FEDERAL BANK OF OHIO (207470)\n\n\nFIRST FEDERAL SAVINGS AND LOAN ASSOCIATION OF LORAIN (144678)\n\n\nFIRST FEDERAL SAVINGS BANK OF LINCOLNTON (42372)\n\n\nFIRST FEDERAL SAVINGS BANK OF TWIN FALLS (582971)\n\n\nFIRST FIDELITY BANK (106359)\n\n\nFIRST FINANCIAL BANK (165628)\n\n\nFIRST FINANCIAL BANK (48374)\n\n\nFIRST FINANCIAL BANK, NATIONAL ASSOCIATION (693345)\n\n\nFIRST GUARANTY BANK (422433)\n\n\nFIRST HARRISON BANK (716374)\n\n\nFIRST HAWAIIAN BANK (980661)\n\n\nFIRST HORIZON BANK (485559)\n\n\nFIRST INDEPENDENCE BANK (254849)\n\n\nFIRST INTERNATIONAL BANK AND TRUST (236153)\n\n\nFIRST INTERNET BANK OF INDIANA (2758613)\n\n\nFIRST INTERSTATE BANK (659855)\n\n\nFIRST MERCHANTS BANK (17147)\n\n\nFIRST METRO BANK (1222519)\n\n\nFIRST MIDWEST BANK OF THE OZARKS (228158)\n\n\nFIRST MISSOURI STATE BANK (825454)\n\n\nFIRST NATIONAL BANK & TRUST (251558)\n\n\nFIRST NATIONAL BANK (330239)\n\n\nFIRST NATIONAL BANK (355858)\n\n\nFIRST NATIONAL BANK (42448)\n\n\nFIRST NATIONAL BANK (60648)\n\n\nFIRST NATIONAL BANK (823450)\n\n\nFIRST NATIONAL BANK (944355)\n\n\nFIRST NATIONAL BANK ALASKA (114260)\n\n\nFIRST NATIONAL BANK AND TRUST (183958)\n\n\nFIRST NATIONAL BANK AND TRUST COMPANY OF BOTTINEAU (974558)\n\n\nFIRST NATIONAL BANK AND TRUST COMPANY OF MIAMI, THE (837158)\n\n\nFIRST NATIONAL BANK AND TRUST COMPANY, THE (207845)\n\n\nFIRST NATIONAL BANK AT DARLINGTON (57040)\n\n\nFIRST NATIONAL BANK AT PARIS, THE (45047)\n\n\nFIRST NATIONAL BANK IN AMBOY, THE (656032)\n\n\nFIRST NATIONAL BANK IN DERIDDER (480433)\n\n\nFIRST NATIONAL BANK IN NEW BREMEN (204826)\n\n\nFIRST NATIONAL BANK IN PINCKNEYVILLE (340443)\n\n\nFIRST NATIONAL BANK IN SIOUX FALLS, THE (326858)\n\n\nFIRST NATIONAL BANK IN TAYLORVILLE (177443)\n\n\nFIRST NATIONAL BANK IN TREMONT, THE (353546)\n\n\nFIRST NATIONAL BANK NORTH (805755)\n\n\nFIRST NATIONAL BANK NORTHWEST FLORIDA (216230)\n\n\nFIRST NATIONAL BANK OF ALLENDALE, THE (990642)\n\n\nFIRST NATIONAL BANK OF ASSUMPTION, THE (604033)\n\n\nFIRST NATIONAL BANK OF AVA, THE (858443)\n\n\nFIRST NATIONAL BANK OF BASTROP, THE (18050)\n\n\nFIRST NATIONAL BANK OF BELLEVUE, THE (243414)\n\n\nFIRST NATIONAL BANK OF BLANCHESTER, THE (735414)\n\n\nFIRST NATIONAL BANK OF BROOKFIELD (465038)\n\n\nFIRST NATIONAL BANK OF COFFEE COUNTY (1892154)\n\n\nFIRST NATIONAL BANK OF DENNISON, OHIO, THE (935719)\n\n\nFIRST NATIONAL BANK OF DRYDEN, THE (241009)\n\n\nFIRST NATIONAL BANK OF EASTERN ARKANSAS (251745)\n\n\nFIRST NATIONAL BANK OF FORT STOCKTON (397456)\n\n\nFIRST NATIONAL BANK OF GERMANTOWN, THE (505916)\n\n\nFIRST NATIONAL BANK OF GILLETTE (890050)\n\n\nFIRST NATIONAL BANK OF GRIFFIN (563233)\n\n\nFIRST NATIONAL BANK OF GROTON, THE (917500)\n\n\nFIRST NATIONAL BANK OF HENNING, THE (23456)\n\n\nFIRST NATIONAL BANK OF LAWRENCE COUNTY AT WALNUT RIDGE, THE (799948)\n\n\nFIRST NATIONAL BANK OF LONG ISLAND, THE (837000)\n\n\nFIRST NATIONAL BANK OF MCCONNELSVILLE, THE (44929)\n\n\nFIRST NATIONAL BANK OF MERTZON, THE (500256)\n\n\nFIRST NATIONAL BANK OF MILACA, THE (924357)\n\n\nFIRST NATIONAL BANK OF OMAHA (527954)\n\n\nFIRST NATIONAL BANK OF PENNSYLVANIA (379920)\n\n\nFIRST NATIONAL BANK OF RIVER FALLS, THE (956255)\n\n\nFIRST NATIONAL BANK OF SAINT IGNACE, THE (381950)\n\n\nFIRST NATIONAL BANK OF SCOTIA (472616)\n\n\nFIRST NATIONAL BANK OF SCOTT CITY, THE (414652)\n\n\nFIRST NATIONAL BANK OF SPARTA, THE (246947)\n\n\nFIRST NATIONAL BANK OF TENNESSEE (283737)\n\n\nFIRST NATIONAL BANK OF WAVERLY, THE (263627)\n\n\nFIRST NATIONAL BANK OF WAYNESBORO, THE (31134)\n\n\nFIRST NATIONAL BANK OF WINNSBORO, THE (501767)\n\n\nFIRST NATIONAL BANK USA (714839)\n\n\nFIRST NATIONAL BANK, CORTEZ (968155)\n\n\nFIRST NATIONAL COMMUNITY BANK (23755)\n\n\nFIRST NATIONAL COMMUNITY BANK (450632)\n\n\nFIRST NEIGHBOR BANK, NATIONAL ASSOCIATION (413646)\n\n\nFIRST NEW MEXICO BANK OF SILVER CITY (495558)\n\n\nFIRST NORTHERN BANK OF WYOMING (868956)\n\n\nFIRST OPTION BANK (285852)\n\n\nFIRST PIONEER NATIONAL BANK (357553)\n\n\nFIRST PREMIER BANK (374653)\n\n\nFIRST SAVINGS BANK (67656)\n\n\nFIRST SECURITY BANK (673440)\n\n\nFIRST SECURITY BANK (718145)\n\n\nFIRST SECURITY BANK AND TRUST COMPANY (894544)\n\n\nFIRST SERVICE BANK (458544)\n\n\nFIRST SOUTHERN BANK (631039)\n\n\nFIRST SOUTHERN BANK (66275)\n\n\nFIRST STATE BANK & TRUST (248455)\n\n\nFIRST STATE BANK (10849)\n\n\nFIRST STATE BANK (172859)\n\n\nFIRST STATE BANK (216164)\n\n\nFIRST STATE BANK (294023)\n\n\nFIRST STATE BANK (497655)\n\n\nFIRST STATE BANK (565143)\n\n\nFIRST STATE BANK (801047)\n\n\nFIRST STATE BANK (854847)\n\n\nFIRST STATE BANK (887340)\n\n\nFIRST STATE BANK (917050)\n\n\nFIRST STATE BANK (924236)\n\n\nFIRST STATE BANK AND TRUST (144856)\n\n\nFIRST STATE BANK AND TRUST (605656)\n\n\nFIRST STATE BANK AND TRUST (899642)\n\n\nFIRST STATE BANK AND TRUST COMPANY, INC. (489548)\n\n\nFIRST STATE BANK MINNESOTA (60554)\n\n\nFIRST STATE BANK OF BLAKELY (5135)\n\n\nFIRST STATE BANK OF DEKALB COUNTY, INC. (504535)\n\n\nFIRST STATE BANK OF GOLVA (931159)\n\n\nFIRST STATE BANK OF HARVEY (997557)\n\n\nFIRST STATE BANK OF MIDDLEBURY (967046)\n\n\nFIRST STATE BANK OF SHELBY, THE (686758)\n\n\nFIRST STATE BANK OF WYOMING (222156)\n\n\nFIRST STATE BANK SOUTHWEST (823656)\n\n\nFIRST STATE BANK, THE (888552)\n\n\nFIRST UNITED BANK (1011955)\n\n\nFIRST UNITED BANK AND TRUST COMPANY (509950)\n\n\nFIRST US BANK (259330)\n\n\nFIRST UTAH BANK (207872)\n\n\nFIRST WESTERN BANK AND TRUST (687951)\n\n\nFIRST-LOCKHART NATIONAL BANK (631150)\n\n\nFIRSTBANK (288853)\n\n\nFIRSTBANK (436159)\n\n\nFIRSTBANK PUERTO RICO (510871)\n\n\nFIRSTRUST SAVINGS BANK (932978)\n\n\nFISHER NATIONAL BANK, THE (739832)\n\n\nFIVE STAR BANK (601416)\n\n\nFNB BANK (617743)\n\n\nFNB COMMUNITY BANK,THE (137447)\n\n\nFNB SOUTH (12030)\n\n\nFNBC BANK AND TRUST (608844)\n\n\nFNBT BANK (697231)\n\n\nFORCHT BANK, NATIONAL ASSOCIATION (3141726)\n\n\nFORESIGHT BANK (755458)\n\n\nFORTE BANK (742944)\n\n\nFORTIFI BANK (111942)\n\n\nFORTRESS BANK (953535)\n\n\nFORWARD BANK (313577)\n\n\nFOWLER STATE BANK (554343)\n\n\nFRANDSEN BANK & TRUST (751656)\n\n\nFRANKLIN BANK & TRUST COMPANY (493844)\n\n\nFREEPORT STATE BANK (72454)\n\n\nFREMONT BANK (739560)\n\n\nFRIENDSHIP STATE BANK, THE (427241)\n\n\nFRONTIER BANK (191355)\n\n\nFSNB, NATIONAL ASSOCIATION (125154)\n\n\nFULTON BANK, NATIONAL ASSOCIATION (474919)\n\n\nGARDEN PLAIN STATE BANK (987651)\n\n\nGARFIELD COUNTY BANK (608358)\n\n\nGARRETT STATE BANK, THE (465243)\n\n\nGENOA BANKING COMPANY, THE (504311)\n\n\nGEO. D. WARTHEN BANK, THE (305237)\n\n\nGERMAN AMERICAN BANK (37640)\n\n\nGLACIER BANK (2634191)\n\n\nGLENWOOD STATE BANK (566243)\n\n\nGLENWOOD STATE BANK (INCORPORATED) (975854)\n\n\nGNB BANK (724744)\n\n\nGOGEBIC RANGE BANK (3025929)\n\n\nGORHAM SAVINGS BANK (241607)\n\n\nGRAND RAPIDS STATE BANK (1003558)\n\n\nGRAND SAVINGS BANK (732178)\n\n\nGRAND TIMBER BANK (918356)\n\n\nGRANITE BANK (311256)\n\n\nGRANT COUNTY BANK (207452)\n\n\nGRANT COUNTY BANK, THE (718538)\n\n\nGRANT COUNTY STATE BANK (933340)\n\n\nGREAT MIDWEST BANK, STATE SAVINGS BANK (524579)\n\n\nGREAT NORTH BANK (576354)\n\n\nGREAT OAKS BANK (364131)\n\n\nGREAT RIVERS BANK (857941)\n\n\nGREAT SOUTHERN BANK (101738)\n\n\nGREEN BELT BANK & TRUST (803649)\n\n\nGREEN DOT BANK (243375)\n\n\nGREENFIELD BANKING COMPANY (592644)\n\n\nGREENLEAF BANK (675248)\n\n\nGREENVILLE NATIONAL BANK (295011)\n\n\nGRINNELL STATE BANK (783246)\n\n\nGUARANTY BANK & TRUST COMPANY OF DELHI (969255)\n\n\nGUARANTY BANK AND TRUST COMPANY (289739)\n\n\nGUARANTY BANK AND TRUST COMPANY (84541)\n\n\nGUARDIAN BANK (2989006)\n\n\nGULF COAST BANK AND TRUST COMPANY (1458608)\n\n\nGUTHRIE COUNTY STATE BANK (969844)\n\n\nHAMILTON BANK, THE (723550)\n\n\nHANCOCK WHITNEY BANK (463735)\n\n\nHANMI BANK (657365)\n\n\nHARBOR BANK OF MARYLAND, THE (533124)\n\n\nHARDIN COUNTY SAVINGS BANK (647245)\n\n\nHARVARD STATE BANK, THE (800134)\n\n\nHAVANA NATIONAL BANK, THE (940731)\n\n\nHAWAII NATIONAL BANK (915065)\n\n\nHAWTHORN BANK (508346)\n\n\nHEARTLAND BANK (853112)\n\n\nHEARTLAND BANK AND TRUST COMPANY (426534)\n\n\nHEARTLAND STATE BANK (135854)\n\n\nHEARTLAND STATE BANK (837653)\n\n\nHEBRON SAVINGS BANK (780722)\n\n\nHELM BANK USA (1414819)\n\n\nHENDRICKS COUNTY BANK AND TRUST COMPANY (633640)\n\n\nHERITAGE BANK (225942)\n\n\nHERITAGE BANK (881478)\n\n\nHERITAGE BANK, INC. (1469677)\n\n\nHERITAGE BANK, NATIONAL ASSOCIATION (901358)\n\n\nHERRING BANK (610164)\n\n\nHIAWATHA NATIONAL BANK (505550)\n\n\nHIGHLAND STATE BANK (681249)\n\n\nHILLS BANK AND TRUST COMPANY (731247)\n\n\nHILLTOP NATIONAL BANK (1454)\n\n\nHNB NATIONAL BANK (908553)\n\n\nHOCKING VALLEY BANK, THE (230610)\n\n\nHOLLADAY BANK AND TRUST (617275)\n\n\nHOME BANK, NATIONAL ASSOCIATION (929978)\n\n\nHOME FEDERAL SAVINGS BANK (796572)\n\n\nHOME NATIONAL BANK (79127)\n\n\nHOME STATE BANK (653947)\n\n\nHOME STATE BANK/NATIONAL ASSOCIATION (696430)\n\n\nHOMETOWN BANK (940674)\n\n\nHOMETOWN COMMUNITY BANK (156457)\n\n\nHONESDALE NATIONAL BANK, THE (465618)\n\n\nHONOR BANK (815147)\n\n\nHOOSIER HEARTLAND STATE BANK (157744)\n\n\nHORICON BANK (528849)\n\n\nHORIZON FINANCIAL BANK (877350)\n\n\nHOUGHTON STATE BANK (528241)\n\n\nHTLF BANK (3465226)\n\n\nHURON COMMUNITY BANK (475345)\n\n\nHUSTISFORD STATE BANK (467144)\n\n\nHYDEN CITIZENS BANK, INC (211114)\n\n\nIDABEL NATIONAL BANK, THE (237954)\n\n\nILLINI STATE BANK (180845)\n\n\nINB, NATIONAL ASSOCIATION (925037)\n\n\nINCREDIBLEBANK (163549)\n\n\nINDEPENDENCE BANK (606653)\n\n\nINDEPENDENCE BANK OF KENTUCKY (648242)\n\n\nINDEPENDENCE STATE BANK (396057)\n\n\nINDEPENDENT BANK (2666400)\n\n\nINDEPENDENT FARMERS BANK (956152)\n\n\nINDUSTRIAL AND COMMERCIAL BANK OF CHINA (USA), NATIONAL ASSOCIATION (1015560)\n\n\nINDUSTRIAL BANK (536527)\n\n\nINDUSTRY STATE BANK (733054)\n\n\nINSOUTH BANK (329550)\n\n\nINTERBANK (1187001)\n\n\nINTERCITY STATE BANK (1016941)\n\n\nINTERCREDIT BANK, NATIONAL ASSOCIATION (44433)\n\n\nINTERNATIONAL BANK OF AMHERST, THE (504647)\n\n\nINTERNATIONAL BANK OF COMMERCE (1001152)\n\n\nINTRUST BANK, NATIONAL ASSOCIATION (557858)\n\n\nINVESTAR BANK, NATIONAL ASSOCIATION (3449066)\n\n\nINVESTMENT SAVINGS BANK (854173)\n\n\nIOWA SAVINGS BANK (190648)\n\n\nIOWA STATE BANK (865142)\n\n\nIOWA STATE BANK (982348)\n\n\nIOWA STATE SAVINGS BANK (869346)\n\n\nIOWA TRUST & SAVINGS BANK (649342)\n\n\nIRELAND BANK (428462)\n\n\nISABELLA BANK (74140)\n\n\nIXONIA BANK (529341)\n\n\nJACKSBORO NATIONAL BANK, THE (924058)\n\n\nJEFF BANK (306908)\n\n\nJEFFERSON SECURITY BANK (786733)\n\n\nJERSEY STATE BANK (482446)\n\n\nJIM THORPE NEIGHBORHOOD BANK (920210)\n\n\nJOHN DEERE FINANCIAL, F.S.B. (2992547)\n\n\nJOHNSON BANK (58243)\n\n\nJONAH BANK OF WYOMING (3412417)\n\n\nKAHOKA STATE BANK (979357)\n\n\nKAW VALLEY STATE BANK AND TRUST COMPANY, OF WAMEGO, KANSAS, THE (368951)\n\n\nKENNEBEC SAVINGS BANK (583905)\n\n\nKEYSAVINGS BANK (208972)\n\n\nKILLBUCK SAVINGS BANK COMPANY, THE (1017425)\n\n\nKINDRED STATE BANK (816751)\n\n\nKINGSTON NATIONAL BANK (966722)\n\n\nKIRKPATRICK BANK (67151)\n\n\nKITSAP BANK (584377)\n\n\nKLEBERG BANK, N.A. (556459)\n\n\nKODABANK (803957)\n\n\nKS BANK, INC. (416674)\n\n\nKS STATEBANK (160959)\n\n\nLABETTE BANK (483751)\n\n\nLAKE CITY BANK (874845)\n\n\nLAKE RIDGE BANK (525549)\n\n\nLAKELAND BANK (687009)\n\n\nLAMAR NATIONAL BANK (2161)\n\n\nLAONA STATE BANK (178150)\n\n\nLASALLE STATE BANK (956134)\n\n\nLCNB NATIONAL BANK (785923)\n\n\nLEA COUNTY STATE BANK (1015252)\n\n\nLEAD BANK (893855)\n\n\nLEDYARD NATIONAL BANK (1863097)\n\n\nLEGENCE BANK (635840)\n\n\nLEGENDS BANK (865151)\n\n\nLENA STATE BANK (478533)\n\n\nLIBERTY BANK (587800)\n\n\nLIBERTY BANK AND TRUST COMPANY (283438)\n\n\nLIBERTY STATE BANK (883351)\n\n\nLIBERTYVILLE SAVINGS BANK (857745)\n\n\nLINCOLN SAVINGS BANK (589943)\n\n\nLINCOLN STATE BANK (667551)\n\n\nLINDELL BANK & TRUST COMPANY (185859)\n\n\nLITTLE HORN STATE BANK (537551)\n\n\nLONE STAR NATIONAL BANK (842460)\n\n\nLOUISIANA NATIONAL BANK (109659)\n\n\nLUZERNE BANK (501815)\n\n\nLYONS NATIONAL BANK, THE (323204)\n\n\nMA BANK (34555)\n\n\nMABREY BANK (139553)\n\n\nMACHIAS SAVINGS BANK (137205)\n\n\nMAGNOLIA STATE BANK (204237)\n\n\nMAGNOLIA STATE BANK (34434)\n\n\nMAINSTREET BANK (3248849)\n\n\nMANHATTAN BANK (614751)\n\n\nMARBLEHEAD BANK (816304)\n\n\nMARION COUNTY STATE BANK (97943)\n\n\nMARS BANK (978622)\n\n\nMAYNARD SAVINGS BANK (1009840)\n\n\nMCINTOSH COUNTY BANK (720858)\n\n\nMECHANICS BANK (943675)\n\n\nMERCANTILE BANK (2608754)\n\n\nMERCER SAVINGS BANK (661072)\n\n\nMERCHANTS & PLANTERS BANK (99143)\n\n\nMERCHANTS AND FARMERS BANK (644842)\n\n\nMERCHANTS BANK, NATIONAL ASSOCIATION (779351)\n\n\nMERCHANTS NATIONAL BANK (701222)\n\n\nMERCHANTS STATE BANK (289757)\n\n\nMETAIRIE BANK & TRUST COMPANY (55336)\n\n\nMETAMORA STATE BANK, THE (533227)\n\n\nMETROPOLITAN BANK (534466)\n\n\nMIDDLEFIELD BANKING COMPANY, THE (177920)\n\n\nMIDFIRST BANK (595270)\n\n\nMIDLAND COMMUNITY BANK (822631)\n\n\nMIDLAND FEDERAL SAVINGS AND LOAN ASSOCIATION (820477)\n\n\nMIDLAND STATES BANK (773247)\n\n\nMIDSTATES BANK, NATIONAL ASSOCIATION (728948)\n\n\nMIDWEST BANK (709143)\n\n\nMIDWEST BANKCENTRE (657459)\n\n\nMIDWEST INDEPENDENT BANKERSBANK (977250)\n\n\nMIDWESTONE BANK (836843)\n\n\nMINNWEST BANK (302656)\n\n\nMISSION NATIONAL BANK (519360)\n\n\nMONTECITO BANK & TRUST (514066)\n\n\nMONTEREY COUNTY BANK (297761)\n\n\nMONTGOMERY BANK (613558)\n\n\nMONTICELLO BANKING COMPANY (266945)\n\n\nMORRIS BANK (423739)\n\n\nMORTON COMMUNITY BANK (825146)\n\n\nMOUND CITY BANK (259442)\n\n\nMOUNT VERNON BANK AND TRUST COMPANY (890649)\n\n\nMOUNTAIN VALLEY BANK (475653)\n\n\nMOVEMENT BANK (722227)\n\n\nMUTUAL SAVINGS BANK (841472)\n\n\nMVB BANK, INC. (2757205)\n\n\nNATIONAL BANK & TRUST (792659)\n\n\nNATIONAL BANK OF BLACKSBURG, THE (754929)\n\n\nNATIONAL BANK OF COMMERCE (775456)\n\n\nNATIONAL BANK OF INDIANAPOLIS, THE (2132941)\n\n\nNATIONAL CAPITAL BANK OF WASHINGTON, THE (791821)\n\n\nNATIONAL EXCHANGE BANK AND TRUST (722544)\n\n\nNATIONAL GRAND BANK OF MARBLEHEAD (863607)\n\n\nNATIONWIDE TRUST COMPANY, FSB (2729677)\n\n\nNBH BANK (4210227)\n\n\nNEIGHBORHOOD NATIONAL BANK (705556)\n\n\nNEW CARLISLE FEDERAL SAVINGS BANK (646873)\n\n\nNEW FRONTIER BANK (2917184)\n\n\nNEW MEXICO BANK & TRUST (2649122)\n\n\nNEW MILLENNIUM BANK (2833882)\n\n\nNEW OMNI BANK, NATIONAL ASSOCIATION (300063)\n\n\nNEW PEOPLES BANK, INC. (2736451)\n\n\nNEW TRIPOLI BANK (331713)\n\n\nNEW WASHINGTON STATE BANK, THE (305442)\n\n\nNEWFIELD NATIONAL BANK (632410)\n\n\nNEWFIRST NATIONAL BANK (938859)\n\n\nNEWTOWN SAVINGS BANK (507509)\n\n\nNICOLET NATIONAL BANK (2941068)\n\n\nNODAWAY VALLEY BANK, THE (770657)\n\n\nNORTH CENTRAL BANK (565536)\n\n\nNORTH SIDE BANK AND TRUST COMPANY, THE (615217)\n\n\nNORTH VALLEY BANK (350750)\n\n\nNORTHBROOK BANK & TRUST COMPANY, NATIONAL ASSOCIATION (2938198)\n\n\nNORTHERN BANK & TRUST COMPANY (900306)\n\n\nNORTHERN INTERSTATE BANK, NATIONAL ASSOCIATION (289056)\n\n\nNORTHERN STATE BANK (625757)\n\n\nNORTHRIM BANK (1718188)\n\n\nNORTHVIEW BANK (16551)\n\n\nNORTHWEST BANK & TRUST COMPANY (901741)\n\n\nNORTHWEST BANK (1002878)\n\n\nNORTHWEST BANK OF ROCKFORD (685649)\n\n\nNORTHWESTERN BANK, THE (153054)\n\n\nNSB BANK (253646)\n\n\nOAK BANK (2857600)\n\n\nOAKWOOD BANK (37051)\n\n\nOCEAN BANK (663834)\n\n\nOCONEE STATE BANK (573036)\n\n\nOHIO VALLEY BANK COMPANY, THE (498317)\n\n\nOLD FORT BANKING COMPANY, THE (564324)\n\n\nOLD SECOND NATIONAL BANK (936136)\n\n\nONE AMERICAN BANK (95051)\n\n\nONE BANK OF TENNESSEE (99536)\n\n\nONE COMMUNITY BANK (247140)\n\n\nONEUNITED BANK (935308)\n\n\nOOSTBURG STATE BANK (248745)\n\n\nORIENTAL BANK (245276)\n\n\nOSGOOD BANK (313223)\n\n\nOTTOVILLE BANK COMPANY, THE (443625)\n\n\nOWEN COUNTY STATE BANK (38740)\n\n\nOXFORD BANK (448040)\n\n\nPADUCAH BANK AND TRUST COMPANY, THE (285740)\n\n\nPALMETTO STATE BANK (277820)\n\n\nPARK BANK (518354)\n\n\nPARK BANK, THE (403946)\n\n\nPARK NATIONAL BANK, THE (489623)\n\n\nPARK STATE BANK (286457)\n\n\nPARTNERS BANK (114149)\n\n\nPARTNERS BANK (335346)\n\n\nPARTNERS BANK OF NEW ENGLAND (111205)\n\n\nPATASKALA BANKING COMPANY, THE (389826)\n\n\nPATHFINDER BANK (729310)\n\n\nPATRIOT BANK, NATIONAL ASSOCIATION (2236821)\n\n\nPBK BANK, INC (148715)\n\n\nPECOS COUNTY STATE BANK, THE (396954)\n\n\nPENDLETON COMMUNITY BANK, INC. (370020)\n\n\nPENNSVILLE NATIONAL BANK, THE (828110)\n\n\nPEOPLE’S BANK OF COMMERCE (2661861)\n\n\nPEOPLES BANK & TRUST (922344)\n\n\nPEOPLES BANK (455972)\n\n\nPEOPLES BANK (577128)\n\n\nPEOPLES BANK (968249)\n\n\nPEOPLES BANK (998844)\n\n\nPEOPLES BANK CO., THE (702911)\n\n\nPEOPLES BANK MT WASHINGTON (271341)\n\n\nPEOPLES BANK OF ALABAMA (60330)\n\n\nPEOPLES BANK OF GREENSBORO (320034)\n\n\nPEOPLES BANK OF KENTUCKY, INC. (995517)\n\n\nPEOPLES BANK THE (285928)\n\n\nPEOPLES BANK, THE (378110)\n\n\nPEOPLES BANK, THE (530655)\n\n\nPEOPLES BANK, THE (593249)\n\n\nPEOPLES BANK, THE (7045)\n\n\nPEOPLES COMMUNITY BANK (784159)\n\n\nPEOPLES COMMUNITY BANK, THE (420644)\n\n\nPEOPLES NATIONAL BANK OF KEWANEE (823133)\n\n\nPEOPLES SAVINGS BANK, THE (819172)\n\n\nPEOPLES SECURITY BANK AND TRUST COMPANY (278818)\n\n\nPEOPLES STATE BANK (262844)\n\n\nPEOPLES STATE BANK (431323)\n\n\nPEOPLES STATE BANK OF MUNISING (262956)\n\n\nPEOPLES STATE BANK OF NEWTON, ILLINOIS, THE (326344)\n\n\nPEOPLES STATE BANK, THE (454546)\n\n\nPESHTIGO NATIONAL BANK (257345)\n\n\nPETEFISH, SKILES & COMPANY (602543)\n\n\nPILGRIM BANK (911160)\n\n\nPILLAR BANK (143952)\n\n\nPILOT GROVE SAVINGS BANK (585749)\n\n\nPINELAND BANK (6039)\n\n\nPINERIES BANK, THE (674344)\n\n\nPINNACLE BANK (2925666)\n\n\nPINNACLE BANK (366238)\n\n\nPINNACLE BANK (867650)\n\n\nPINNACLE BANK (913856)\n\n\nPINNACLE BANK - WYOMING (561659)\n\n\nPIONEER BANK & TRUST (65559)\n\n\nPIONEER BANK (300942)\n\n\nPIONEER BANK (41629)\n\n\nPIONEER TRUST BANK, NATIONAL ASSOCIATION (852973)\n\n\nPLAINS COMMERCE BANK (593052)\n\n\nPLAINSCAPITAL BANK (637451)\n\n\nPLANTERS BANK & TRUST COMPANY (972648)\n\n\nPLATTE VALLEY BANK (2465881)\n\n\nPLATTE VALLEY BANK (580155)\n\n\nPLUMAS BANK (670467)\n\n\nPNB COMMUNITY BANK (483537)\n\n\nPOCA VALLEY BANK, INC., THE (851239)\n\n\nPOPULAR BANK (2736291)\n\n\nPORT WASHINGTON STATE BANK, THE (937740)\n\n\nPORTAGE COMMUNITY BANK (2668598)\n\n\nPORTAGE COUNTY BANK, THE (12647)\n\n\nPRAIRIE STATE BANK & TRUST (1222948)\n\n\nPREFERRED BANK (1918344)\n\n\nPREMIER COMMUNITY BANK (597546)\n\n\nPREMIERBANK (907547)\n\n\nPRESENCE BANK (660570)\n\n\nPREVAIL BANK (27070)\n\n\nPRIMEBANK (671147)\n\n\nPRIMESOUTH BANK (1011638)\n\n\nPROSPERITY BANK (664756)\n\n\nPS BANK (597313)\n\n\nPYRAMAX BANK, F.S.B. (713476)\n\n\nQUAD CITY BANK AND TRUST COMPANY (2142155)\n\n\nQUOIN FINANCIAL BANK (592550)\n\n\nRACCOON VALLEY BANK (102342)\n\n\nRANGE BANK (355559)\n\n\nRBC BANK (GEORGIA), NATIONAL ASSOCIATION (3783948)\n\n\nRED RIVER BANK (2743244)\n\n\nRELIABANK DAKOTA (108951)\n\n\nRELYANCE BANK (49241)\n\n\nREPUBLIC BANK & TRUST COMPANY (316840)\n\n\nREPUBLIC BANK OF CHICAGO (671334)\n\n\nRICHWOOD BANKING COMPANY, INC., THE (150727)\n\n\nRIDDELL NATIONAL BANK, THE (319047)\n\n\nRIDGEWOOD SAVINGS BANK (859712)\n\n\nRIVER BANK (279842)\n\n\nRIVER CITY BANK (253468)\n\n\nRIVER CITY BANK (3445901)\n\n\nRIVERSIDE SAVINGS BANK, SSB (247476)\n\n\nROCKY MOUNTAIN BANK (663058)\n\n\nROUND TOP STATE BANK (665865)\n\n\nROYAL BANK (532042)\n\n\nRVR BANK (1155)\n\n\nS & T BANK (936426)\n\n\nSABINE STATE BANK AND TRUST COMPANY (125855)\n\n\nSALISBURY BANK AND TRUST COMPANY (821906)\n\n\nSALLIE MAE BANK (3394278)\n\n\nSALYERSVILLE NATIONAL BANK, THE (472018)\n\n\nSANBORN SAVINGS BANK (595944)\n\n\nSAUK VALLEY BANK & TRUST COMPANY (2797162)\n\n\nSAVINGS BANK, THE (578116)\n\n\nSCOTT STATE BANK (443634)\n\n\nSEACOAST NATIONAL BANK (34537)\n\n\nSECURITY BANK & TRUST COMPANY (1001059)\n\n\nSECURITY BANK (20053)\n\n\nSECURITY BANK (497851)\n\n\nSECURITY BANK MIDWEST (435255)\n\n\nSECURITY BANK MINNESOTA (295057)\n\n\nSECURITY BANK OF THE OZARKS (956358)\n\n\nSECURITY BANK, S.B. (218878)\n\n\nSECURITY FEDERAL BANK (763677)\n\n\nSECURITY FINANCIAL BANK (450959)\n\n\nSECURITY FIRST BANK (276850)\n\n\nSECURITY FIRST BANK OF NORTH DAKOTA (693952)\n\n\nSECURITY NATIONAL BANK (151546)\n\n\nSECURITY NATIONAL BANK OF OMAHA (844053)\n\n\nSECURITY STATE BANK (111979)\n\n\nSECURITY STATE BANK (319551)\n\n\nSECURITY STATE BANK (43052)\n\n\nSECURITY STATE BANK (955959)\n\n\nSECURITY STATE BANK OF HIBBING (950356)\n\n\nSECURITY STATE BANK, THE (285553)\n\n\nSERVISFIRST BANK (3348888)\n\n\nSHARON BANK (164377)\n\n\nSHELBY COUNTY STATE BANK (536349)\n\n\nSHELBY STATE BANK, THE (961343)\n\n\nSHELL LAKE STATE BANK (896155)\n\n\nSHINHAN BANK AMERICA (1494914)\n\n\nSHORE UNITED BANK, NATIONAL ASSOCIATION (933023)\n\n\nSIBLEY STATE BANK (598543)\n\n\nSIGNATURE BANK, NATIONAL ASSOCIATION (3076604)\n\n\nSIMMONS BANK (663245)\n\n\nSIOUXLAND BANK (472951)\n\n\nSKOWHEGAN SAVINGS BANK (401906)\n\n\nSMARTBANK (3532641)\n\n\nSOFI BANK, NATIONAL ASSOCIATION (962966)\n\n\nSOLVAY BANK (722816)\n\n\nSOMERSET TRUST COMPANY (212522)\n\n\nSOONER STATE BANK (534756)\n\n\nSOUTH GEORGIA BANKING COMPANY (767732)\n\n\nSOUTH LOUISIANA BANK (616036)\n\n\nSOUTH SHORE BANK (772008)\n\n\nSOUTH STORY BANK & TRUST (542340)\n\n\nSOUTHEAST BANK (3110197)\n\n\nSOUTHEAST FIRST NATIONAL BANK (563934)\n\n\nSOUTHEASTERN BANK (210238)\n\n\nSOUTHERN HERITAGE BANK (935559)\n\n\nSOUTHERN MICHIGAN BANK & TRUST (822042)\n\n\nSOUTHSIDE BANK (361167)\n\n\nSOUTHSTAR BANK, S.S.B. (171768)\n\n\nSOUTHSTATE BANK, N.A. (1929247)\n\n\nSOUTHWEST BANK OF WEATHERFORD (1014059)\n\n\nSOUTHWEST MISSOURI BANK (760854)\n\n\nSOUTHWIND BANK (276159)\n\n\nSPENCER COUNTY BANK (871648)\n\n\nSPRING VALLEY CITY BANK (452841)\n\n\nSPRINGS VALLEY BANK & TRUST COMPANY (93543)\n\n\nST. HENRY BANK, THE (568126)\n\n\nSTARION BANK (2009605)\n\n\nSTATE BANK (345747)\n\n\nSTATE BANK AND TRUST COMPANY, THE (614313)\n\n\nSTATE BANK FINANCIAL (2631172)\n\n\nSTATE BANK OF BEMENT (439730)\n\n\nSTATE BANK OF BOTTINEAU (1014554)\n\n\nSTATE BANK OF CHANDLER (112556)\n\n\nSTATE BANK OF CHERRY (258539)\n\n\nSTATE BANK OF CHILTON (120542)\n\n\nSTATE BANK OF COCHRAN (333034)\n\n\nSTATE BANK OF COLD SPRING (116358)\n\n\nSTATE BANK OF GENEVA, THE (991135)\n\n\nSTATE BANK OF LISMORE (916259)\n\n\nSTATE BANK OF NEWBURG (228345)\n\n\nSTATE BANK OF SOUTHERN UTAH (656470)\n\n\nSTATE BANK OF THE LAKES, NATIONAL ASSOCIATION (595430)\n\n\nSTATE BANK OF TOLEDO, THE (490348)\n\n\nSTATE BANK OF TOULON (535940)\n\n\nSTATE BANK OF WHITTINGTON (270148)\n\n\nSTATE BANK, THE (387055)\n\n\nSTATE BANK, THE (602048)\n\n\nSTATE CENTRAL BANK (808345)\n\n\nSTATE SAVINGS BANK OF MANISTIQUE, THE (259956)\n\n\nSTATE STREET BANK AND TRUST COMPANY (352745)\n\n\nSTEPHENSON NATIONAL BANK AND TRUST, THE (598048)\n\n\nSTIFEL BANK (3076220)\n\n\nSTILLMAN BANCCORP, N.A. (407645)\n\n\nSTOCK YARDS BANK & TRUST COMPANY (317342)\n\n\nSTOCKGROWERS STATE BANK (424156)\n\n\nSTONEHAMBANK (954279)\n\n\nSUCCESS BANK (179148)\n\n\nSUMMIT COMMUNITY BANK, INC. (2372774)\n\n\nSUMMIT STATE BANK (561574)\n\n\nSUNDANCE STATE BANK (94755)\n\n\nSUNFLOWER BANK, NATIONAL ASSOCIATION (474759)\n\n\nSUNMARK COMMUNITY BANK (100236)\n\n\nSUNRISE BANK DAKOTA (354253)\n\n\nSUNSTATE BANK (2791085)\n\n\nSUTTON BANK (110413)\n\n\nSYNOVUS BANK (395238)\n\n\nTCM BANK, NATIONAL ASSOCIATION (2687487)\n\n\nTD BANK USA, NATIONAL ASSOCIATION (2121196)\n\n\nTENNESSEE STATE BANK (479839)\n\n\nTERRABANK, NATIONAL ASSOCIATION (238737)\n\n\nTEXAS BANK AND TRUST COMPANY (949154)\n\n\nTEXAS COMMUNITY BANK (528960)\n\n\nTEXAS FIRST BANK (473266)\n\n\nTEXAS NATIONAL BANK (497954)\n\n\nTHAYER COUNTY BANK (157155)\n\n\nTHE SECURITY NATIONAL BANK OF SIOUX CITY, IOWA (418249)\n\n\nTHINK MUTUAL BANK (936583)\n\n\nTHREE RIVERS BANK OF MONTANA (610557)\n\n\nTIAA, FSB (2735146)\n\n\nTIB, NATIONAL ASSOCIATION (529958)\n\n\nTIMBERLAND BANK (294779)\n\n\nTIOGA STATE BANK, N.A. (910118)\n\n\nTOMPKINS COMMUNITY BANK (433608)\n\n\nTOUCHSTONE BANK (746429)\n\n\nTOWER COMMUNITY BANK (989730)\n\n\nTOWN & COUNTRY BANK AND TRUST COMPANY (692946)\n\n\nTOWNEBANK (2797724)\n\n\nTOYOTA FINANCIAL SAVINGS BANK (3287660)\n\n\nTRADITIONS BANK (3194692)\n\n\nTRANSPORTATION ALLIANCE BANK, INC. DBA TAB BANK (2736219)\n\n\nTRI COUNTIES BANK (100562)\n\n\nTRI-COUNTY BANK & TRUST COMPANY (914545)\n\n\nTRI-COUNTY BANK, THE (657954)\n\n\nTRISTAR BANK (2871099)\n\n\nTROY BANK & TRUST COMPANY (134437)\n\n\nTRUBANK (862141)\n\n\nTRUSTBANK (338646)\n\n\nTRUSTCO BANK (677176)\n\n\nTRUSTMARK NATIONAL BANK (342634)\n\n\nTS BANK (552545)\n\n\nTWIN VALLEY BANK, THE (381026)\n\n\nUBANK (917555)\n\n\nUMB BANK, NATIONAL ASSOCIATION (936855)\n\n\nUMPQUA BANK (143662)\n\n\nUNIFIED BANK (584724)\n\n\nUNION BANK (333203)\n\n\nUNION BANK AND TRUST COMPANY (450856)\n\n\nUNION BANK COMPANY, THE (780218)\n\n\nUNION BANK OF MENA, THE (86349)\n\n\nUNION BANK, THE (852254)\n\n\nUNION STATE BANK (227151)\n\n\nUNION STATE BANK (467733)\n\n\nUNION STATE BANK (903754)\n\n\nUNISON BANK (676151)\n\n\nUNITED BANK (365325)\n\n\nUNITED BANK (37435)\n\n\nUNITED BANK (994435)\n\n\nUNITED BANK OF IOWA (738040)\n\n\nUNITED BANK OF PHILADELPHIA (1945247)\n\n\nUNITED BANKERS BANK (930358)\n\n\nUNITED COMMUNITY BANK (1017939)\n\n\nUNITED COMMUNITY BANK (439338)\n\n\nUNITED COMMUNITY BANK (884648)\n\n\nUNITED COMMUNITY BANK (90337)\n\n\nUNITED COMMUNITY BANK OF NORTH DAKOTA (680055)\n\n\nUNITED COMMUNITY BANK OF WEST KENTUCKY, INC. (3070545)\n\n\nUNITED CUMBERLAND BANK (425818)\n\n\nUNITY BANK (443353)\n\n\nUNIVERSITY BANK (137652)\n\n\nUNIVEST BANK AND TRUST CO. (354310)\n\n\nUSAA FEDERAL SAVINGS BANK (619877)\n\n\nUSAA SAVINGS BANK (2502656)\n\n\nUWHARRIE BANK (590220)\n\n\nVALLEY BANK OF KALISPELL (473257)\n\n\nVALLEY NATIONAL BANK (229801)\n\n\nVALLEY STATE BANK, THE (420653)\n\n\nVALUEBANK TEXAS (964157)\n\n\nVARO BANK, NATIONAL ASSOCIATION (5518023)\n\n\nVERMILION BANK & TRUST COMPANY (754536)\n\n\nVERMILION VALLEY BANK (666844)\n\n\nVINTON COUNTY NATIONAL BANK (754826)\n\n\nVIRGINIA NATIONAL BANK (2708122)\n\n\nVISIONBANK OF IOWA (269049)\n\n\nVOLUNTEER STATE BANK (774132)\n\n\nWALLIS BANK (283867)\n\n\nWARREN-BOYNTON STATE BANK (837448)\n\n\nWARRINGTON BANK, THE (199137)\n\n\nWASHINGTON COUNTY BANK (1000052)\n\n\nWASHINGTON SAVINGS BANK (654300)\n\n\nWASHINGTON STATE BANK (433943)\n\n\nWASHINGTON TRUST BANK (58971)\n\n\nWAUKESHA STATE BANK (290249)\n\n\nWAUMANDEE STATE BANK (780955)\n\n\nWAYCROSS BANK & TRUST (1191352)\n\n\nWAYNE BANK AND TRUST CO. (451246)\n\n\nWEBBANK (2576134)\n\n\nWELLS FARGO NATIONAL BANK WEST (1225761)\n\n\nWELLS FARGO TRUST COMPANY, NATIONAL ASSOCIATION (688079)\n\n\nWESBANCO BANK, INC. (645625)\n\n\nWEST CENTRAL GEORGIA BANK (280138)\n\n\nWEST POINTE BANK (2371816)\n\n\nWEST TEXAS NATIONAL BANK (237066)\n\n\nWESTERN ALLIANCE BANK (3138146)\n\n\nWESTERN BANK (723653)\n\n\nWESTERN DAKOTA BANK (128258)\n\n\nWESTERN NATIONAL BANK (127055)\n\n\nWESTERN STATE BANK (233554)\n\n\nWHEATLAND BANK (129479)\n\n\nWHEELER COUNTY STATE BANK (989534)\n\n\nWHITAKER BANK, INC (1445943)\n\n\nWILLIAMSVILLE STATE BANK AND TRUST (365848)\n\n\nWILMINGTON SAVINGS FUND SOCIETY, FSB (437914)\n\n\nWILSON & MUIR BANK & TRUST COMPANY (899343)\n\n\nWILSON BANK & TRUST (159636)\n\n\nWOLF RIVER COMMUNITY BANK (2505424)\n\n\nWOOD & HUSTON BANK (671558)\n\n\nWOODFORD STATE BANK (93244)\n\n\nWOODFOREST NATIONAL BANK (412751)\n\n\nWOODSVILLE GUARANTY SAVINGS BANK (477303)\n\n\nWOODTRUST BANK (833749)\n\n\nWOORI AMERICA BANK (384018)\n\n\nWRAY STATE BANK (541754)\n\n\nYORK STATE BANK (731050)\n\n\nYOUNG AMERICANS BANK (67254)\n\n\nZIONS BANCORPORATION, NATIONAL ASSOCIATION (276579)"
  },
  {
    "objectID": "data_final_event.html",
    "href": "data_final_event.html",
    "title": "14  Event Study Dataset",
    "section": "",
    "text": "Download All\nSources:\n\nUS Federal Financial Institutions Examination Council (2023)\nUS Federal Reserve Economic Data (2023)\n\n\n\nTable 14.1: Final Dataset\n\n\n\n\n (a) Data glimpse (10 rows) \n  \n\n\n\n\n\n\n(b) Feature Descriptions\n\n\n\n\n\n\n\nSource\nCode\nDesc\n\n\n\n\nFFIEC\nBankName\nNA\n\n\nFFIEC\nBankType\nNA\n\n\nFFIEC\nIDRSSD\nNA\n\n\nFFIEC\nQtr\nNA\n\n\nFED\nA229RC0\nDisposable Personal Income: Per capita: Current dollars\n\n\nFED\nB069RC1\nPersonal interest payments\n\n\nFED\nCDSP\nConsumer Debt Service Payments as a Percent of Disposable Personal Income\n\n\nFED\nCSCICP03USM665S\nUS Composite Confidence Indicator\n\n\nFED\nPCE\nPersonal Consumption Expenditures\n\n\nFED\nPCEDG\nPersonal Consumption Expenditures: Durable Goods\n\n\nFED\nPSAVE\nQuarterly Personal Saving\n\n\nFED\nPSAVERT\nUS Personal Savings Rate\n\n\nFED\nRRSFS\nReal Retail and Food Services Sales\n\n\nFED\nTDSP\nHousehold Debt Service Payments as a Percent of Disposable Personal Income\n\n\nFED\nUNRATE\nUnemployment Rate\n\n\nFFIEC\nUBPR3815\nUnused Commitments on Credit Cards\n\n\nFFIEC\nUBPRB538\nLoans to Individuals for Household, Family, and Other Personal Expenditures:Credit Cards\n\n\nFFIEC\nUBPRE263\nUnused Commitments on Credit Cards as a percent of Total Assets\n\n\nFFIEC\nUBPRE425\nCredit Card Loans, % Gross LN&LS\n\n\nFFIEC\nUBPRE524\nCredit Card Plans-30-89 DAYS P/D %\n\n\n\n\n\n\n\n\n\n\n\n\nFFIEC. 2023. “Central Data Repository.” Federal Financial Institutions Examination Council. https://cdr.ffiec.gov/.\n\n\nSt. Louis, Federal Reserve Bank of. 2023. “Federal Reserve Economic Data.” Federal Reserve Bank of St. Louis. https://fred.stlouisfed.org/."
  },
  {
    "objectID": "data_final_hierarchy.html",
    "href": "data_final_hierarchy.html",
    "title": "15  Hierarchical Study Dataset",
    "section": "",
    "text": "Download All\nNAICS Partner Mapping\nSources:\n\nUS Federal Financial Institutions Examination Council (2023)\nUS Federal Reserve Economic Data (2023)\nNorth American Industry Classification System (2024)\n\n\n\nTable 15.1: Final Dataset\n\n\n\n\n (a) Data glimpse (10 rows) \n  \n\n\n\n\n\n\n (b) NAICS Partner Mapping \n  \n\n\n\n\n\n\n(c) Feature Descriptions\n\n\n\n\n\n\n\nSource\nCode\nDesc\n\n\n\n\nFFIEC\nBankName\nNA\n\n\nFFIEC\nBankType\nNA\n\n\nFFIEC\nHasPartner\nNA\n\n\nFFIEC\nIDRSSD\nNA\n\n\nFFIEC\nNAICS\nNA\n\n\nFFIEC\nNAICS2\nNA\n\n\nFFIEC\nNAICS3\nNA\n\n\nFFIEC\nPartner\nNA\n\n\nFFIEC\nQtr\nNA\n\n\nFFIEC\nQuarter\nNA\n\n\nFED\nA229RC0\nDisposable Personal Income: Per capita: Current dollars\n\n\nFED\nB069RC1\nPersonal interest payments\n\n\nFED\nCDSP\nConsumer Debt Service Payments as a Percent of Disposable Personal Income\n\n\nFED\nCSCICP03USM665S\nUS Composite Confidence Indicator\n\n\nFED\nPCE\nPersonal Consumption Expenditures\n\n\nFED\nPCEDG\nPersonal Consumption Expenditures: Durable Goods\n\n\nFED\nPSAVE\nQuarterly Personal Saving\n\n\nFED\nPSAVERT\nUS Personal Savings Rate\n\n\nFED\nRRSFS\nReal Retail and Food Services Sales\n\n\nFED\nTDSP\nHousehold Debt Service Payments as a Percent of Disposable Personal Income\n\n\nFED\nUNRATE\nUnemployment Rate\n\n\nFFIEC\nUBPR3815\nUnused Commitments on Credit Cards\n\n\nFFIEC\nUBPRB538\nLoans to Individuals for Household, Family, and Other Personal Expenditures:Credit Cards\n\n\nFFIEC\nUBPRE263\nUnused Commitments on Credit Cards as a percent of Total Assets\n\n\nFFIEC\nUBPRE425\nCredit Card Loans, % Gross LN&LS\n\n\nFFIEC\nUBPRE524\nCredit Card Plans-30-89 DAYS P/D %\n\n\n\n\n\n\n\n\n\n\n\n\nBureau, US Census. 2024. “North American Industry Classification System (NAICS).” https://www.census.gov/naics/.\n\n\nFFIEC. 2023. “Central Data Repository.” Federal Financial Institutions Examination Council. https://cdr.ffiec.gov/.\n\n\nSt. Louis, Federal Reserve Bank of. 2023. “Federal Reserve Economic Data.” Federal Reserve Bank of St. Louis. https://fred.stlouisfed.org/."
  }
]