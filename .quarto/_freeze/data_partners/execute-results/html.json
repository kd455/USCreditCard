{
  "hash": "f04fcb9e236e356c981f9ce843b05b0c",
  "result": {
    "markdown": "---\ntitle: \"Bank Partnerships\"\nformat: \n   html:\n     df-print: paged\n---\n\n\n## Exploring Partnership Events {#sec-partners}\n\n\n::: {.cell}\n\n:::\n\n\nUsing three partnership events as case studies, we can visualise *Credit Card Plans-30-89 DAYS P/D %* to see if we can observe any changes around the partnership event. There are two dates of interest; the official date of acquisition and the date when cards become available for use. For example, Barclays's acquisition of GAP Inc. was on May 1, 2022 but it wasn't until June 20, 2022 that the old Synchrony borrowers could use their new Barclays partnership cards.\n\nAs mentioned in @sec-intro-events we may not noticeably see the impact of a partnership event if it is not material to one or both of the Banks involved. To get a sense of the magnitude of the event we can look at the measures: *Loans to Individuals..Credit Cards* (UBPRB538) and *Unused commitments on Credit Cards* (UBPR3815). These measures tell us if borrowers utilise their partnership card; a new partnership that brings in a substantial number of new borrowers may not impact delinquency if the borrowers are not using the partnership card. \n\n\n::: {.cell}\n\n```{.r .cell-code}\napply_bank_filters = TRUE\napply_reg_filter = TRUE\n\noverdue30to89 <- credit_card.overdue_3089(apply_bank_filters, apply_reg_filter)\nloan_amt <-  credit_card.loan_amount(apply_bank_filters, apply_reg_filter)\nloan_unused <- credit_card.unused(apply_bank_filters, apply_reg_filter)\nloan_amt_pct_change <- loan_amt |> group_by(BankName) |> mutate(pct_change = value_diff/lag(Value) *100) \nloan_unused_pct_change <- loan_unused |> group_by(BankName) |> mutate(pct_change = value_diff/lag(Value) *100) \n\npartner_data <- credit_card.partnerships() \n\npartner_data |> pmap(partnership.plot,overdue30to89, \"Value\", \"median\")\npartner_data |> pmap(partnership.plot,overdue30to89, \"value_diff\", \"median\")\npartner_data |> pmap(partnership.plot,bind_rows(loan_amt,loan_unused), \"Value\", \"median\")\npartner_data |> pmap(partnership.plot,bind_rows(loan_amt_pct_change,loan_unused_pct_change), \"pct_change\", \"median\")\n```\n:::\n\n\n\n::: {#fig-3089days .panel-tabset}\n\n## Gap\n\n![Credit Card Plans-30-89 DAYS P/D %](images/GAP_UBPRE524_Value_median_partnership.png){#fig-gap-val}\n\n![Credit Card Plans-30-89 DAYS P/D % quarterly difference](images/GAP_UBPRE524_value_diff_median_partnership.png){#fig-gap-diff}\n\n::: {#fig-magitude-gap .panel-tabset}\n\n## Magnitude Measures - Value\n\n![Magnitude Measures](images/GAP_UBPR3815_UBPRB538_Value_median_partnership.png){#fig-gap-val-mag}\n\n## Magnitude Measures - Percentage Change\n![Magnitude Measures](images/GAP_UBPR3815_UBPRB538_pct_change_median_partnership.png){#fig-gap-pct-mag}\n\n:::\n\nsource: [@gap2021; and @gap2022]\n\n## Costco\n\n![Credit Card Plans-30-89 DAYS P/D %](images/Costco_UBPRE524_Value_median_partnership.png){#fig-Costco-val}\n\n![Credit Card Plans-30-89 DAYS P/D % quarterly difference](images/Costco_UBPRE524_value_diff_median_partnership.png){#fig-Costco-diff}\n\n::: {#fig-magitude-Costco .panel-tabset}\n\n## Magnitude Measures - Value\n\n![Magnitude Measures](images/Costco_UBPR3815_UBPRB538_Value_median_partnership.png){#fig-Costco-val-mag}\n\n## Magnitude Measures - Percentage Change\n\n![Magnitude Measures](images/Costco_UBPR3815_UBPRB538_pct_change_median_partnership.png){#fig-Costco-pct-mag}\n\n:::\n\nsource: [@costco2016]\n\n## Walmart\n![Credit Card Plans-30-89 DAYS P/D %](images/Walmart_UBPRE524_Value_median_partnership.png){#fig-walmart-val}\n\n![Credit Card Plans-30-89 DAYS P/D % quarterly difference](images/Walmart_UBPRE524_value_diff_median_partnership.png){#fig-Costco-diff}\n\n::: {#fig-magitude-walmart .panel-tabset}\n\n## Magnitude Measures - Value\n\n![Magnitude Measures](images/Walmart_UBPR3815_UBPRB538_Value_median_partnership.png){#fig-walmart-val-mag}\n\n## Magnitude Measures - Percentage Change\n\n![Magnitude Measures](images/Walmart_UBPR3815_UBPRB538_pct_change_median_partnership.png){#fig-walmart-pct-mag}\n\n:::\nsource: [@walmart2018; and @walmart2019]\n:::\n\n## Disambiguating Trend vs. Event  {#sec-trend-event}\n\nDepending on the relative quality of the partnership portfolio we may see Credit Card Plans-30-89 DAYS P/D % remain: \n\n* Stable\n* Both portfolios improve / degrade\n* One improves the other degrades.\n\nFor the GAP and Costco partnerships we can see that the portfolio quality degrades i.e. *Credit Card Plans-30-89 DAYS P/D %* shows increased delinquency, in both the *old* and *new* bank during the transitional period (between acquisition and card availability). This may suggest the partnership portfolio has added riskier borrowers relative to the *new* bank's existing portfolio and removed less risky borrowers relative to the *old* bank's remaining portfolio. However, this assertion is questionable as the increase we are seeing may just be the trend, shown in grey (calculated as the median across all peer Banks), which also increased during this period. \n\nAnother factor, as we saw in @fig-lfeature-6, was a tendency for short term reversal, or a reversion to a mean. This may be a factor of banks enacting policies to keep delinquency within their risk tolerance levels. Consequently, where we see an increase after a decrease it may be due in part to this data characteristic.\n\nWe will look to model the partnership impact by accounting for trend.\n\n## Magnitude measures\n\nAnecdotal accounts indicate that a spike in Unused commitments before the *acquisition* date could be due to borrowers paying down their cards, and even closing them, to mitigate concerns around the transition [@redditBarc]. The borrowers who can pay down their loans are likely low-risk, which may result in the portfolio, at the time of the partnership event, looking more risky than it really is (given *Credit Card Plans-30-89 DAYS P/D %* is a proportion of the credit card loans). \n\nIncreases in credit card loans in the *old* bank, as seen in GAP and Walmart, is unexpected. An assumption is that these banks marketed alternative cards to keep borrowers.   \n\n## Additional information on partnerships\n\nGiven our goal to generalise partnership impacts by FICO and/or Industry we need to use additional public data sources to provide this mapping. \n\n### FICO Score\nThe *Terms of credit card plans (TCCP) survey* [@TCCP2022] provides credit card details including their target FICO Tiers and Annual Percentage Rate (APR). @boston2000 found that banks faced an adverse selection problem whereby it was profitable to offer credit card deals with high APR that attracted risker borrowers even though there was evidence of higher delinquency. We can see from TCCP's 2022 survey in @tbl-tccp-apr that the APR does not differ between partnership and bank branded cards.\n\n\n[TCCP data download](data/cfpb_tccp-data_2022-07-01_2022_12-31.xlsx)\n\n\n::: {#tbl-tccp .cell tbl-cap='Subset of TCCP survey (2022)'}\n\n```{.r .cell-code}\ntccp <- readxl::read_excel(\"data/cfpb_tccp-data_2022-07-01_2022_12-31.xlsx\", skip=9) |>\nfilter(`Availability of Credit Card Plan` == \"National\") |> \ndplyr::select(`Product Name`, Partner, `Institution Name`, `Targeted Credit Tiers`,\nServices,`Other Services`,Rewards,`Other Rewards`,`Website for Consumer`, MaxAPR = `Maximum APR...38`) \n\ntccp |> filter(grepl(\"Walmart|GAP|Apple|Costco|Wayfair|Old Navy|GP\", `Product Name`, ignore.case = TRUE)) \n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Product Name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Partner\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Institution Name\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Targeted Credit Tiers\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Services\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Other Services\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Rewards\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Other Rewards\"],\"name\":[8],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Website for Consumer\"],\"name\":[9],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"MaxAPR\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Wayfair MasterCard\",\"2\":\"1\",\"3\":\"CITIBANK, N.A.\",\"4\":\"Poor or fair credit (credit score 619 or less); Good credit (credit scores from 620 to 719); Great Credit (credit score of 720 or greater)\",\"5\":\"NA\",\"6\":\"NA\",\"7\":\"NA\",\"8\":\"NA\",\"9\":\"https://wayfair.com/wayfaircard\",\"10\":\"0.3149\"},{\"1\":\"Costco Anywhere Visa Card\",\"2\":\"1\",\"3\":\"CITIBANK, N.A.\",\"4\":\"Poor or fair credit (credit score 619 or less); Good credit (credit scores from 620 to 719); Great Credit (credit score of 720 or greater)\",\"5\":\"NA\",\"6\":\"NA\",\"7\":\"Cashback rewards\",\"8\":\"NA\",\"9\":\"https://citi.com/credit-cards\",\"10\":\"0.1974\"},{\"1\":\"Old Navy Mastercard\",\"2\":\"1\",\"3\":\"BARCLAYS BANK DELAWARE\",\"4\":\"Good credit (credit scores from 620 to 719); Great Credit (credit score of 720 or greater)\",\"5\":\"Access to Free Credit Scores; Automobile rental insurance; Discounts on purchases of goods and services (non travel related); Other\",\"6\":\"Subscription to identification protection services\\\\r\\\\nEarly access to store sales\",\"7\":\"Other rewards\",\"8\":\"Store Point Rewards\\\\r\\\\nFirst Purchase Discount\",\"9\":\"https://cards.barclaycardus.com/\",\"10\":\"0.2899\"},{\"1\":\"Apple Card\",\"2\":\"1\",\"3\":\"GOLDMAN SACHS BANK USA\",\"4\":\"Poor or fair credit (credit score 619 or less); Good credit (credit scores from 620 to 719); Great Credit (credit score of 720 or greater)\",\"5\":\"NA\",\"6\":\"NA\",\"7\":\"Cashback rewards\",\"8\":\"NA\",\"9\":\"https://www.apple.com/apple-card/\",\"10\":\"0.2574\"},{\"1\":\"Capital One Walmart Rewards Card\",\"2\":\"1\",\"3\":\"CAPITAL ONE, NATIONAL ASSOCIATION\",\"4\":\"Poor or fair credit (credit score 619 or less); Good credit (credit scores from 620 to 719); Great Credit (credit score of 720 or greater)\",\"5\":\"Access to Free Credit Scores; Discounts on purchases of goods and services (non travel related); Extension on manufacturer’s warranty; Other\",\"6\":\"This product also features benefits as offered by Mastercard.\",\"7\":\"Cashback rewards\",\"8\":\"NA\",\"9\":\"https://www.capitalone.com/credit-cards/\",\"10\":\"0.2849\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {#tbl-tccp-apr .cell tbl-cap='Median summary APR for partnership cards vs. bank branded cards'}\n\n```{.r .cell-code}\npeer_df <- dplyr::bind_rows(\n            readr::read_delim(\"data/CDR-UBPR_RT6_PEERGROUP_201_2023_12_31.txt\", skip=5,show_col_types = FALSE) |> tibble::add_column(BankType = \"LargeCreditCardBank\"),\n            readr::read_delim(\"data/CDR-UBPR_RT6_PEERGROUP_1_2023_12_31.txt\", skip=5,show_col_types = FALSE) |> tibble::add_column(BankType = \"LargeBank\")\n            ) |> mutate(Name = trimws(Name)) \n\ntccp <- readxl::read_xlsx(\"data/cfpb_tccp-data_2022-07-01_2022_12-31.xlsx\", skip = 9) |> mutate(BankName = trimws(`Institution Name`)) |> relocate(BankName) |>\n    mutate(BankName = case_when(\n                  BankName == \"SYNCHRONY FINANCIAL\" ~ \"SYNCHRONY BANK\",\n                  BankName == \"MERRICK BANK CORPORATION\" ~ \"MERRICK BANK\",\n                  BankName == \"PNC Bank N.A.\" ~ \"PNC BANK, NATIONAL ASSOCIATION\",              \n                  BankName == \"BMO HARRIS BANK NATIONAL ASSOCIATION\" ~  \"BMO BANK NATIONAL ASSOCIATION\",   \n                  .default = BankName\n            ))\n\nfinal_tccp <- peer_df |> left_join(tccp, by = join_by(Name == BankName)) |> \n                mutate(BankName = paste0(Name, \" (\", `ID RSSD`, \")\") ) |> \n                    relocate(BankName) |> \n                    rename(TargetTiers = `Targeted Credit Tiers`) |>\n                        separate_wider_delim(TargetTiers,\" \",names = \"LowestTier\", too_many = \"drop\") \n\ntccp_maxapr <- final_tccp |> \n                dplyr::select(BankName, BankType, Partner, LowestTier, contains(\"Maximum APR\")) |> rowwise() |>\n                mutate(MaxAPR=max(c_across(contains(\"Maximum APR\")), na.rm = TRUE)) |> relocate(MaxAPR) |> group_by(BankName,BankType, Partner, LowestTier) |> summarise(MaxAPR = median(MaxAPR))\n\ntccp_maxapr |> \n  group_by(BankType, Partner) |> \n  summarise(MaxAPR = median(MaxAPR, na.rm=TRUE)) |> drop_na(Partner) |> mutate(Partner = if_else(Partner == 1 , \"Yes\", \"No\"), MaxAPR = MaxAPR*100) |> dplyr::select(`Partnership card` = Partner, `Max APR (%)` = MaxAPR)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"BankType\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Partnership card\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Max APR (%)\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"LargeBank\",\"2\":\"No\",\"3\":\"28.99\"},{\"1\":\"LargeBank\",\"2\":\"Yes\",\"3\":\"29.99\"},{\"1\":\"LargeCreditCardBank\",\"2\":\"No\",\"3\":\"29.49\"},{\"1\":\"LargeCreditCardBank\",\"2\":\"Yes\",\"3\":\"29.99\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### Industry Classification\n\nThe US uses the *North American Industry Classification System (NAICS)* [@naics] which we will utilise at the granularity that provides some grouping. For our use cases NAICS hierarchy level 5 looks promising.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nread_csv(\"data/Partner_NAICS.csv\",show_col_types = FALSE)|>\n                rmarkdown::paged_table()  \n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Partner\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"NAICS\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Level6\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Level5\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Level3\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Costco\",\"2\":\"455211\",\"3\":\"Warehouse Clubs and Supercenters\",\"4\":\"Department Stores\",\"5\":\"General Merchandise Retailers\"},{\"1\":\"Walmart\",\"2\":\"455110\",\"3\":\"Department Stores\",\"4\":\"Department Stores\",\"5\":\"General Merchandise Retailers\"},{\"1\":\"GAP\",\"2\":\"458110\",\"3\":\"Clothing and Clothing Accessories Retailers\",\"4\":\"Clothing and Clothing Accessories Retailers\",\"5\":\"Clothing, Clothing Accessories, Shoe, and Jewelry Retailers\"},{\"1\":\"GM\",\"2\":\"336390\",\"3\":\"Other Motor Vehicle Parts Manufacturing\",\"4\":\"Other Motor Vehicle Parts Manufacturing\",\"5\":\"Transportation Equipment Manufacturing\"},{\"1\":\"Apple\",\"2\":\"334111\",\"3\":\"Electronic Computer Manufacturing\",\"4\":\"Computer and Peripheral Equipment Manufacturing\",\"5\":\"Computer and Electronic Product Manufacturing\"},{\"1\":\"Wayfair\",\"2\":\"459999\",\"3\":\"All Other Miscellaneous Retailers\",\"4\":\"All Other Miscellaneous Retailers\",\"5\":\"Sporting Goods, Hobby, Musical Instrument, Book, and Miscellaneous Retailers\"},{\"1\":\"BestBuy\",\"2\":\"449210\",\"3\":\"Electronics and Appliance Retailers\",\"4\":\"Electronics and Appliance Retailers\",\"5\":\"Electronics and Appliance Retailers\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}