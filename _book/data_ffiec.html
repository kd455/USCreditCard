<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>US Credit Card - 2&nbsp; Bank Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./data_banks.html" rel="next">
<link href="./intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data_ffiec.html">Data</a></li><li class="breadcrumb-item"><a href="./data_ffiec.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Bank Data</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">US Credit Card</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_ffiec.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Bank Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_banks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bank Peer Groups</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_partners.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bank Partnerships</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_fed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">data_fed.html</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./event.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Event study</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#measure-of-portfolio-quality" id="toc-measure-of-portfolio-quality" class="nav-link active" data-scroll-target="#measure-of-portfolio-quality"><span class="header-section-number">2.1</span> Measure of portfolio quality</a></li>
  <li><a href="#bank-peer-groups" id="toc-bank-peer-groups" class="nav-link" data-scroll-target="#bank-peer-groups"><span class="header-section-number">2.2</span> Bank Peer Groups</a></li>
  <li><a href="#data-period" id="toc-data-period" class="nav-link" data-scroll-target="#data-period"><span class="header-section-number">2.3</span> Data Period</a></li>
  <li><a href="#sec-outliers" id="toc-sec-outliers" class="nav-link" data-scroll-target="#sec-outliers"><span class="header-section-number">2.4</span> Bank Outliers</a></li>
  <li><a href="#sec-feature-explore" id="toc-sec-feature-explore" class="nav-link" data-scroll-target="#sec-feature-explore"><span class="header-section-number">2.5</span> Exploration of Statistical Features</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">2.6</span> Summary</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">2.7</span> References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Bank Data</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>US banks are required to report quarterly financial data e.g., Balance Sheet and Income Statements, to the US Federal Financial Institutions Examination Council (FFIEC) who make this data publicly available in a consolidated format as a part of their Uniform Bank Performance Reporting (UBPR) regime. Data is available from 2002 Q4 <span class="citation" data-cites="ffiec">FFIEC (<a href="#ref-ffiec" role="doc-biblioref">2023</a>)</span>.</p>
<p>We are interested in measures that will provide insights to Bank’s credit card businesses as shown in <a href="#tbl-ccmeasures">Table&nbsp;<span>2.1</span></a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">'functions.R'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">credit_card</span>() <span class="sc">|&gt;</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(Measure, Description) <span class="sc">|&gt;</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">str_detect</span>(Description, <span class="st">"Credit|90 days"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-ccmeasures" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;2.1: UBPR Credit Card Measures</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Measure</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">UBPR3815</td>
<td style="text-align: left;">Unused Commitments on Credit Cards</td>
</tr>
<tr class="even">
<td style="text-align: left;">UBPRB538</td>
<td style="text-align: left;">Loans to Individuals for Household, Family, and Other Personal Expenditures (I.E., Consumer Loans)(Includes Purchased Paper):Credit Cards</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UBPRE263</td>
<td style="text-align: left;">Unused Commitments on Credit Cards as a percent of Total Assets</td>
</tr>
<tr class="even">
<td style="text-align: left;">UBPRE425</td>
<td style="text-align: left;">Credit Card Loans, % Gross LN&amp;LS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UBPRE889</td>
<td style="text-align: left;">Credit Card Loans, % Tier 1 Capital plus Allowance</td>
</tr>
<tr class="even">
<td style="text-align: left;">UBPRE521</td>
<td style="text-align: left;">Credit Card Plans-90+ Days P/D %</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UBPRE522</td>
<td style="text-align: left;">Credit Card Plans-Nonaccrual %</td>
</tr>
<tr class="even">
<td style="text-align: left;">UBPRE523</td>
<td style="text-align: left;">90 days+ Nonaccrual (UBPRE521+UBPRE522)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UBPRE524</td>
<td style="text-align: left;">Credit Card Plans-30-89 DAYS P/D %</td>
</tr>
<tr class="even">
<td style="text-align: left;">UBPRE411</td>
<td style="text-align: left;">Credit Card Plans Net Losses (%)</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<section id="measure-of-portfolio-quality" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="measure-of-portfolio-quality"><span class="header-section-number">2.1</span> Measure of portfolio quality</h2>
<p>To measure quality we can use the proportion of credit cards that are delinquent in the portfolio. This is the sum of UBPRE523 and UBPRE524; accounts that are accruing payments but are overdue by 30 day+ or are in non-accrual status i.e.&nbsp;non-performing loans.</p>
<p>However, given we are interested in the impact of a partnership, using measure <strong>Credit Card Plans-30-89 DAYS P/D %</strong> (UBPRE524) is ideal as it gives us the earliest indicator of delinquency.</p>
</section>
<section id="bank-peer-groups" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="bank-peer-groups"><span class="header-section-number">2.2</span> Bank Peer Groups</h2>
<p>The scope of Banks included in our analysis is not limited to the banks involved in credit card partnerships. We can use data from FFIEC to add information about their peers i.e.&nbsp;other banks that are similar.</p>
<p><a href="#tbl-peergrpcnt">Table&nbsp;<span>2.2</span></a> details 3 peer groups. National (US-wide) Credit card partnerships occur between banks in the <strong>Large Bank</strong> and <strong>Large Credit Card Bank</strong> groups. These peer groups are defined by FFIEC (see <a href="data_banks.html#sec-peers"><span>Section&nbsp;3.1</span></a> for full list of Banks in each peer group) <span class="citation" data-cites="ffiec">(<a href="#ref-ffiec" role="doc-biblioref">FFIEC 2023</a>)</span>.</p>
<p>A Large Bank like CITIBANK will have a multiple businesses: household mortgages and credit cards; market trading; investment banking and more. In contrast, large credit card banks like BARCLAYS US specialise in credit cards only. Consequently, we expect to see the peer groups react differently to external factors, or exhibit different internal dynamics and risk profiles.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>overdue30to89 <span class="ot">&lt;-</span> <span class="fu">credit_card.overdue_3089</span>()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>target_label <span class="ot">&lt;-</span> <span class="fu">credit_card.target_label</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>bank_scope <span class="ot">&lt;-</span> overdue30to89 <span class="sc">|&gt;</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">group_by</span>(BankName,BankType) <span class="sc">|&gt;</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summarise</span>(<span class="at">total_bal =</span> <span class="fu">sum</span>(<span class="fu">abs</span>(Value),<span class="at">na.rm=</span>T)) <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(total_bal)<span class="sc">|</span>total_bal<span class="sc">==</span><span class="dv">0</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>bank_n <span class="ot">&lt;-</span> bank_scope <span class="sc">|&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by</span>(BankType) <span class="sc">|&gt;</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">Number =</span> <span class="fu">n</span>())</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>bank_n <span class="sc">|&gt;</span> <span class="fu">right_join</span>(<span class="fu">bank_type.desc</span>()) <span class="sc">|&gt;</span> <span class="fu">relocate</span>(Number, <span class="at">.after =</span> <span class="fu">last_col</span>()) <span class="sc">|&gt;</span>  </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-peergrpcnt" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;2.2: Number of Banks in each peer group</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">BankType</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">PeerId</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Criteria</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Examples</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LargeBank</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">Insured commercial banks having assets greater than $100 billion</td>
<td style="text-align: left;">CITIBANK, JPMORGAN CHASE BANK, MORGAN STANLEY</td>
<td style="text-align: right;">22</td>
</tr>
<tr class="even">
<td style="text-align: left;">LargeCreditCardBank</td>
<td style="text-align: left;">201</td>
<td style="text-align: left;">Large Credit Card Banks: Credit card specialty banks having assets greater than $ 3 billion</td>
<td style="text-align: left;">BARCLAYS BANK, SYNCHRONY BANK, DISCOVER BANK</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OtherBank</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Other - all other Banks that have reported UBPRE524</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">1257</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Why are there thousands of Banks? The US Banking system grew out of 19th-century regulations that restricted where banks could operate. This resulted in a very localised Banking market. Today big banks such as JPMorgan Chase, Bank of America, Citigroup and Wells Fargo, dominate the industry but there are still about 4,100 US Banks compared with 353 in Britain and 261 in Germany <span class="citation" data-cites="economist2023">(<a href="#ref-economist2023" role="doc-biblioref">Economist 2023</a>)</span>.</p>
</div>
</div>
</section>
<section id="data-period" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="data-period"><span class="header-section-number">2.3</span> Data Period</h2>
<p>Regulation implemented in 2010 had a material impact on the credit card market <span class="citation" data-cites="cfpb2013 boston2014">(<a href="#ref-cfpb2013" role="doc-biblioref">CFPB 2013</a>; also <a href="#ref-boston2014" role="doc-biblioref">Jambulapati and Stavins 2013</a>)</span>. As highlighted by <span class="citation" data-cites="boston2014">Jambulapati and Stavins (<a href="#ref-boston2014" role="doc-biblioref">2013</a>)</span>, regulation coincided with the 2008 financial crisis and recession, making it difficult to fully assert causation <span class="citation" data-cites="boston2014">(<a href="#ref-boston2014" role="doc-biblioref">2013</a>)</span>.</p>
<p>The regulations introduced were:</p>
<ol type="1">
<li>Credit Card Accountability Responsibility and Disclosure (CARD) Act of 2009 which had a staggered implementation in February and August 2010. This Act requires Banks to assess whether a potential borrower has the means to repay. Additionally, high-risk borrowers like those under 21, have additional restrictions. This has led to stricter lending criteria e.g., income and credit history checks <span class="citation" data-cites="cfpb2013">(<a href="#ref-cfpb2013" role="doc-biblioref">CFPB 2013</a>)</span>.</li>
<li>Regulation Z, or the Truth in Lending Act (TILA), focuses on ensuring transparency and fairness in lending practices. Banks have to provide full disclosure of the terms and conditions of a loan agreement <span class="citation" data-cites="cfpb2010z">(<a href="#ref-cfpb2010z" role="doc-biblioref">CFPBb 2023</a>)</span>.</li>
</ol>
<p>We can see the impact in <a href="#fig-regulation">Figure&nbsp;<span>2.1</span></a> which plots a linear trend for <em>Credit Card Plans-30-89 DAYS P/D %</em> for each peer group. Based on <a href="#fig-regulation-3">Figure&nbsp;<span>2.1 (c)</span></a> there was increasing delinquency for Large Banks and Large Credit Card Banks before regulation, but post regulation the trend has reversed and is now trending down.</p>
<p>For our analysis we will focus on credit card partnerships post regulation as this is more relevant for commenting on future partnership deals.</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>reg_date_z <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2010-07-01"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>reg_date_c1 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2010-02-22"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>reg_date_c2 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2010-08-22"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>overdue30to89 <span class="sc">|&gt;</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value_diff <span class="sc">&lt;=</span> <span class="dv">23</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(BankType) <span class="sc">|&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">val_mean =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm=</span>T)) <span class="sc">|&gt;</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">autoplot</span>(val_mean, <span class="fu">aes</span>(<span class="at">colour=</span>BankType)) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> F, <span class="at">linewidth=</span>.<span class="dv">5</span>) <span class="sc">+</span>    </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">bank_type.colours</span>())<span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">legend.title=</span><span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y=</span><span class="fu">glue</span>(<span class="st">"{target_label} </span><span class="sc">\n</span><span class="st"> mean"</span>), <span class="at">x=</span><span class="st">""</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>overdue30to89 <span class="sc">|&gt;</span> </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value_diff <span class="sc">&lt;=</span> <span class="dv">23</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(BankType) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">variance =</span> <span class="fu">var</span>(Value)) <span class="sc">|&gt;</span> </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(variance) <span class="sc">+</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> reg_date_c1,<span class="at">linetype=</span><span class="dv">2</span>,<span class="at">colour=</span><span class="st">"red"</span>, <span class="at">hjust =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"label"</span>,<span class="at">label=</span><span class="st">"i"</span>, <span class="at">x=</span>reg_date_c1, <span class="at">y=</span><span class="fl">20.0</span>) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> reg_date_z,<span class="at">linetype=</span><span class="dv">2</span>,<span class="at">colour=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"label"</span>,<span class="at">label=</span><span class="st">"ii"</span>, <span class="at">x=</span>reg_date_z, <span class="at">y=</span><span class="fl">18.0</span>) <span class="sc">+</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> reg_date_c2,<span class="at">linetype=</span><span class="dv">2</span>,<span class="at">colour=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"label"</span>,<span class="at">label=</span><span class="st">"iii"</span>, <span class="at">x=</span>reg_date_c2, <span class="at">y=</span><span class="fl">16.0</span>, <span class="at">hjust =</span> <span class="sc">-</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y=</span><span class="fu">glue</span>(<span class="st">"{target_label} </span><span class="sc">\n</span><span class="st"> variance"</span>), <span class="at">x=</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">bank_type.colours</span>())<span class="sc">+</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>, <span class="at">legend.title=</span><span class="fu">element_blank</span>()) </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>overdue30to89 <span class="sc">|&gt;</span> </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value_diff <span class="sc">&lt;=</span> <span class="dv">23</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">regulation =</span> <span class="fu">ifelse</span>(<span class="fu">as.Date</span>(Quarter) <span class="sc">&lt;</span> reg_date_c1, <span class="st">'Before'</span>, <span class="st">'After'</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(BankType, regulation) <span class="sc">|&gt;</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">val_mean =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm=</span>T)) <span class="sc">|&gt;</span> </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">autoplot</span>(val_mean, <span class="fu">aes</span>(<span class="at">colour=</span>BankType)) <span class="sc">+</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> F,<span class="at">size=</span>.<span class="dv">5</span>) <span class="sc">+</span>    </span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">bank_type.colours</span>(), <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"LargeBank"</span>,<span class="st">"LargeCreditCardBank"</span>,<span class="st">"OtherBank"</span>))<span class="sc">+</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> reg_date_c1,<span class="at">linetype=</span><span class="dv">2</span>,<span class="at">colour=</span><span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotate</span>(<span class="st">"label"</span>,<span class="at">label=</span><span class="st">"CARD Act Part 1 comes into effect"</span>, <span class="at">x=</span>reg_date_c1, <span class="at">y=</span><span class="fl">3.5</span>, <span class="at">hjust =</span> <span class="sc">-</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y=</span><span class="fu">glue</span>(<span class="st">"{target_label} </span><span class="sc">\n</span><span class="st"> mean"</span>), <span class="at">x=</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>, <span class="at">legend.title=</span><span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-regulation" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-regulation-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-regulation-1.png" class="img-fluid figure-img" data-ref-parent="fig-regulation" width="672"></p>
<figcaption class="figure-caption">(a) Bank Type have different intercepts and data patterns</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-regulation-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-regulation-2.png" class="img-fluid figure-img" data-ref-parent="fig-regulation" width="672"></p>
<figcaption class="figure-caption">(b) Variance pre and post Regulation <br>(i) - CARD Act part 1 (ii) - Regulation Z and (iii) Card Act part 2 <br>The variance for Large Banks and Large Credit Card Banks have reduced post regulatory changes.</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-regulation-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-regulation-3.png" class="img-fluid figure-img" data-ref-parent="fig-regulation" width="672"></p>
<figcaption class="figure-caption">(c) Linear trend pre and post Regulation.</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.1: Impact of Regulation</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="sec-outliers" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="sec-outliers"><span class="header-section-number">2.4</span> Bank Outliers</h2>
<p>As we are dealing with time series data, we need to identify banks where their individual series characteristics are markedly different from those of its peers.</p>
<p><a href="#fig-outliers">Figure&nbsp;<span>2.2</span></a> takes the approach from <span class="citation" data-cites="Hyndman2021">Hyndman and Athanasopoulos (<a href="#ref-Hyndman2021" role="doc-biblioref">2021</a>)</span> who use Principal Components Analysis (PCA) on a set of calculated statistical features such as intermittency, lumpiness, stability and Seasonal-Trend decomposition using LOESS (STL) <span class="citation" data-cites="Hyndman2021">(<a href="#ref-Hyndman2021" role="doc-biblioref">2021</a>)</span>.</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>regulation_cutoff <span class="ot">&lt;-</span> <span class="st">"2010 Q2"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>selected_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lumpiness"</span>,<span class="st">"stability"</span>,<span class="st">"seasonal"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>overdue30to89_post <span class="ot">&lt;-</span> overdue30to89 <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">filter_index</span>(regulation_cutoff <span class="sc">~</span> .) </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>overdue30to89_lbanks <span class="ot">&lt;-</span> overdue30to89_post <span class="sc">|&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">filter</span>(BankType <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"LargeBank"</span>, <span class="st">"LargeCreditCardBank"</span>))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>all_f <span class="ot">&lt;-</span> overdue30to89_lbanks <span class="sc">|&gt;</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">features</span>(Value, <span class="fu">feature_set</span>(<span class="at">tags =</span> selected_feats))</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>pcs <span class="ot">&lt;-</span> all_f <span class="sc">|&gt;</span> </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_if</span>(is.numeric, replace_na, <span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="co">#where we could not calc a feature value</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(IDRSSD,BankName, Measure, Label, Description, BankType)) <span class="sc">|&gt;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prcomp</span>(<span class="at">scale =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    broom<span class="sc">::</span><span class="fu">augment</span>(all_f)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>pc1_threshold <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>pc2_threshold <span class="ot">&lt;-</span> <span class="fl">2.5</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="fu">pcs.plot</span>(pcs)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> pcs <span class="sc">|&gt;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( (.fittedPC2 <span class="sc">&gt;</span> pc2_threshold) <span class="sc">|</span> (.fittedPC1 <span class="sc">&gt;</span> pc1_threshold)) <span class="sc">|&gt;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(IDRSSD) </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="fu">outlier.plot</span>(overdue30to89_lbanks, outliers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-outliers" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-outliers-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-outliers-1.png" class="img-fluid figure-img" data-ref-parent="fig-outliers" width="672"></p>
<figcaption class="figure-caption">(a) PCA for <span style="color:#1B9E77">Large</span> and <span style="color:#D95F02">Large Credit Card</span> Banks using features: lumpiness, stability and seasonal. PC1 represents the most variation in the data and PC2 represents the second most variation in the data.</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-outliers-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-outliers-2.png" class="img-fluid figure-img" data-ref-parent="fig-outliers" width="672"></p>
<figcaption class="figure-caption">(b) Data series for Banks with PC1 &gt; 4 and PC2 &gt; 2.5</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.2: Outlier Detection using PCA</figcaption><p></p>
</figure>
</div>
</div>
<p>Interestingly, all the banks in <a href="#fig-outliers-2">Figure&nbsp;<span>2.2 (b)</span></a> started or re-started (as was the case for Regions Bank) their credit card businesses after 2010 Q2 (regulatory period cut-off). With the exception of Ally Bank all series begin at 0 and sharply increase after the first or second quarter. This pattern is expected as it takes 30+ days for credit cards to become delinquent.</p>
<p>If we drop the first 2 non-zero quarters and re-run the PCA (see <a href="#fig-outliers-corrected">Figure&nbsp;<span>2.3</span></a>) the banks are no longer outliers - indicating that it was that sharp increase that was unusual.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>outlier_df <span class="ot">&lt;-</span>overdue30to89_lbanks <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(IDRSSD <span class="sc">%in%</span> outliers<span class="sc">$</span>IDRSSD, Value <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    tsibble<span class="sc">::</span><span class="fu">group_by_key</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">slice</span>(<span class="dv">3</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>all_f_outliers <span class="ot">&lt;-</span> outlier_df <span class="sc">|&gt;</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">features</span>(Value, <span class="fu">feature_set</span>(<span class="at">tags =</span> selected_feats))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>all_f_outliers <span class="sc">|&gt;</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_if</span>(is.numeric, replace_na, <span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="co">#where we could not calc a feature value</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(IDRSSD,BankName, Measure, Label, Description, BankType)) <span class="sc">|&gt;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prcomp</span>(<span class="at">scale =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    broom<span class="sc">::</span><span class="fu">augment</span>(all_f_outliers) <span class="sc">|&gt;</span> <span class="fu">pcs.plot</span>()                            </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-outliers-corrected" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-outliers-corrected-1.png" class="img-fluid figure-img" width="384"></p>
<figcaption class="figure-caption">Figure&nbsp;2.3: PCA of outliers after their first 2 non-zero quarters are dropped</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#apply 1. regulatory cutoff, 2. fixed outliers.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df_alltypes <span class="ot">&lt;-</span> overdue30to89_post <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="sc">!</span>IDRSSD <span class="sc">%in%</span> outliers<span class="sc">$</span>IDRSSD) <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">add_row</span>(outlier_df) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fill_gaps</span>()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>all_ftbanks <span class="ot">&lt;-</span> df_alltypes <span class="sc">|&gt;</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">features</span>(Value, <span class="fu">feature_set</span>(<span class="at">tags =</span> selected_feats))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>final_df <span class="ot">&lt;-</span> df_alltypes <span class="sc">|&gt;</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(BankType <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"LargeBank"</span>, <span class="st">"LargeCreditCardBank"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">value_diff =</span> <span class="fu">difference</span>(Value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="sec-feature-explore" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="sec-feature-explore"><span class="header-section-number">2.5</span> Exploration of Statistical Features</h2>
<p><a href="#fig-quantile">Figure&nbsp;<span>2.4</span></a> plots the distribution of Credit Card Plans-30-89 DAYS P/D %. We can see that there are two peaks for <em>Large Credit Card Banks</em>. There are 7 banks in the this peer group which may be too small to capture the true distribution effectively. However, it may also indicate that there are sub-groups within this peer group. For instance, the first peak could represent banks that have lower risk profiles, while the second represents banks that have a higher risk profiles.</p>
<div class="tabset-margin-container"></div><div id="tbl-quantile" class="panel-tabset anchored">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Distribution</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Quantiles - Large Credit Card Banks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Quantiles - Large Banks</a></li></ul>
<div id="tbl-quantile" class="tab-content anchored">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(final_df, <span class="fu">aes</span>(<span class="at">x=</span>Value, <span class="at">colour =</span> BankType))<span class="sc">+</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span>target_label) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>,<span class="at">legend.title=</span><span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">bank_type.colours</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-quantile" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-quantile-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.4: Density plot</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>final_df <span class="sc">|&gt;</span> <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BankType <span class="sc">==</span> <span class="st">"LargeCreditCardBank"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(Value, quantile)<span class="sc">|&gt;</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(IDRSSD,Measure,Label,Description,BankType)) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="st">`</span><span class="at">100%</span><span class="st">`</span>)<span class="sc">|&gt;</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>)        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">BankName</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">0%</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">25%</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">50%</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">75%</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">100%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AMERICAN EXPRESS NATIONAL BANK (1394676)</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">0.94</td>
</tr>
<tr class="even">
<td style="text-align: left;">DISCOVER BANK (30810)</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">1.08</td>
<td style="text-align: right;">1.89</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BARCLAYS BANK DELAWARE (2980209)</td>
<td style="text-align: right;">0.66</td>
<td style="text-align: right;">1.06</td>
<td style="text-align: right;">1.14</td>
<td style="text-align: right;">1.25</td>
<td style="text-align: right;">2.40</td>
</tr>
<tr class="even">
<td style="text-align: left;">SYNCHRONY BANK (1216022)</td>
<td style="text-align: right;">1.15</td>
<td style="text-align: right;">2.01</td>
<td style="text-align: right;">2.22</td>
<td style="text-align: right;">2.39</td>
<td style="text-align: right;">2.76</td>
</tr>
<tr class="odd">
<td style="text-align: left;">COMENITY BANK (1391778)</td>
<td style="text-align: right;">2.35</td>
<td style="text-align: right;">2.74</td>
<td style="text-align: right;">3.05</td>
<td style="text-align: right;">3.47</td>
<td style="text-align: right;">3.90</td>
</tr>
<tr class="even">
<td style="text-align: left;">COMENITY CAPITAL BANK (3224580)</td>
<td style="text-align: right;">2.13</td>
<td style="text-align: right;">2.62</td>
<td style="text-align: right;">2.73</td>
<td style="text-align: right;">2.98</td>
<td style="text-align: right;">3.91</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MERRICK BANK CORPORATION (2615190)</td>
<td style="text-align: right;">1.86</td>
<td style="text-align: right;">2.94</td>
<td style="text-align: right;">3.41</td>
<td style="text-align: right;">3.80</td>
<td style="text-align: right;">5.44</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>final_df <span class="sc">|&gt;</span> <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BankType <span class="sc">==</span> <span class="st">"LargeBank"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(Value, quantile)<span class="sc">|&gt;</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(IDRSSD,Measure,Label,Description,BankType)) <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="st">`</span><span class="at">100%</span><span class="st">`</span>)<span class="sc">|&gt;</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">BankName</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">0%</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">25%</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">50%</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">75%</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">100%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BANK OF AMERICA, NATIONAL ASSOCIATION (480228)</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.770</td>
<td style="text-align: right;">0.910</td>
<td style="text-align: right;">1.03</td>
</tr>
<tr class="even">
<td style="text-align: left;">UBS BANK USA (3212149)</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.4700</td>
<td style="text-align: right;">0.540</td>
<td style="text-align: right;">0.720</td>
<td style="text-align: right;">1.05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MANUFACTURERS AND TRADERS TRUST COMPANY (501105)</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.9100</td>
<td style="text-align: right;">1.080</td>
<td style="text-align: right;">1.170</td>
<td style="text-align: right;">1.58</td>
</tr>
<tr class="even">
<td style="text-align: left;">REGIONS BANK (233031)</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: right;">1.1300</td>
<td style="text-align: right;">1.280</td>
<td style="text-align: right;">1.370</td>
<td style="text-align: right;">1.65</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HUNTINGTON NATIONAL BANK, THE (12311)</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.6600</td>
<td style="text-align: right;">0.805</td>
<td style="text-align: right;">1.245</td>
<td style="text-align: right;">1.69</td>
</tr>
<tr class="even">
<td style="text-align: left;">FIRST-CITIZENS BANK &amp; TRUST COMPANY (491224)</td>
<td style="text-align: right;">0.74</td>
<td style="text-align: right;">0.8400</td>
<td style="text-align: right;">0.970</td>
<td style="text-align: right;">1.120</td>
<td style="text-align: right;">1.72</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FIFTH THIRD BANK, NATIONAL ASSOCIATION (723112)</td>
<td style="text-align: right;">0.84</td>
<td style="text-align: right;">1.0000</td>
<td style="text-align: right;">1.150</td>
<td style="text-align: right;">1.390</td>
<td style="text-align: right;">1.80</td>
</tr>
<tr class="even">
<td style="text-align: left;">U.S. BANK NATIONAL ASSOCIATION (504713)</td>
<td style="text-align: right;">0.72</td>
<td style="text-align: right;">1.1200</td>
<td style="text-align: right;">1.240</td>
<td style="text-align: right;">1.320</td>
<td style="text-align: right;">1.85</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TD BANK, N.A. (497404)</td>
<td style="text-align: right;">0.79</td>
<td style="text-align: right;">1.2200</td>
<td style="text-align: right;">1.410</td>
<td style="text-align: right;">1.540</td>
<td style="text-align: right;">2.16</td>
</tr>
<tr class="even">
<td style="text-align: left;">CITIZENS BANK, NATIONAL ASSOCIATION (3303298)</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">1.1000</td>
<td style="text-align: right;">1.190</td>
<td style="text-align: right;">1.280</td>
<td style="text-align: right;">2.17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GOLDMAN SACHS BANK USA (2182786)</td>
<td style="text-align: right;">0.82</td>
<td style="text-align: right;">0.9600</td>
<td style="text-align: right;">1.080</td>
<td style="text-align: right;">1.650</td>
<td style="text-align: right;">2.19</td>
</tr>
<tr class="even">
<td style="text-align: left;">KEYBANK NATIONAL ASSOCIATION (280110)</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">0.8550</td>
<td style="text-align: right;">1.040</td>
<td style="text-align: right;">1.200</td>
<td style="text-align: right;">2.26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TRUIST BANK (852320)</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">0.8300</td>
<td style="text-align: right;">0.910</td>
<td style="text-align: right;">1.110</td>
<td style="text-align: right;">2.34</td>
</tr>
<tr class="even">
<td style="text-align: left;">PNC BANK, NATIONAL ASSOCIATION (817824)</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: right;">1.0800</td>
<td style="text-align: right;">1.240</td>
<td style="text-align: right;">1.390</td>
<td style="text-align: right;">2.42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HSBC BANK USA, NATIONAL ASSOCIATION (413208)</td>
<td style="text-align: right;">0.88</td>
<td style="text-align: right;">1.3100</td>
<td style="text-align: right;">1.490</td>
<td style="text-align: right;">1.790</td>
<td style="text-align: right;">2.44</td>
</tr>
<tr class="even">
<td style="text-align: left;">JPMORGAN CHASE BANK, NATIONAL ASSOCIATION (852218)</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.7500</td>
<td style="text-align: right;">0.880</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">2.53</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CAPITAL ONE, NATIONAL ASSOCIATION (112837)</td>
<td style="text-align: right;">1.16</td>
<td style="text-align: right;">1.5900</td>
<td style="text-align: right;">1.825</td>
<td style="text-align: right;">2.040</td>
<td style="text-align: right;">2.62</td>
</tr>
<tr class="even">
<td style="text-align: left;">SANTANDER BANK, NATIONAL ASSOCIATION (722777)</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">0.9825</td>
<td style="text-align: right;">1.380</td>
<td style="text-align: right;">1.480</td>
<td style="text-align: right;">2.67</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WELLS FARGO BANK, NATIONAL ASSOCIATION (451965)</td>
<td style="text-align: right;">0.69</td>
<td style="text-align: right;">1.1000</td>
<td style="text-align: right;">1.230</td>
<td style="text-align: right;">1.320</td>
<td style="text-align: right;">2.75</td>
</tr>
<tr class="even">
<td style="text-align: left;">ALLY BANK (3284070)</td>
<td style="text-align: right;">1.47</td>
<td style="text-align: right;">2.1000</td>
<td style="text-align: right;">2.380</td>
<td style="text-align: right;">2.380</td>
<td style="text-align: right;">2.79</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CITIBANK, N.A. (476810)</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">1.0800</td>
<td style="text-align: right;">1.180</td>
<td style="text-align: right;">1.400</td>
<td style="text-align: right;">3.19</td>
</tr>
<tr class="even">
<td style="text-align: left;">BMO HARRIS BANK NATIONAL ASSOCIATION (75633)</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">1.1900</td>
<td style="text-align: right;">1.300</td>
<td style="text-align: right;">1.530</td>
<td style="text-align: right;">5.06</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</div>
</div>
<p><a href="#fig-lfeature">Figure&nbsp;<span>2.5</span></a> shows the features from <a href="#sec-outliers"><span>Section&nbsp;2.4</span></a> that we can use to further explore the characteristics of each peer group (the calculations are documented in the tsfeatures R package by <span class="citation" data-cites="tsfeatures">Hyndman and Yang (<a href="#ref-tsfeatures" role="doc-biblioref">2023</a>)</span>).</p>
<p>The <em>Other Banks</em> peer group has been added for interest.</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"var_tiled_var"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"var_tiled_mean"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"seasonal_strength_year"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"trend_strength"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"linearity"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"stl_e_acf1"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"stl_e_acf10"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"nsdiffs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-lfeature" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-lfeature-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-lfeature-1.png" class="img-fluid figure-img" data-ref-parent="fig-lfeature" width="672"></p>
<figcaption class="figure-caption">(a) Lumpiness - variance of the variances based on tiled yearly(non-overlapping) windows</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-lfeature-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-lfeature-2.png" class="img-fluid figure-img" data-ref-parent="fig-lfeature" width="672"></p>
<figcaption class="figure-caption">(b) Stability - the variance of the means based on tiled yearly(non-overlapping) windows</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-lfeature-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-lfeature-3.png" class="img-fluid figure-img" data-ref-parent="fig-lfeature" width="672"></p>
<figcaption class="figure-caption">(c) STL decomposition Seasonal Strength - 0 is week (non-seasonal), 1 is strong</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-lfeature-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-lfeature-4.png" class="img-fluid figure-img" data-ref-parent="fig-lfeature" width="672"></p>
<figcaption class="figure-caption">(d) STL decomposition Trend Strength - 0 is week (no trend), 1 is strong</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-lfeature-5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-lfeature-5.png" class="img-fluid figure-img" data-ref-parent="fig-lfeature" width="672"></p>
<figcaption class="figure-caption">(e) Linearity - values around 0 indicate the series is linear</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-lfeature-6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-lfeature-6.png" class="img-fluid figure-img" data-ref-parent="fig-lfeature" width="672"></p>
<figcaption class="figure-caption">(f) Autocorrelation - first autocorrelation coefficient</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-lfeature-7" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-lfeature-7.png" class="img-fluid figure-img" data-ref-parent="fig-lfeature" width="672"></p>
<figcaption class="figure-caption">(g) Autocorrelation - 10th autocorrelation coefficient. In a completely random series (white noise), we would expect autocorrelation coefficients near zero for all lags</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-lfeature-8" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-lfeature-8.png" class="img-fluid figure-img" data-ref-parent="fig-lfeature" width="672"></p>
<figcaption class="figure-caption">(h) Minimum number of differences necessary to obtain a stationary time series</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.5: Exploring Statistical Features (Post Regulatory environment)</figcaption><p></p>
</figure>
</div>
</div>
<ol type="1">
<li><p><a href="#fig-lfeature-1">Figure&nbsp;<span>2.5 (a)</span></a>: <em>Other Banks</em> are lumpy. Also we can see from <a href="#fig-regulation-2">Figure&nbsp;<span>2.1 (b)</span></a> that lumpiness continued post regulatory changes even though <em>Other Banks</em> are subject to the same regulation.</p></li>
<li><p><a href="#fig-lfeature-2">Figure&nbsp;<span>2.5 (b)</span></a>: For <em>Large Banks</em> and <em>Large Credit Card Banks</em> the stability is ~0.8 indicating a degree of fluctuation in the data from one year to the next.</p></li>
<li><p><a href="#fig-lfeature-3">Figure&nbsp;<span>2.5 (c)</span></a> <em>Large Credit Card</em> Banks are seasonal. This can also be seen in the undulating shape in ACF plot (see <a href="#fig-acf-1">Figure&nbsp;<span>2.7 (a)</span></a>).</p>
<p><a href="#fig-season">Figure&nbsp;<span>2.6</span></a> shows both <em>Large Banks</em> and <em>Large Credit Card Banks</em> peak in Q3. Given events like Black Friday, Thanksgiving and Christmas occur in Q4, we may have expected peak delinquency in Q4 or Q1.</p></li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_alltypes <span class="sc">|&gt;</span> <span class="fu">group_by</span>(BankType) <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm=</span>T)) <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gg_subseries</span>() <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y=</span><span class="fu">glue</span>(<span class="st">"{target_label} </span><span class="sc">\n</span><span class="st"> mean"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-season" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-season-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.6: Quarterly Seasonal Subseries. The blue horizontal lines indicate the means for each quarter.</figcaption>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li><a href="#fig-lfeature-4">Figure&nbsp;<span>2.5 (d)</span></a> and <a href="#fig-lfeature-5">Figure&nbsp;<span>2.5 (e)</span></a> indicates a strong linear trend for <em>Large Banks</em> and <em>Large Credit Card Banks</em>.</li>
<li><a href="#fig-lfeature-6">Figure&nbsp;<span>2.5 (f)</span></a> the first autocorrelation coefficient is close to 0 which indicates a weak linear relationship between lagged values. Of note the coefficients are negative indicating a tendency for a short-term reversal. This can be seen in <a href="#fig-regulation-1">Figure&nbsp;<span>2.1 (a)</span></a> where the values oscillate.</li>
<li><a href="#fig-lfeature-7">Figure&nbsp;<span>2.5 (g)</span></a> the 10th autocorrelation coefficient. Checking overall autocorrelation using the Ljung-Box test proves autocorrelation i.e.&nbsp;data pattern is not due to chance.</li>
</ol>
<p><strong>Ljung-Box test</strong></p>
<div class="border">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>final_df <span class="sc">|&gt;</span> <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> <span class="fu">pull</span>(value_diff) <span class="sc">|&gt;</span> <span class="fu">Box.test</span>(<span class="at">lag =</span> <span class="dv">10</span>, <span class="at">type =</span> <span class="st">"Ljung"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Box-Ljung test

data:  pull(na.omit(final_df), value_diff)
X-squared = 132.95, df = 10, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
</div>
<ol start="5" type="1">
<li><a href="#fig-lfeature-8">Figure&nbsp;<span>2.5 (h)</span></a> <em>Large Credit Card Banks</em> is not stationary. Performing a difference i.e.&nbsp;to get the quarterly change in UBPRE524, makes the series stationary as shown in <a href="#fig-acf">Figure&nbsp;<span>2.7</span></a>. This can be confirmed by performing an augmented Dickey–Fuller (ADF) test on the differenced value. We also see that, post differencing, the autocorrelation coefficient at lag 2 is above the significance threshold. This is likely due to seasonality as there are larger coefficients at regular intervals - lags 2, 6, 10, and 14. The decreasing magnitude of these coefficients tell us the earlier lags have a stronger influence than values further in the past.</li>
</ol>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>agg_df <span class="ot">&lt;-</span> final_df <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by</span>(BankType)<span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">mean_val =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm=</span>T),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mean_diff =</span> <span class="fu">mean</span>(value_diff, <span class="at">na.rm=</span>T)) </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>agg_df <span class="sc">|&gt;</span> <span class="fu">ACF</span>(<span class="at">x=</span>mean_val,<span class="at">lag_max =</span> <span class="dv">42</span>) <span class="sc">|&gt;</span> <span class="fu">autoplot</span>()</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>agg_df <span class="sc">|&gt;</span> <span class="fu">ACF</span>(<span class="at">x=</span>mean_diff,<span class="at">lag_max =</span> <span class="dv">42</span>) <span class="sc">|&gt;</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-acf" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-acf-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-acf-1.png" class="img-fluid figure-img" data-ref-parent="fig-acf" width="672"></p>
<figcaption class="figure-caption">(a)</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-acf-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="data_ffiec_files/figure-html/fig-acf-2.png" class="img-fluid figure-img" data-ref-parent="fig-acf" width="672"></p>
<figcaption class="figure-caption">(b)</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;2.7: ACF on original value (a) and first difference value (b)</figcaption><p></p>
</figure>
</div>
</div>
<p><strong>Dickey–Fuller (ADF) test</strong></p>
<div class="border">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>final_df <span class="sc">|&gt;</span> <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> <span class="fu">pull</span>(value_diff) <span class="sc">|&gt;</span> tseries<span class="sc">::</span><span class="fu">adf.test</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  pull(na.omit(final_df), value_diff)
Dickey-Fuller = -14.145, Lag order = 11, p-value = 0.01
alternative hypothesis: stationary</code></pre>
</div>
</div>
</div>
</section>
<section id="summary" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="summary"><span class="header-section-number">2.6</span> Summary</h2>
<p>In summary, based on exploration of the data we will prepare the data for modelling by:</p>
<p><strong><em>Selecting:</em></strong></p>
<ol type="1">
<li>Target measure: <em>Credit Card Plans-30-89 DAYS P/D %</em> (UBPRE524).</li>
<li>Banks: <em>Large Banks</em> and <em>Large Credit Card</em> Banks.</li>
<li>Date Period: from 2010 Q2.</li>
</ol>
<p><strong><em>Removing:</em></strong></p>
<ol start="4" type="1">
<li>Outlier data points: first 2 quarters from banks in <a href="#fig-outliers-2">Figure&nbsp;<span>2.2 (b)</span></a>.</li>
</ol>
<p><strong><em>Transforming:</em></strong></p>
<ol start="5" type="1">
<li>target measure to make it stationary by taking the first difference.</li>
</ol>
</section>
<section id="references" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="references"><span class="header-section-number">2.7</span> References</h2>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-cfpb2013" class="csl-entry" role="listitem">
CFPB. 2013. <span>“CARD Act Report: A Review of the Impact of the CARD Act on the Consumer Credit Card Market.”</span> Consumer Financial Protection Bureau. <a href="https://files.consumerfinance.gov/f/201309_cfpb_card-act-report.pdf">https://files.consumerfinance.gov/f/201309_cfpb_card-act-report.pdf</a>.
</div>
<div id="ref-cfpb2010z" class="csl-entry" role="listitem">
CFPBb. 2023. <span>“12 CFR Part 1026 - Truth in Lending (Regulation z).”</span> Consumer Financial Protection Bureau. <a href="https://www.consumerfinance.gov/rules-policy/regulations/1026/">https://www.consumerfinance.gov/rules-policy/regulations/1026/</a>.
</div>
<div id="ref-economist2023" class="csl-entry" role="listitem">
Economist. 2023. <span>“Why America Has so Many Banks.”</span> <em>Economist</em>. <a href="https://www.economist.com/the-economist-explains/2023/05/26/why-america-has-so-many-banks">https://www.economist.com/the-economist-explains/2023/05/26/why-america-has-so-many-banks</a>.
</div>
<div id="ref-ffiec" class="csl-entry" role="listitem">
FFIEC. 2023. <span>“Central Data Repository.”</span> Federal Financial Institutions Examination Council. <a href="https://cdr.ffiec.gov/">https://cdr.ffiec.gov/</a>.
</div>
<div id="ref-Hyndman2021" class="csl-entry" role="listitem">
Hyndman, Rob J., and George Athanasopoulos. 2021. <em>Forecasting: Principles and Practice</em>. OTexts. <a href="https://otexts.com/fpp3/">https://otexts.com/fpp3/</a>.
</div>
<div id="ref-tsfeatures" class="csl-entry" role="listitem">
Hyndman, Rob J., and Yangzhuoran Yang. 2023. <span>“Introduction to the Tsfeatures Package.”</span> <a href="https://cran.r-project.org/web/packages/tsfeatures/vignettes/tsfeatures.html">https://cran.r-project.org/web/packages/tsfeatures/vignettes/tsfeatures.html</a>.
</div>
<div id="ref-boston2014" class="csl-entry" role="listitem">
Jambulapati, Vikram, and Joanna Stavins. 2013. <span>“The Credit CARD Act of 2009: What Did Banks Do?”</span> Federal Reserve Bank of Boston. <a href="https://www.bostonfed.org/-/media/Documents/Workingpapers/PDF/ppdp1307.pdf">https://www.bostonfed.org/-/media/Documents/Workingpapers/PDF/ppdp1307.pdf</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./data_banks.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bank Peer Groups</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb17" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Bank Data"</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>US banks are required to report quarterly financial data e.g., Balance Sheet and Income Statements, to the US Federal Financial Institutions Examination Council (FFIEC) who make this data publicly available in a consolidated format as a part of their Uniform Bank Performance Reporting (UBPR) regime. Data is available from 2002 Q4 @ffiec.</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>We are interested in measures that will provide insights to Bank's credit card businesses as shown in @tbl-ccmeasures. </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "UBPR Credit Card Measures"</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-ccmeasures</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">'functions.R'</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="fu">credit_card</span>() <span class="sc">|&gt;</span> </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(Measure, Description) <span class="sc">|&gt;</span> </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">str_detect</span>(Description, <span class="st">"Credit|90 days"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Measure of portfolio quality</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>To measure quality we can use the proportion of credit cards that are delinquent in the portfolio. This is the sum of UBPRE523 and UBPRE524; accounts that are accruing payments but are overdue by 30 day+ or are in non-accrual status i.e. non-performing loans. </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>However, given we are interested in the impact of a partnership, using measure **Credit Card Plans-30-89 DAYS P/D %** (UBPRE524) is ideal as it gives us the earliest indicator of delinquency.</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bank Peer Groups</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>The scope of Banks included in our analysis is not limited to the banks involved in credit card partnerships. We can use data from FFIEC to add information about their peers i.e. other banks that are similar. </span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>@tbl-peergrpcnt details 3 peer groups. National (US-wide) Credit card partnerships occur between banks in the **Large Bank** and **Large Credit Card Bank** groups. These peer groups are defined by FFIEC (see @sec-peers for full list of Banks in each peer group) <span class="co">[</span><span class="ot">@ffiec</span><span class="co">]</span>.</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>A Large Bank like CITIBANK will have a multiple businesses: household mortgages and credit cards; market trading; investment banking and more. In contrast, large credit card banks like BARCLAYS US specialise in credit cards only. Consequently, we expect to see the peer groups react differently to external factors, or exhibit different internal dynamics and risk profiles. </span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Number of Banks in each peer group"</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-peergrpcnt</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>overdue30to89 <span class="ot">&lt;-</span> <span class="fu">credit_card.overdue_3089</span>()</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>target_label <span class="ot">&lt;-</span> <span class="fu">credit_card.target_label</span>()</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>bank_scope <span class="ot">&lt;-</span> overdue30to89 <span class="sc">|&gt;</span> </span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>                <span class="fu">group_by</span>(BankName,BankType) <span class="sc">|&gt;</span> </span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summarise</span>(<span class="at">total_bal =</span> <span class="fu">sum</span>(<span class="fu">abs</span>(Value),<span class="at">na.rm=</span>T)) <span class="sc">|&gt;</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(total_bal)<span class="sc">|</span>total_bal<span class="sc">==</span><span class="dv">0</span>))</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>bank_n <span class="ot">&lt;-</span> bank_scope <span class="sc">|&gt;</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by</span>(BankType) <span class="sc">|&gt;</span> </span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">Number =</span> <span class="fu">n</span>())</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>bank_n <span class="sc">|&gt;</span> <span class="fu">right_join</span>(<span class="fu">bank_type.desc</span>()) <span class="sc">|&gt;</span> <span class="fu">relocate</span>(Number, <span class="at">.after =</span> <span class="fu">last_col</span>()) <span class="sc">|&gt;</span>  </span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>            knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>)    </span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span> </span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>Why are there thousands of Banks? The US Banking system grew out of 19th-century regulations that restricted where banks could operate. This resulted in a very localised Banking market. Today big banks such as JPMorgan Chase, Bank of America, Citigroup and Wells Fargo, dominate the industry but there are still about 4,100 US Banks compared with 353 in Britain and 261 in Germany <span class="co">[</span><span class="ot">@economist2023</span><span class="co">]</span>. </span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Period</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>Regulation implemented in 2010 had a material impact on the credit card market <span class="co">[</span><span class="ot">@cfpb2013; also @boston2014</span><span class="co">]</span>. As highlighted by @boston2014, regulation coincided with the 2008 financial crisis and recession, making it difficult to fully assert causation <span class="co">[</span><span class="ot">-@boston2014</span><span class="co">]</span>.</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>The regulations introduced were:</span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Credit Card Accountability Responsibility and Disclosure (CARD) Act of 2009 which had a staggered implementation in February and August 2010. This Act requires Banks to assess whether a potential borrower has the means to repay. Additionally, high-risk borrowers like those under 21, have additional restrictions. This has led to stricter lending criteria e.g., income and credit history checks <span class="co">[</span><span class="ot">@cfpb2013</span><span class="co">]</span>. </span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Regulation Z, or the Truth in Lending Act (TILA), focuses on ensuring transparency and fairness in lending practices. Banks have to provide full disclosure of the terms and conditions of a loan agreement <span class="co">[</span><span class="ot">@cfpb2010z</span><span class="co">]</span>.</span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>We can see the impact in @fig-regulation which plots a linear trend for *`r target_label`* for each peer group. Based on @fig-regulation-3 there was increasing delinquency for Large Banks and Large Credit Card Banks before regulation, but post regulation the trend has reversed and is now trending down.</span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>For our analysis we will focus on credit card partnerships post regulation as this is more relevant for commenting on future partnership deals. </span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-regulation</span></span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Impact of Regulation"</span></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Bank Type have different intercepts and data patterns"</span></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Variance pre and post Regulation &lt;br&gt;(i) - CARD Act part 1 (ii) - Regulation Z and (iii) Card Act part 2 &lt;br&gt;The variance for Large Banks and Large Credit Card Banks have reduced post regulatory changes."</span></span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Linear trend pre and post Regulation."</span></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 1</span></span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a>reg_date_z <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2010-07-01"</span>)</span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a>reg_date_c1 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2010-02-22"</span>)</span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a>reg_date_c2 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2010-08-22"</span>)</span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a>overdue30to89 <span class="sc">|&gt;</span> </span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value_diff <span class="sc">&lt;=</span> <span class="dv">23</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(BankType) <span class="sc">|&gt;</span></span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">val_mean =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm=</span>T)) <span class="sc">|&gt;</span> </span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">autoplot</span>(val_mean, <span class="fu">aes</span>(<span class="at">colour=</span>BankType)) <span class="sc">+</span></span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> F, <span class="at">linewidth=</span>.<span class="dv">5</span>) <span class="sc">+</span>    </span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">bank_type.colours</span>())<span class="sc">+</span></span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a>                <span class="at">legend.title=</span><span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y=</span><span class="fu">glue</span>(<span class="st">"{target_label} </span><span class="sc">\n</span><span class="st"> mean"</span>), <span class="at">x=</span><span class="st">""</span>)</span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a>overdue30to89 <span class="sc">|&gt;</span> </span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value_diff <span class="sc">&lt;=</span> <span class="dv">23</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(BankType) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">variance =</span> <span class="fu">var</span>(Value)) <span class="sc">|&gt;</span> </span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(variance) <span class="sc">+</span></span>
<span id="cb17-108"><a href="#cb17-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> reg_date_c1,<span class="at">linetype=</span><span class="dv">2</span>,<span class="at">colour=</span><span class="st">"red"</span>, <span class="at">hjust =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb17-109"><a href="#cb17-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"label"</span>,<span class="at">label=</span><span class="st">"i"</span>, <span class="at">x=</span>reg_date_c1, <span class="at">y=</span><span class="fl">20.0</span>) <span class="sc">+</span></span>
<span id="cb17-110"><a href="#cb17-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> reg_date_z,<span class="at">linetype=</span><span class="dv">2</span>,<span class="at">colour=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb17-111"><a href="#cb17-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"label"</span>,<span class="at">label=</span><span class="st">"ii"</span>, <span class="at">x=</span>reg_date_z, <span class="at">y=</span><span class="fl">18.0</span>) <span class="sc">+</span></span>
<span id="cb17-112"><a href="#cb17-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> reg_date_c2,<span class="at">linetype=</span><span class="dv">2</span>,<span class="at">colour=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb17-113"><a href="#cb17-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"label"</span>,<span class="at">label=</span><span class="st">"iii"</span>, <span class="at">x=</span>reg_date_c2, <span class="at">y=</span><span class="fl">16.0</span>, <span class="at">hjust =</span> <span class="sc">-</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb17-114"><a href="#cb17-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y=</span><span class="fu">glue</span>(<span class="st">"{target_label} </span><span class="sc">\n</span><span class="st"> variance"</span>), <span class="at">x=</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb17-115"><a href="#cb17-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">bank_type.colours</span>())<span class="sc">+</span></span>
<span id="cb17-116"><a href="#cb17-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>, <span class="at">legend.title=</span><span class="fu">element_blank</span>()) </span>
<span id="cb17-117"><a href="#cb17-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-118"><a href="#cb17-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-119"><a href="#cb17-119" aria-hidden="true" tabindex="-1"></a>overdue30to89 <span class="sc">|&gt;</span> </span>
<span id="cb17-120"><a href="#cb17-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value_diff <span class="sc">&lt;=</span> <span class="dv">23</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-121"><a href="#cb17-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">regulation =</span> <span class="fu">ifelse</span>(<span class="fu">as.Date</span>(Quarter) <span class="sc">&lt;</span> reg_date_c1, <span class="st">'Before'</span>, <span class="st">'After'</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb17-122"><a href="#cb17-122" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(BankType, regulation) <span class="sc">|&gt;</span></span>
<span id="cb17-123"><a href="#cb17-123" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">val_mean =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm=</span>T)) <span class="sc">|&gt;</span> </span>
<span id="cb17-124"><a href="#cb17-124" aria-hidden="true" tabindex="-1"></a>        <span class="fu">autoplot</span>(val_mean, <span class="fu">aes</span>(<span class="at">colour=</span>BankType)) <span class="sc">+</span></span>
<span id="cb17-125"><a href="#cb17-125" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> F,<span class="at">size=</span>.<span class="dv">5</span>) <span class="sc">+</span>    </span>
<span id="cb17-126"><a href="#cb17-126" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">bank_type.colours</span>(), <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"LargeBank"</span>,<span class="st">"LargeCreditCardBank"</span>,<span class="st">"OtherBank"</span>))<span class="sc">+</span></span>
<span id="cb17-127"><a href="#cb17-127" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> reg_date_c1,<span class="at">linetype=</span><span class="dv">2</span>,<span class="at">colour=</span><span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb17-128"><a href="#cb17-128" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotate</span>(<span class="st">"label"</span>,<span class="at">label=</span><span class="st">"CARD Act Part 1 comes into effect"</span>, <span class="at">x=</span>reg_date_c1, <span class="at">y=</span><span class="fl">3.5</span>, <span class="at">hjust =</span> <span class="sc">-</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb17-129"><a href="#cb17-129" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y=</span><span class="fu">glue</span>(<span class="st">"{target_label} </span><span class="sc">\n</span><span class="st"> mean"</span>), <span class="at">x=</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb17-130"><a href="#cb17-130" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>, <span class="at">legend.title=</span><span class="fu">element_blank</span>())</span>
<span id="cb17-131"><a href="#cb17-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-132"><a href="#cb17-132" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bank Outliers {#sec-outliers}</span></span>
<span id="cb17-133"><a href="#cb17-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-134"><a href="#cb17-134" aria-hidden="true" tabindex="-1"></a>As we are dealing with time series data, we need to identify banks where their individual series characteristics are markedly different from those of its peers.</span>
<span id="cb17-135"><a href="#cb17-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-136"><a href="#cb17-136" aria-hidden="true" tabindex="-1"></a>@fig-outliers takes the approach from @Hyndman2021 who use Principal Components Analysis (PCA) on a set of calculated statistical features such as intermittency, lumpiness, stability and Seasonal-Trend decomposition using LOESS (STL) <span class="co">[</span><span class="ot">-@Hyndman2021</span><span class="co">]</span>. </span>
<span id="cb17-137"><a href="#cb17-137" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb17-140"><a href="#cb17-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-141"><a href="#cb17-141" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-142"><a href="#cb17-142" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb17-143"><a href="#cb17-143" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-outliers </span></span>
<span id="cb17-144"><a href="#cb17-144" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Outlier Detection using PCA"</span></span>
<span id="cb17-145"><a href="#cb17-145" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb17-146"><a href="#cb17-146" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "PCA for &lt;span style='color:#1B9E77'&gt;Large&lt;/span&gt; and &lt;span style='color:#D95F02'&gt;Large Credit Card&lt;/span&gt; Banks using features: lumpiness, stability and seasonal. PC1 represents the most variation in the data and PC2 represents the second most variation in the data."</span></span>
<span id="cb17-147"><a href="#cb17-147" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Data series for Banks with PC1 &gt; 4 and PC2 &gt; 2.5"</span></span>
<span id="cb17-148"><a href="#cb17-148" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 1</span></span>
<span id="cb17-149"><a href="#cb17-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-150"><a href="#cb17-150" aria-hidden="true" tabindex="-1"></a>regulation_cutoff <span class="ot">&lt;-</span> <span class="st">"2010 Q2"</span></span>
<span id="cb17-151"><a href="#cb17-151" aria-hidden="true" tabindex="-1"></a>selected_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lumpiness"</span>,<span class="st">"stability"</span>,<span class="st">"seasonal"</span>)</span>
<span id="cb17-152"><a href="#cb17-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-153"><a href="#cb17-153" aria-hidden="true" tabindex="-1"></a>overdue30to89_post <span class="ot">&lt;-</span> overdue30to89 <span class="sc">|&gt;</span></span>
<span id="cb17-154"><a href="#cb17-154" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">filter_index</span>(regulation_cutoff <span class="sc">~</span> .) </span>
<span id="cb17-155"><a href="#cb17-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-156"><a href="#cb17-156" aria-hidden="true" tabindex="-1"></a>overdue30to89_lbanks <span class="ot">&lt;-</span> overdue30to89_post <span class="sc">|&gt;</span></span>
<span id="cb17-157"><a href="#cb17-157" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">filter</span>(BankType <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"LargeBank"</span>, <span class="st">"LargeCreditCardBank"</span>))</span>
<span id="cb17-158"><a href="#cb17-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-159"><a href="#cb17-159" aria-hidden="true" tabindex="-1"></a>all_f <span class="ot">&lt;-</span> overdue30to89_lbanks <span class="sc">|&gt;</span> </span>
<span id="cb17-160"><a href="#cb17-160" aria-hidden="true" tabindex="-1"></a>                <span class="fu">features</span>(Value, <span class="fu">feature_set</span>(<span class="at">tags =</span> selected_feats))</span>
<span id="cb17-161"><a href="#cb17-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-162"><a href="#cb17-162" aria-hidden="true" tabindex="-1"></a>pcs <span class="ot">&lt;-</span> all_f <span class="sc">|&gt;</span> </span>
<span id="cb17-163"><a href="#cb17-163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_if</span>(is.numeric, replace_na, <span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="co">#where we could not calc a feature value</span></span>
<span id="cb17-164"><a href="#cb17-164" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(IDRSSD,BankName, Measure, Label, Description, BankType)) <span class="sc">|&gt;</span></span>
<span id="cb17-165"><a href="#cb17-165" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prcomp</span>(<span class="at">scale =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-166"><a href="#cb17-166" aria-hidden="true" tabindex="-1"></a>    broom<span class="sc">::</span><span class="fu">augment</span>(all_f)</span>
<span id="cb17-167"><a href="#cb17-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-168"><a href="#cb17-168" aria-hidden="true" tabindex="-1"></a>pc1_threshold <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb17-169"><a href="#cb17-169" aria-hidden="true" tabindex="-1"></a>pc2_threshold <span class="ot">&lt;-</span> <span class="fl">2.5</span></span>
<span id="cb17-170"><a href="#cb17-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-171"><a href="#cb17-171" aria-hidden="true" tabindex="-1"></a><span class="fu">pcs.plot</span>(pcs)</span>
<span id="cb17-172"><a href="#cb17-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-173"><a href="#cb17-173" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> pcs <span class="sc">|&gt;</span></span>
<span id="cb17-174"><a href="#cb17-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( (.fittedPC2 <span class="sc">&gt;</span> pc2_threshold) <span class="sc">|</span> (.fittedPC1 <span class="sc">&gt;</span> pc1_threshold)) <span class="sc">|&gt;</span></span>
<span id="cb17-175"><a href="#cb17-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(IDRSSD) </span>
<span id="cb17-176"><a href="#cb17-176" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-177"><a href="#cb17-177" aria-hidden="true" tabindex="-1"></a><span class="fu">outlier.plot</span>(overdue30to89_lbanks, outliers)</span>
<span id="cb17-178"><a href="#cb17-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-179"><a href="#cb17-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-180"><a href="#cb17-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-181"><a href="#cb17-181" aria-hidden="true" tabindex="-1"></a>Interestingly, all the banks in @fig-outliers-2 started or re-started (as was the case for Regions Bank) their credit card businesses after 2010 Q2 (regulatory period cut-off). With the exception of Ally Bank all series begin at 0 and sharply increase after the first or second quarter. This pattern is expected as it takes 30+ days for credit cards to become delinquent. </span>
<span id="cb17-182"><a href="#cb17-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-183"><a href="#cb17-183" aria-hidden="true" tabindex="-1"></a>If we drop the first 2 non-zero quarters and re-run the PCA (see @fig-outliers-corrected) the banks are no longer outliers - indicating that it was that sharp increase that was unusual.</span>
<span id="cb17-184"><a href="#cb17-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-187"><a href="#cb17-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-188"><a href="#cb17-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-189"><a href="#cb17-189" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb17-190"><a href="#cb17-190" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-outliers-corrected</span></span>
<span id="cb17-191"><a href="#cb17-191" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "PCA of outliers after their first 2 non-zero quarters are dropped"</span></span>
<span id="cb17-192"><a href="#cb17-192" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 4</span></span>
<span id="cb17-193"><a href="#cb17-193" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb17-194"><a href="#cb17-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-195"><a href="#cb17-195" aria-hidden="true" tabindex="-1"></a>outlier_df <span class="ot">&lt;-</span>overdue30to89_lbanks <span class="sc">|&gt;</span> </span>
<span id="cb17-196"><a href="#cb17-196" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(IDRSSD <span class="sc">%in%</span> outliers<span class="sc">$</span>IDRSSD, Value <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-197"><a href="#cb17-197" aria-hidden="true" tabindex="-1"></a>    tsibble<span class="sc">::</span><span class="fu">group_by_key</span>() <span class="sc">|&gt;</span> </span>
<span id="cb17-198"><a href="#cb17-198" aria-hidden="true" tabindex="-1"></a>            <span class="fu">slice</span>(<span class="dv">3</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb17-199"><a href="#cb17-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-200"><a href="#cb17-200" aria-hidden="true" tabindex="-1"></a>all_f_outliers <span class="ot">&lt;-</span> outlier_df <span class="sc">|&gt;</span> </span>
<span id="cb17-201"><a href="#cb17-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">features</span>(Value, <span class="fu">feature_set</span>(<span class="at">tags =</span> selected_feats))</span>
<span id="cb17-202"><a href="#cb17-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-203"><a href="#cb17-203" aria-hidden="true" tabindex="-1"></a>all_f_outliers <span class="sc">|&gt;</span> </span>
<span id="cb17-204"><a href="#cb17-204" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_if</span>(is.numeric, replace_na, <span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="co">#where we could not calc a feature value</span></span>
<span id="cb17-205"><a href="#cb17-205" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(IDRSSD,BankName, Measure, Label, Description, BankType)) <span class="sc">|&gt;</span></span>
<span id="cb17-206"><a href="#cb17-206" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prcomp</span>(<span class="at">scale =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-207"><a href="#cb17-207" aria-hidden="true" tabindex="-1"></a>    broom<span class="sc">::</span><span class="fu">augment</span>(all_f_outliers) <span class="sc">|&gt;</span> <span class="fu">pcs.plot</span>()                            </span>
<span id="cb17-208"><a href="#cb17-208" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb17-209"><a href="#cb17-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-210"><a href="#cb17-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-211"><a href="#cb17-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-214"><a href="#cb17-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-215"><a href="#cb17-215" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-216"><a href="#cb17-216" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb17-217"><a href="#cb17-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-218"><a href="#cb17-218" aria-hidden="true" tabindex="-1"></a><span class="co">#apply 1. regulatory cutoff, 2. fixed outliers.</span></span>
<span id="cb17-219"><a href="#cb17-219" aria-hidden="true" tabindex="-1"></a>df_alltypes <span class="ot">&lt;-</span> overdue30to89_post <span class="sc">|&gt;</span> </span>
<span id="cb17-220"><a href="#cb17-220" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="sc">!</span>IDRSSD <span class="sc">%in%</span> outliers<span class="sc">$</span>IDRSSD) <span class="sc">|&gt;</span> </span>
<span id="cb17-221"><a href="#cb17-221" aria-hidden="true" tabindex="-1"></a>                <span class="fu">add_row</span>(outlier_df) <span class="sc">|&gt;</span> </span>
<span id="cb17-222"><a href="#cb17-222" aria-hidden="true" tabindex="-1"></a>                <span class="fu">fill_gaps</span>()</span>
<span id="cb17-223"><a href="#cb17-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-224"><a href="#cb17-224" aria-hidden="true" tabindex="-1"></a>all_ftbanks <span class="ot">&lt;-</span> df_alltypes <span class="sc">|&gt;</span> </span>
<span id="cb17-225"><a href="#cb17-225" aria-hidden="true" tabindex="-1"></a>                <span class="fu">features</span>(Value, <span class="fu">feature_set</span>(<span class="at">tags =</span> selected_feats))</span>
<span id="cb17-226"><a href="#cb17-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-227"><a href="#cb17-227" aria-hidden="true" tabindex="-1"></a>final_df <span class="ot">&lt;-</span> df_alltypes <span class="sc">|&gt;</span> </span>
<span id="cb17-228"><a href="#cb17-228" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(BankType <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"LargeBank"</span>, <span class="st">"LargeCreditCardBank"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-229"><a href="#cb17-229" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">value_diff =</span> <span class="fu">difference</span>(Value))</span>
<span id="cb17-230"><a href="#cb17-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-231"><a href="#cb17-231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-232"><a href="#cb17-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-233"><a href="#cb17-233" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exploration of Statistical Features {#sec-feature-explore}</span></span>
<span id="cb17-234"><a href="#cb17-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-235"><a href="#cb17-235" aria-hidden="true" tabindex="-1"></a>@fig-quantile plots the distribution of <span class="in">`r target_label`</span>. We can see that there are two peaks for *Large Credit Card Banks*. There are <span class="in">`r bank_n |&gt; filter(BankType=="LargeCreditCardBank") |&gt; pull(Number)`</span> banks in the this peer group which may be too small to capture the true distribution effectively. However, it may also indicate that there are sub-groups within this peer group. For instance, the first peak could represent banks that have lower risk profiles, while the second represents banks that have a higher risk profiles.</span>
<span id="cb17-236"><a href="#cb17-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-237"><a href="#cb17-237" aria-hidden="true" tabindex="-1"></a>::: {#tbl-quantile .panel-tabset}</span>
<span id="cb17-238"><a href="#cb17-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-239"><a href="#cb17-239" aria-hidden="true" tabindex="-1"></a><span class="fu">## Distribution</span></span>
<span id="cb17-242"><a href="#cb17-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-243"><a href="#cb17-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-244"><a href="#cb17-244" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb17-245"><a href="#cb17-245" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb17-246"><a href="#cb17-246" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-quantile</span></span>
<span id="cb17-247"><a href="#cb17-247" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Density plot"</span></span>
<span id="cb17-248"><a href="#cb17-248" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(final_df, <span class="fu">aes</span>(<span class="at">x=</span>Value, <span class="at">colour =</span> BankType))<span class="sc">+</span> </span>
<span id="cb17-249"><a href="#cb17-249" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-250"><a href="#cb17-250" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span>target_label) <span class="sc">+</span></span>
<span id="cb17-251"><a href="#cb17-251" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>,<span class="at">legend.title=</span><span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb17-252"><a href="#cb17-252" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">bank_type.colours</span>())</span>
<span id="cb17-253"><a href="#cb17-253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-254"><a href="#cb17-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-255"><a href="#cb17-255" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quantiles - Large Credit Card Banks</span></span>
<span id="cb17-258"><a href="#cb17-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-259"><a href="#cb17-259" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-260"><a href="#cb17-260" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb17-261"><a href="#cb17-261" aria-hidden="true" tabindex="-1"></a>final_df <span class="sc">|&gt;</span> <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-262"><a href="#cb17-262" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BankType <span class="sc">==</span> <span class="st">"LargeCreditCardBank"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-263"><a href="#cb17-263" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(Value, quantile)<span class="sc">|&gt;</span> </span>
<span id="cb17-264"><a href="#cb17-264" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(IDRSSD,Measure,Label,Description,BankType)) <span class="sc">|&gt;</span></span>
<span id="cb17-265"><a href="#cb17-265" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="st">`</span><span class="at">100%</span><span class="st">`</span>)<span class="sc">|&gt;</span> </span>
<span id="cb17-266"><a href="#cb17-266" aria-hidden="true" tabindex="-1"></a>        knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>)        </span>
<span id="cb17-267"><a href="#cb17-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-268"><a href="#cb17-268" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quantiles - Large Banks</span></span>
<span id="cb17-269"><a href="#cb17-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-272"><a href="#cb17-272" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-273"><a href="#cb17-273" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-274"><a href="#cb17-274" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb17-275"><a href="#cb17-275" aria-hidden="true" tabindex="-1"></a>final_df <span class="sc">|&gt;</span> <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-276"><a href="#cb17-276" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BankType <span class="sc">==</span> <span class="st">"LargeBank"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-277"><a href="#cb17-277" aria-hidden="true" tabindex="-1"></a>      <span class="fu">features</span>(Value, quantile)<span class="sc">|&gt;</span> </span>
<span id="cb17-278"><a href="#cb17-278" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(IDRSSD,Measure,Label,Description,BankType)) <span class="sc">|&gt;</span> </span>
<span id="cb17-279"><a href="#cb17-279" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="st">`</span><span class="at">100%</span><span class="st">`</span>)<span class="sc">|&gt;</span> </span>
<span id="cb17-280"><a href="#cb17-280" aria-hidden="true" tabindex="-1"></a>        knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>)</span>
<span id="cb17-281"><a href="#cb17-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-282"><a href="#cb17-282" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb17-283"><a href="#cb17-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-284"><a href="#cb17-284" aria-hidden="true" tabindex="-1"></a>@fig-lfeature shows the features from @sec-outliers that we can use to further explore the characteristics of each peer group (the calculations are documented in the tsfeatures R package by @tsfeatures). </span>
<span id="cb17-285"><a href="#cb17-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-286"><a href="#cb17-286" aria-hidden="true" tabindex="-1"></a>The *Other Banks* peer group has been added for interest. </span>
<span id="cb17-287"><a href="#cb17-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-290"><a href="#cb17-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-291"><a href="#cb17-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-292"><a href="#cb17-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb17-293"><a href="#cb17-293" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-lfeature</span></span>
<span id="cb17-294"><a href="#cb17-294" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Exploring Statistical Features (Post Regulatory environment)"</span></span>
<span id="cb17-295"><a href="#cb17-295" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb17-296"><a href="#cb17-296" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Lumpiness - variance of the variances based on tiled yearly(non-overlapping) windows"</span></span>
<span id="cb17-297"><a href="#cb17-297" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Stability - the variance of the means based on tiled yearly(non-overlapping) windows"</span></span>
<span id="cb17-298"><a href="#cb17-298" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "STL decomposition Seasonal Strength - 0 is week (non-seasonal), 1 is strong"</span></span>
<span id="cb17-299"><a href="#cb17-299" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "STL decomposition Trend Strength - 0 is week (no trend), 1 is strong"</span></span>
<span id="cb17-300"><a href="#cb17-300" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Linearity -  values around 0 indicate the series is linear"</span></span>
<span id="cb17-301"><a href="#cb17-301" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Autocorrelation - first autocorrelation coefficient"</span></span>
<span id="cb17-302"><a href="#cb17-302" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Autocorrelation - 10th autocorrelation coefficient. In a completely random series (white noise), we would expect autocorrelation coefficients near zero for all lags"</span></span>
<span id="cb17-303"><a href="#cb17-303" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Minimum number of differences necessary to obtain a stationary time series"</span></span>
<span id="cb17-304"><a href="#cb17-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb17-305"><a href="#cb17-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-306"><a href="#cb17-306" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"var_tiled_var"</span>)</span>
<span id="cb17-307"><a href="#cb17-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-308"><a href="#cb17-308" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"var_tiled_mean"</span>)</span>
<span id="cb17-309"><a href="#cb17-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-310"><a href="#cb17-310" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"seasonal_strength_year"</span>)</span>
<span id="cb17-311"><a href="#cb17-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-312"><a href="#cb17-312" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"trend_strength"</span>)</span>
<span id="cb17-313"><a href="#cb17-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-314"><a href="#cb17-314" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"linearity"</span>)</span>
<span id="cb17-315"><a href="#cb17-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-316"><a href="#cb17-316" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"stl_e_acf1"</span>)</span>
<span id="cb17-317"><a href="#cb17-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-318"><a href="#cb17-318" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"stl_e_acf10"</span>)</span>
<span id="cb17-319"><a href="#cb17-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-320"><a href="#cb17-320" aria-hidden="true" tabindex="-1"></a><span class="fu">features.plot_violin</span>(all_ftbanks, <span class="st">"nsdiffs"</span>)</span>
<span id="cb17-321"><a href="#cb17-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-322"><a href="#cb17-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-323"><a href="#cb17-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-324"><a href="#cb17-324" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>@fig-lfeature-1: *Other Banks* are lumpy. Also we can see from @fig-regulation-2 that lumpiness continued post regulatory changes even though *Other Banks* are subject to the same regulation. </span>
<span id="cb17-325"><a href="#cb17-325" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>@fig-lfeature-2: For *Large Banks* and *Large Credit Card Banks* the stability is ~0.8 indicating a degree of fluctuation in the data from one year to the next.</span>
<span id="cb17-326"><a href="#cb17-326" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>@fig-lfeature-3 *Large Credit Card* Banks are seasonal. This can also be seen in the undulating shape in ACF plot (see @fig-acf-1). </span>
<span id="cb17-327"><a href="#cb17-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-328"><a href="#cb17-328" aria-hidden="true" tabindex="-1"></a>    @fig-season shows both *Large Banks* and *Large Credit Card Banks* peak in Q3. Given events like Black Friday, Thanksgiving and Christmas occur in Q4, we may have expected peak delinquency in Q4 or Q1. </span>
<span id="cb17-329"><a href="#cb17-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-332"><a href="#cb17-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-333"><a href="#cb17-333" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-334"><a href="#cb17-334" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb17-335"><a href="#cb17-335" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-season</span></span>
<span id="cb17-336"><a href="#cb17-336" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Quarterly Seasonal Subseries. The blue horizontal lines indicate the means for each quarter."</span></span>
<span id="cb17-337"><a href="#cb17-337" aria-hidden="true" tabindex="-1"></a>df_alltypes <span class="sc">|&gt;</span> <span class="fu">group_by</span>(BankType) <span class="sc">|&gt;</span> </span>
<span id="cb17-338"><a href="#cb17-338" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm=</span>T)) <span class="sc">|&gt;</span> </span>
<span id="cb17-339"><a href="#cb17-339" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gg_subseries</span>() <span class="sc">+</span></span>
<span id="cb17-340"><a href="#cb17-340" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y=</span><span class="fu">glue</span>(<span class="st">"{target_label} </span><span class="sc">\n</span><span class="st"> mean"</span>))</span>
<span id="cb17-341"><a href="#cb17-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-342"><a href="#cb17-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-343"><a href="#cb17-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-344"><a href="#cb17-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-345"><a href="#cb17-345" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>@fig-lfeature-4 and @fig-lfeature-5 indicates a strong linear trend for *Large Banks* and *Large Credit Card Banks*.</span>
<span id="cb17-346"><a href="#cb17-346" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>@fig-lfeature-6 the first autocorrelation coefficient is close to 0 which indicates a weak linear relationship between lagged values. Of note the coefficients are negative indicating a tendency for a short-term reversal. This can be seen in @fig-regulation-1 where the values oscillate.</span>
<span id="cb17-347"><a href="#cb17-347" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>@fig-lfeature-7 the 10th autocorrelation coefficient. Checking overall autocorrelation using the Ljung-Box test proves autocorrelation i.e. data pattern is not due to chance.</span>
<span id="cb17-348"><a href="#cb17-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-349"><a href="#cb17-349" aria-hidden="true" tabindex="-1"></a>**Ljung-Box test**</span>
<span id="cb17-350"><a href="#cb17-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-351"><a href="#cb17-351" aria-hidden="true" tabindex="-1"></a>::: {.border}</span>
<span id="cb17-354"><a href="#cb17-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-355"><a href="#cb17-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-356"><a href="#cb17-356" aria-hidden="true" tabindex="-1"></a>final_df <span class="sc">|&gt;</span> <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> <span class="fu">pull</span>(value_diff) <span class="sc">|&gt;</span> <span class="fu">Box.test</span>(<span class="at">lag =</span> <span class="dv">10</span>, <span class="at">type =</span> <span class="st">"Ljung"</span>)</span>
<span id="cb17-357"><a href="#cb17-357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-358"><a href="#cb17-358" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb17-359"><a href="#cb17-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-360"><a href="#cb17-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-361"><a href="#cb17-361" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>@fig-lfeature-8 *Large Credit Card Banks* is not stationary. Performing a difference i.e. to get the quarterly change in UBPRE524, makes the series stationary as shown in @fig-acf. This can be confirmed by performing an augmented Dickey–Fuller (ADF) test on the differenced value. We also see that, post differencing, the autocorrelation coefficient at lag 2 is above the significance threshold. This is likely due to seasonality as there are larger coefficients at regular intervals - lags 2, 6, 10, and 14. The decreasing magnitude of these coefficients tell us the earlier lags have a stronger influence than values further in the past.</span>
<span id="cb17-362"><a href="#cb17-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-365"><a href="#cb17-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-366"><a href="#cb17-366" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-367"><a href="#cb17-367" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb17-368"><a href="#cb17-368" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-acf</span></span>
<span id="cb17-369"><a href="#cb17-369" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "ACF on original value (a) and first difference value (b)"</span></span>
<span id="cb17-370"><a href="#cb17-370" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb17-371"><a href="#cb17-371" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - ""</span></span>
<span id="cb17-372"><a href="#cb17-372" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb17-373"><a href="#cb17-373" aria-hidden="true" tabindex="-1"></a>agg_df <span class="ot">&lt;-</span> final_df <span class="sc">|&gt;</span> </span>
<span id="cb17-374"><a href="#cb17-374" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by</span>(BankType)<span class="sc">|&gt;</span> </span>
<span id="cb17-375"><a href="#cb17-375" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">mean_val =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm=</span>T),</span>
<span id="cb17-376"><a href="#cb17-376" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mean_diff =</span> <span class="fu">mean</span>(value_diff, <span class="at">na.rm=</span>T)) </span>
<span id="cb17-377"><a href="#cb17-377" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb17-378"><a href="#cb17-378" aria-hidden="true" tabindex="-1"></a>agg_df <span class="sc">|&gt;</span> <span class="fu">ACF</span>(<span class="at">x=</span>mean_val,<span class="at">lag_max =</span> <span class="dv">42</span>) <span class="sc">|&gt;</span> <span class="fu">autoplot</span>()</span>
<span id="cb17-379"><a href="#cb17-379" aria-hidden="true" tabindex="-1"></a>agg_df <span class="sc">|&gt;</span> <span class="fu">ACF</span>(<span class="at">x=</span>mean_diff,<span class="at">lag_max =</span> <span class="dv">42</span>) <span class="sc">|&gt;</span> <span class="fu">autoplot</span>()</span>
<span id="cb17-380"><a href="#cb17-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-381"><a href="#cb17-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-382"><a href="#cb17-382" aria-hidden="true" tabindex="-1"></a>**Dickey–Fuller (ADF) test**</span>
<span id="cb17-383"><a href="#cb17-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-384"><a href="#cb17-384" aria-hidden="true" tabindex="-1"></a>::: {.border}</span>
<span id="cb17-387"><a href="#cb17-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb17-388"><a href="#cb17-388" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb17-389"><a href="#cb17-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-390"><a href="#cb17-390" aria-hidden="true" tabindex="-1"></a>final_df <span class="sc">|&gt;</span> <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> <span class="fu">pull</span>(value_diff) <span class="sc">|&gt;</span> tseries<span class="sc">::</span><span class="fu">adf.test</span>()</span>
<span id="cb17-391"><a href="#cb17-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-392"><a href="#cb17-392" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb17-393"><a href="#cb17-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-394"><a href="#cb17-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-395"><a href="#cb17-395" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb17-396"><a href="#cb17-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-397"><a href="#cb17-397" aria-hidden="true" tabindex="-1"></a>In summary, based on exploration of the data we will prepare the data for modelling by:</span>
<span id="cb17-398"><a href="#cb17-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-399"><a href="#cb17-399" aria-hidden="true" tabindex="-1"></a>***Selecting:***</span>
<span id="cb17-400"><a href="#cb17-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-401"><a href="#cb17-401" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Target measure: *`r target_label`* (UBPRE524).</span>
<span id="cb17-402"><a href="#cb17-402" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Banks: *Large Banks* and *Large Credit Card* Banks.</span>
<span id="cb17-403"><a href="#cb17-403" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Date Period: from 2010 Q2.</span>
<span id="cb17-404"><a href="#cb17-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-405"><a href="#cb17-405" aria-hidden="true" tabindex="-1"></a>***Removing:***</span>
<span id="cb17-406"><a href="#cb17-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-407"><a href="#cb17-407" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Outlier data points: first 2 quarters from banks in @fig-outliers-2.</span>
<span id="cb17-408"><a href="#cb17-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-409"><a href="#cb17-409" aria-hidden="true" tabindex="-1"></a>***Transforming:***</span>
<span id="cb17-410"><a href="#cb17-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-411"><a href="#cb17-411" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>target measure to make it stationary by taking the first difference.</span>
<span id="cb17-412"><a href="#cb17-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-413"><a href="#cb17-413" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>